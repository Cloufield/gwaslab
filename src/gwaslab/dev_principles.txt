# GWASLab Development Principles

## Data Prioritization
- **SNPID over rsID**: Prioritize SNPID (CHR:POS:NEA:EA or CHR:POS:REF:ALT) when checking variant identifiers
  - rsID may contain duplicates or missing values
- **MLOG10P over P**: Prioritize MLOG10P since P values can become 0 when exceeding float64 precision limits

## Code Quality & Architecture

### Logging & Monitoring
- Use `@with_logging` decorator for all QC/processing functions
- Use `Log()` class for all logging operations (write, warning, log)
- Log operation start/finish with version information
- Provide `verbose` parameter for controlling log output
- Decorator automatically handles:
  - DataFrame shape changes (show_shape=True by default)
  - Data type checking (check_dtype=True)
  - Data type fixing (fix=True, automatically enables check_dtype)
  - No manual shape/dtype checks needed when using decorator

### Validation & Error Handling
- Use `@with_logging` with `start_cols` to validate required columns before execution
  - Specify columns: `start_cols=["EA","NEA","STATUS"]`
  - Decorator validates and skips execution if missing
- Use `must_kwargs` to validate required arguments
- Handle missing columns gracefully (skip execution, return early)
- Use standardized error messages with function context

### Function Design
- Preserve function metadata using `functools.wraps` in decorators
- Handle both DataFrame and Sumstats object inputs:
  - Accept `sumstats_obj` as first parameter (pd.DataFrame or Sumstats)
  - Check `isinstance(sumstats_obj, pd.DataFrame)` to determine type
  - Extract `sumstats = sumstats_obj.data` for Sumstats objects
  - Return `sumstats_obj.data` for Sumstats, or `sumstats` for DataFrame
- Standardize parameter names across functions (e.g., use 'inplace' consistently)

## Data Standards

### Variant Identification
- Use 7-digit status code system for variant quality tracking (traceable)
- Follow status code principle: higher value = higher uncertainty

### Data Format
- Validate genome build format before processing (_process_build)
- Follow standardized column order (DEFAULT_COLUMN_ORDER)
- Use standardized chromosome notation (integers for autosomes, X=23, Y=24, MT=25)

### File Handling
- Use `tempfile` module for temporary files/directories:
  - `tempfile.mkdtemp()` for directories (with prefix/suffix)
  - `tempfile.NamedTemporaryFile()` or `tempfile.mkstemp()` for files
  - Ensure proper cleanup (context managers or try/finally blocks)
