{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":""},{"location":"#gwaslab","title":"GWASLab","text":"<ul> <li>A handy Python toolkit for handling GWAS summary statistics (sumstats).</li> <li>Each process is modularized and can be customized to your needs.</li> <li>Sumstats-specific manipulations are designed as methods of a Python object, <code>gwaslab.Sumstats</code>.</li> </ul> <p>Please check GWASLab documentation at https://cloufield.github.io/gwaslab/ Note: GWASLab is being updated very frequently for now. I will release the first stable version soon! Please stay tuned.</p>"},{"location":"#install","title":"Install","text":"<pre><code>pip install gwaslab==3.4.15\n</code></pre> <pre><code>import gwaslab as gl\n# load plink2 output\nmysumstats = gl.Sumstats(\"t2d_bbj.txt.gz\", fmt=\"plink2\")\n\n# or you can specify the columns:\nmysumstats = gl.Sumstats(\"t2d_bbj.txt.gz\",\n             snpid=\"SNP\",\n             chrom=\"CHR\",\n             pos=\"POS\",\n             ea=\"ALT\",\n             nea=\"REF\",\n             neaf=\"Frq\",\n             beta=\"BETA\",\n             se=\"SE\",\n             p=\"P\",\n             direction=\"Dir\",\n             n=\"N\",\n             build=\"19\")\n\n# manhattan and qq plot\nmysumstats.plot_mqq()\n...\n</code></pre>"},{"location":"#functions","title":"Functions","text":""},{"location":"#loading-and-formatting","title":"Loading and Formatting","text":"<ul> <li>Loading sumstats by simply specifying the software name or format name, or specifying each column name.</li> <li>Converting GWAS sumstats to specific formats:</li> <li>LDSC / MAGMA / METAL / PLINK / SAIGE / REGENIE / MR-MEGA / GWAS-SSF / FUMA / GWAS-VCF / BED... </li> <li>check available formats</li> <li>Optional filtering of variants in commonly used genomic regions: Hapmap3 SNPs / High-LD regions / MHC region </li> </ul>"},{"location":"#standardization-normalization","title":"Standardization &amp; Normalization","text":"<ul> <li>Variant ID standardization</li> <li>CHR and POS notation standardization</li> <li>Variant POS and allele normalization</li> <li>Genome build : Inference and Liftover </li> </ul>"},{"location":"#quality-control-value-conversion-filtering","title":"Quality control, Value conversion &amp; Filtering","text":"<ul> <li>Statistics sanity check</li> <li>Extreme value removal</li> <li>Equivalent statistics conversion<ul> <li>BETA/SE , OR/OR_95L/OR_95U</li> <li>P, Z, CHISQ, MLOG10P</li> </ul> </li> <li>Customizable value filtering</li> </ul>"},{"location":"#harmonization","title":"Harmonization","text":"<ul> <li>rsID assignment based on CHR, POS, and REF/ALT</li> <li>CHR POS assignment based on rsID using a reference text file</li> <li>Palindromic SNPs and indels strand inference using a reference VCF</li> <li>Check allele frequency discrepancy using a reference VCF</li> <li>Reference allele alignment using a reference genome sequence FASTA file</li> </ul>"},{"location":"#visualization","title":"Visualization","text":"<ul> <li>Mqq plot : Manhattan plot , QQ plot or MQQ plot (with a bunch of customizable features including auto-annotate nearest gene names)</li> <li>Miami plot : Manhattan plot</li> <li>Brisbane plot:  GWAS hits density plot</li> <li>Regional plot : GWAS regional plot</li> <li>Heatmap : ldsc-rg genetic correlation matrix</li> <li>Scatter Plot : variant effect size comparison with sumstats</li> <li>Scatter Plot : allele frequency comparison </li> <li>Forest Plot : forest plots for meta-analysis of SNPs</li> </ul>"},{"location":"#visualization-examples","title":"Visualization Examples","text":""},{"location":"#other-utilities","title":"Other Utilities","text":"<ul> <li>Read ldsc h2 or rg outputs directly as DataFrames (auto-parsing).</li> <li>Extract lead variants given a sliding window size.</li> <li>Extract novel loci given a list of known lead variants / or known loci obtained form GWAS Catalog.</li> <li>Logging : keep a complete record of manipulations applied to the sumstats.</li> <li>Sumstats summary: give you a quick overview of the sumstats. </li> <li>...</li> </ul>"},{"location":"#requirements","title":"Requirements","text":"<pre><code>Python &gt;= 3.8\npySAM &gt;0.18,&lt;0.20\npyensembl &gt;=2.2.3\nscikit-allel\nBiopython &gt;= 1.79\nliftover &gt;= 1.1.13\npandas &gt;= 1.3,&lt;1.5\nnumpy &gt;= 1.21.2\nmatplotlib &gt;=3.5\nseaborn &gt;=0.11.1\nscipy &gt;=1.6.2\nstatsmodels &gt; =0.13\nadjustText\n</code></pre>"},{"location":"#how-to-cite","title":"How to cite","text":"<ul> <li>GWASLab preprint: He, Y., Koido, M., Shimmori, Y., Kamatani, Y. (2023). GWASLab: a Python package for processing and visualizing GWAS summary statistics. Preprint at Jxiv, 2023-5. https://doi.org/10.51094/jxiv.370</li> </ul>"},{"location":"#sample-data","title":"Sample Data","text":"<ul> <li>Sample GWAS data used in GWASLab is obtained from: http://jenger.riken.jp/ (Suzuki, Ken, et al. \"Identification of 28 new susceptibility loci for type 2 diabetes in the Japanese population.\" Nature genetics 51.3 (2019): 379-386.).</li> </ul>"},{"location":"#contacts","title":"Contacts","text":"<ul> <li>Github: https://github.com/Cloufield/gwaslab</li> <li>Blog (in Chinese): https://gwaslab.com/</li> <li>Email: gwaslab@gmail.com</li> <li>Stats: https://pypistats.org/packages/gwaslab</li> </ul>"},{"location":"AlleleFrequency/","title":"Allele Frequency Comparison","text":"<p>Scatter &amp; Distribution plot : allele frequency comparison</p> <p>Available from v3.4.15</p> <pre><code>#check the difference between the EAF in the sumstats and the allele frequency in VCF files\nsumstats.check_af()\n\n#allele frequnecy correlation plot\nsumstats.plot_daf()\n</code></pre> <p>You need to run 'check_af()' first before plotting. For check_af(), see here.</p> <p>Options for <code>plot_daf</code>: <code>threshold</code>: <code>float</code>, the threshold used to determine outliers.</p> <p>Example</p> <p><pre><code>mysumstats = gl.Sumstats(\"t2d_bbj.txt.gz\",\n             snpid=\"SNP\",\n             chrom=\"CHR\",\n             pos=\"POS\",\n             ea=\"ALT\",\n             nea=\"REF\",\n             neaf=\"Frq\",\n             beta=\"BETA\",\n             se=\"SE\",\n             p=\"P\",\n             direction=\"Dir\",\n             n=\"N\",nrows=10000)\n\n# harmonize\nmysumstats.harmonize(basic_check = True, \n                     ref_seq=gl.get_path(\"ucsc_genome_hg19\"))\n</code></pre> </p> <p><pre><code># check the difference in allele frequency with reference vcf\nmysumstats.check_af(ref_infer=gl.get_path(\"1kg_eas_hg19\"), \n                    ref_alt_freq=\"AF\",\n                    n_cores=2)\n</code></pre> </p> <p><pre><code>plot and get the outliers\noutliers = mysumstats.plot_daf(threshold=0.12, \n                                save=\"af_correlation.png\",\n                                save_args={\"dpi\":300})\n</code></pre> </p> <p><pre><code>outliers[1]\n</code></pre> </p>"},{"location":"AssignCHRPOS/","title":"Assigning CHR/POS","text":"<p>GWASLab can update CHR/POS using a pre-processed SNPID-rsID table to assign CHR and POS based on rsID. Currently, only variants in 1KG phase3v5 are supported.  </p> <p>GWASLab provides a download function <code>gl.download_ref()</code> and two curated tables which contains ~80M 1KG variants:</p> <ul> <li><code>hg19</code> : <code>gl.download_ref(\"1kg_dbsnp151_hg19_auto\")</code></li> <li><code>hg38</code> : <code>gl.download_ref(\"1kg_dbsnp151_hg38_auto\")</code></li> </ul> <p>Reference data</p> <p>1kg_dbsnp151_hg19_auto</p> <pre><code>~/.gwaslab$ zcat 1kg_dbsnp151_hg19_auto.txt.gz |head\nSNPID   rsID    CHR     POS     NEA     EA\n1:10177:A:AC    rs367896724     1       10177   A       AC\n1:10235:T:TA    rs540431307     1       10235   T       TA\n1:10352:T:TA    rs555500075     1       10352   T       TA\n1:10505:A:T     rs548419688     1       10505   A       T\n1:10511:G:A     rs534229142     1       10511   G       A\n1:10539:C:A     rs537182016     1       10539   C       A\n1:10542:C:T     rs572818783     1       10542   C       T\n1:10579:C:A     rs538322974     1       10579   C       A\n1:10616:CCGCCGTTGCAAAGGCGCGCCG:C        rs376342519     1       10616   CCGCCGTTGCAAAGGCGCGCCG  C\n</code></pre>"},{"location":"AssignCHRPOS/#usage","title":"Usage","text":"<pre><code># if not downloaded yet :\n# gl.download_ref(\"1kg_dbsnp151_hg19_auto\")\n\n# assign chr and pos using rsID\nmysumstats.rsid_to_chrpos( path = gl.get_path(\"1kg_dbsnp151_hg19_auto\"))\n</code></pre> <p>Assign CHR and POS using rsID</p> <pre><code>mysumstats.data\n\nEA  NEA EAF BETA    SE  P   N   DIRECTION   STATUS  rsID\n0   G   A   0.9960  -0.0737 0.1394  0.59700 166718  -?+-    9960099 rs565766235\n1   G   A   0.0040  0.0737  0.1394  0.59730 166718  +?-+    9960099 rs534711480\n2   C   T   0.0051  0.0490  0.1231  0.69080 166718  +?-+    9960099 rs540210562\n3   TAA T   0.8374  0.0213  0.0199  0.28460 166718  -?++    9960399 rs529266287\n4   T   A   0.8593  0.0172  0.0156  0.27050 166718  -?++    9960099 rs28544273\n... ... ... ... ... ... ... ... ... ... ...\n9995    C   T   0.1292  -0.0350 0.0191  0.06686 191764  ----    9960099 rs55938238\n9996    C   T   0.4886  -0.0014 0.0094  0.88070 191764  -0+-    9960099 rs7520225\n9997    C   T   0.9476  -0.0061 0.0216  0.77790 191764  ---+    9960099 rs151238770\n9998    C   CT  0.9418  -0.0047 0.0199  0.81500 191764  ---+    9960399 rs137909285\n9999    G   A   0.9828  -0.0084 0.0433  0.84620 191764  +--+    9960099 rs77575110\n\n\nmysumstats.rsid_to_chrpos(path=gl.get_path(\"1kg_dbsnp151_hg19_auto\"))\n\nFri Jan 27 00:06:24 2023 Start to update chromosome and position information based on rsID...\nFri Jan 27 00:06:24 2023  -Current Dataframe shape : 10000  x  10\nFri Jan 27 00:06:24 2023  -rsID dictionary file: /home/he/.gwaslab/1kg_dbsnp151_hg19_auto.txt.gz\nFri Jan 27 00:06:24 2023  -Setting block size:  10000000\nFri Jan 27 00:06:24 2023  -Loading block: 0   1   2   3   4   5   6   7   \nFri Jan 27 00:11:44 2023  -Updating CHR and POS finished.Start to re-fixing CHR and POS... \nFri Jan 27 00:11:44 2023 Start to fix chromosome notation...\nFri Jan 27 00:11:44 2023  -Current Dataframe shape : 10000  x  12\nFri Jan 27 00:11:45 2023  -Variants with standardized chromosome notation: 9942\nFri Jan 27 00:11:45 2023  -Variants with fixable chromosome notations: 0\nFri Jan 27 00:11:45 2023  -Variants with NA chromosome notations: 58\nFri Jan 27 00:11:45 2023  -No unrecognized chromosome notations...\nFri Jan 27 00:11:46 2023 Finished fixing chromosome notation successfully!\nFri Jan 27 00:11:46 2023 Start to fix basepair positions...\nFri Jan 27 00:11:46 2023  -Current Dataframe shape : 10000  x  12\nFri Jan 27 00:11:46 2023  -Converting to Int64 data type ...\nFri Jan 27 00:11:46 2023  -Position upper_bound is: 250,000,000\nFri Jan 27 00:11:46 2023  -Remove outliers: 0\nFri Jan 27 00:11:46 2023  -Converted all position to datatype Int64.\nFri Jan 27 00:11:46 2023 Finished fixing basepair position successfully!\n\nmysumstats.data\n\nrsID    EA  NEA EAF BETA    SE  P   N   DIRECTION   STATUS  CHR POS\n0   rs565766235 G   A   0.9960  -0.0737 0.1394  0.59700 166718  -?+-    9960099 1   725932\n1   rs534711480 G   A   0.0040  0.0737  0.1394  0.59730 166718  +?-+    9960099 1   725933\n2   rs540210562 C   T   0.0051  0.0490  0.1231  0.69080 166718  +?-+    9960099 1   737801\n3   rs529266287 TAA T   0.8374  0.0213  0.0199  0.28460 166718  -?++    9960399 1   749963\n4   rs28544273  T   A   0.8593  0.0172  0.0156  0.27050 166718  -?++    9960099 1   751343\n... ... ... ... ... ... ... ... ... ... ... ... ...\n9995    rs55938238  C   T   0.1292  -0.0350 0.0191  0.06686 191764  ----    9960099 1   3142135\n9996    rs7520225   C   T   0.4886  -0.0014 0.0094  0.88070 191764  -0+-    9960099 1   3142137\n9997    rs151238770 C   T   0.9476  -0.0061 0.0216  0.77790 191764  ---+    9960099 1   3142161\n9998    rs137909285 C   CT  0.9418  -0.0047 0.0199  0.81500 191764  ---+    9960399 1   3142212\n9999    rs77575110  G   A   0.9828  -0.0084 0.0433  0.84620 191764  +--+    9960099 1   3142762\n</code></pre>"},{"location":"AssignrsID/","title":"Assigning rsID","text":"<p>GWASLab uses a two-step strategy (both steps are optional).</p> <ul> <li>For quick annotation, GWASLab iterates over a SNPID-rsID table and assign rsID by joining on SNPID (CHR:POS:REF:ALT) with sumstats. GWASLab provides a curated table  (1KG autosome variants). </li> <li>For full annotation, GWASLab will query a large reference VCF file (dbSNP for example, &gt;20GB ) by CHR, POS, NEA, EA. It will assign the ID in VCF file to sumstats if the CHR, POS and EN/NEA matches.</li> </ul>"},{"location":"AssignrsID/#reference-data","title":"Reference data","text":""},{"location":"AssignrsID/#snpid-rsid-table","title":"SNPID-rsID table","text":"<p>GWASLab provides a download function <code>gl.download_ref()</code> and two curated tables which contains ~80M 1KG variants:</p> <ul> <li><code>hg19</code> : <code>gl.download_ref(\"1kg_dbsnp151_hg19_auto\")</code></li> <li><code>hg38</code> : <code>gl.download_ref(\"1kg_dbsnp151_hg38_auto\")</code></li> </ul>"},{"location":"AssignrsID/#vcf-file","title":"VCF file","text":"<p>You can download this from dbSNP:</p> <p><code>hg19</code></p> <ul> <li><code>vcf</code>:https://ftp.ncbi.nih.gov/snp/latest_release/VCF/GCF_000001405.25.gz</li> <li><code>tbi</code>:https://ftp.ncbi.nih.gov/snp/latest_release/VCF/GCF_000001405.25.gz.tbi</li> </ul> <p><code>hg38</code></p> <ul> <li><code>vcf</code>:https://ftp.ncbi.nih.gov/snp/latest_release/VCF/GCF_000001405.39.gz</li> <li><code>tbi</code>:https://ftp.ncbi.nih.gov/snp/latest_release/VCF/GCF_000001405.39.gz.tbi</li> </ul> <p>1kg_dbsnp151_hg19_auto</p> <pre><code>~/.gwaslab$ zcat 1kg_dbsnp151_hg19_auto.txt.gz |head\nSNPID   rsID    CHR     POS     NEA     EA\n1:10177:A:AC    rs367896724     1       10177   A       AC\n1:10235:T:TA    rs540431307     1       10235   T       TA\n1:10352:T:TA    rs555500075     1       10352   T       TA\n1:10505:A:T     rs548419688     1       10505   A       T\n1:10511:G:A     rs534229142     1       10511   G       A\n1:10539:C:A     rs537182016     1       10539   C       A\n1:10542:C:T     rs572818783     1       10542   C       T\n1:10579:C:A     rs538322974     1       10579   C       A\n1:10616:CCGCCGTTGCAAAGGCGCGCCG:C        rs376342519     1       10616   CCGCCGTTGCAAAGGCGCGCCG  C\n</code></pre> <p>VCF file form dbSNP</p> <pre><code> zcat GCF_000001405.25.vcf.gz | head -100 | tail -10\nNC_000001.10    10059   rs1570391745    C       G       .       .       RS=1570391745;dbSNPBuildID=154;SSR=0;PSEUDOGENEINFO=DDX11L1:100287102;VC=SNV;R5;GNO;FREQ=KOREAN:0.9997,0.0003425|dbGaP_PopFreq:1,0\nNC_000001.10    10060   rs1639544146    C       CT      .       .       RS=1639544146;SSR=0;PSEUDOGENEINFO=DDX11L1:100287102;VC=INDEL;R5;GNO;FREQ=dbGaP_PopFreq:1,0\nNC_000001.10    10060   rs1639544159    CT      C       .       .       RS=1639544159;SSR=0;PSEUDOGENEINFO=DDX11L1:100287102;VC=DEL;R5;GNO;FREQ=dbGaP_PopFreq:1,0\nNC_000001.10    10063   rs1010989343    A       C,G     .       .       RS=1010989343;dbSNPBuildID=150;SSR=0;PSEUDOGENEINFO=DDX11L1:100287102;VC=SNV;R5;GNO;FREQ=KOREAN:0.9928,0.004112,0.003084|Siberian:0.5,0.5,.|dbGaP_PopFreq:1,.,0\nNC_000001.10    10067   rs1489251879    T       TAACCCTAACCCTAACCCTAACCCTAACCCTAACCCTAACCC      .       .       RS=1489251879;dbSNPBuildID=151;SSR=0;PSEUDOGENEINFO=DDX11L1:100287102;VC=INDEL;R5;GNO;FREQ=GnomAD:1,1.789e-05\nNC_000001.10    10067   rs1639545042    T       C       .       .       RS=1639545042;SSR=0;PSEUDOGENEINFO=DDX11L1:100287102;VC=SNV;R5;GNO;FREQ=dbGaP_PopFreq:1,0\nNC_000001.10    10067   rs1639545104    TA      T       .       .       RS=1639545104;SSR=0;PSEUDOGENEINFO=DDX11L1:100287102;VC=INDEL;R5;GNO;FREQ=dbGaP_PopFreq:1,0\nNC_000001.10    10068   rs1639545079    A       T       .       .       RS=1639545079;SSR=0;PSEUDOGENEINFO=DDX11L1:100287102;VC=SNV;R5;GNO;FREQ=dbGaP_PopFreq:1,0\nNC_000001.10    10069   rs1570391755    A       C,G     .       .       RS=1570391755;dbSNPBuildID=154;SSR=0;PSEUDOGENEINFO=DDX11L1:100287102;VC=SNV;R5;GNO;FREQ=KOREAN:0.9966,.,0.003425|dbGaP_PopFreq:1,0,0\nNC_000001.10    10069   rs1639545200    A       AC      .       .       RS=1639545200;SSR=0;PSEUDOGENEINFO=DDX11L1:100287102;VC=INDEL;R5;GNO;FREQ=dbGaP_PopFreq:1,0\n</code></pre>"},{"location":"AssignrsID/#usage","title":"Usage","text":"<pre><code>mysumstats.basic_check()\nmysumstats.assign_rsid( \n                        ref_rsid_tsv = gl.get_path(\"1kg_dbsnp151_hg19_auto\"),\n                        ref_rsid_vcf = \"/home/yunye/mydata/d_disk/dbsnp/GCF_000001405.25.vcf.gz\",\n                        chr_dict = gl.get_number_to_NC(build=\"19\"),\n                        n_cores = 2)\n</code></pre> <p>Note</p> <p>Please always run <code>.basic_check()</code> first. This will convert the data to right data type, standardize and normalize the sumstats.</p>"},{"location":"AssignrsID/#options","title":"Options","text":"<ul> <li><code>ref_rsid_tsv</code> : tsv file for annotation of common used variants. Using SNPID (like 1:725932:G:A)</li> <li><code>ref_rsid_vcf</code> : vcf file for annotation of other variants.</li> <li><code>chr_dict</code>: a dictionary for to convert 1-25 to CHR in vcf files. For example, the notation in dbSNP vcf file is based on RefSeq (like NC_000001.10). <code>gwaslab</code> provides built-in conversion dictionaries.   <code>gl.get_number_to_NC(build=\"19\")</code> and <code>gl.get_number_to_NC(build=\"19\")</code></li> <li><code>n_cores</code>: number of cores to use.</li> </ul> <p>Conversion for RefSeq sequence</p> <pre><code>gl.get_number_to_NC(build=\"19\")\n{1: 'NC_000001.10',\n 2: 'NC_000002.11',\n 3: 'NC_000003.11',\n 4: 'NC_000004.11',\n 5: 'NC_000005.9',\n 6: 'NC_000006.11',\n 7: 'NC_000007.13',\n 8: 'NC_000008.10',\n 9: 'NC_000009.11',\n 10: 'NC_000010.10',\n 11: 'NC_000011.9',\n 12: 'NC_000012.11',\n 13: 'NC_000013.10',\n 14: 'NC_000014.8',\n 15: 'NC_000015.9',\n 16: 'NC_000016.9',\n 17: 'NC_000017.10',\n 18: 'NC_000018.9',\n 19: 'NC_000019.9',\n 20: 'NC_000020.10',\n 21: 'NC_000021.8',\n 22: 'NC_000022.10',\n 23: 'NC_000023.10',\n 24: 'NC_000024.9',\n 25: 'NC_012920.1'}\n\ngl.get_number_to_NC(build=\"19\")\n{1: 'NC_000001.11',\n 2: 'NC_000002.12',\n 3: 'NC_000003.12',\n 4: 'NC_000004.12',\n 5: 'NC_000005.10',\n 6: 'NC_000006.12',\n 7: 'NC_000007.14',\n 8: 'NC_000008.11',\n 9: 'NC_000009.12',\n 10: 'NC_000010.11',\n 11: 'NC_000011.10',\n 12: 'NC_000012.12',\n 13: 'NC_000013.11',\n 14: 'NC_000014.9',\n 15: 'NC_000015.10',\n 16: 'NC_000016.10',\n 17: 'NC_000017.11',\n 18: 'NC_000018.10',\n 19: 'NC_000019.10',\n 20: 'NC_000020.11',\n 21: 'NC_000021.9',\n 22: 'NC_000022.11',\n 23: 'NC_000023.11',\n 24: 'NC_000024.1',\n 25: 'NC_012920.1'}\n</code></pre>"},{"location":"AssignrsID/#example","title":"Example","text":"<p>Example</p> <pre><code># download ref SNPID-rsID table first\ngl.download_ref(\"1kg_dbsnp151_hg19_auto\") \n\n# if you want to annotate as much as possible. Please download the very large dbSNP vcf file.\n\nmysumstats = gl.Sumstats(\"t2d_bbj.txt.gz\",\n             snpid=\"SNP\",\n             chrom=\"CHR\",\n             pos=\"POS\",\n             ea=\"ALT\",\n             nea=\"REF\",\n             neaf=\"Frq\",\n             beta=\"BETA\",\n             se=\"SE\",\n             p=\"P\",\n             direction=\"Dir\",\n             n=\"N\",\n             nrows=10000)\n\n# run basic_check first\nmysumstats.basic_check() \n</code></pre> <p></p> <pre><code># if you SNPID is like 1:725932_G_A , you can use fix_id to fix the separator.\nmysumstats.fix_id(fixsep=True)\n</code></pre> <p></p> <pre><code># rsID annotation\nmysumstats.assign_rsid( n_cores = 2,\n                        ref_rsid_tsv = gl.get_path(\"1kg_dbsnp151_hg19_auto\"),\n                        ref_rsid_vcf =\"/home/yunye/mydata/d_disk/dbsnp/GCF_000001405.25.vcf.gz\",\n                        chr_dict = gl.get_number_to_NC(build=\"19\"))\n</code></pre> <pre><code>Wed Jan 11 20:05:38 2023 Start to annotate rsID based on chromosome and position information...\nWed Jan 11 20:05:38 2023  -Current Dataframe shape : 10000  x  12\nWed Jan 11 20:05:38 2023  -SNPID-rsID text file: /home/yunye/.gwaslab/1kg_dbsnp151_hg19_auto.txt.gz\nWed Jan 11 20:05:38 2023  -10000 rsID could be possibly fixed...\nWed Jan 11 20:05:38 2023  -Setting block size:  5000000\nWed Jan 11 20:05:38 2023  -Loading block: 0   1   2   3   4   5   6   7   8   9   10   11   12   13   14   15   \nWed Jan 11 20:10:16 2023  -rsID Annotation for 58 need to be fixed!\nWed Jan 11 20:10:16 2023  -Annotated 9942 rsID successfully!\nWed Jan 11 20:10:16 2023 Start to assign rsID using vcf...\nWed Jan 11 20:10:16 2023  -Current Dataframe shape : 10000  x  13\nWed Jan 11 20:10:16 2023  -CPU Cores to use : 2\nWed Jan 11 20:10:16 2023  -Reference VCF file: /home/yunye/mydata/d_disk/dbsnp/GCF_000001405.25.vcf.gz\nWed Jan 11 20:10:16 2023  -Assigning rsID based on chr:pos and ref:alt/alt:ref...\nWed Jan 11 20:10:17 2023  -rsID Annotation for 1 need to be fixed!\nWed Jan 11 20:10:17 2023  -Annotated 57 rsID successfully!\n</code></pre> <p>As you can see, SNPID-rsID (<code>1kg_dbsnp151_hg19_auto</code>) annotated 9942 rsID and the large reference VCF file (from dbSNP) annotated additonal 57 rare rsID.</p> <p></p>"},{"location":"BrisbanePlot/","title":"Brisbane plot","text":""},{"location":"BrisbanePlot/#gwas-signal-density-plot","title":"GWAS signal density plot","text":"<p>GWASLab can create the Brisbane plot (GWAS signal density plot; See the citation). Brisbane plot is a scatter plot that shows the signal density, very useful for presenting large-scale GWAS data.  </p> <pre><code>mysumstats.plot_mqq(mode=\"b\")\n</code></pre> <ul> <li><code>mode=\"b\"</code> : create Brisbane plot !</li> <li><code>bwindowsizekb = 100</code> : windowsize in kb.</li> </ul> <p>See examples here.</p> <p>Brisbane plot</p> <p>Data was obtained from : Yengo, L., Vedantam, S., Marouli, E., Sidorenko, J., Bartell, E., Sakaue, S., ... &amp; Lee, J. Y. (2022). A saturated map of common genetic variants associated with human height. Nature, 1-16.</p> <pre><code>mysumstats = gl.Sumstats(\"height_lead.tsv\",\n             snpid=\"SNP\",\n             chrom=\"Chr\",\n             pos=\"BP_HG19\",\n             p=\"P-value\")\n\nmysumstats.plot_mqq(mode=\"b\",anno=\"GENENAME\",\n                  build=\"19\",anno_fixed_arm_length=2,\n                  anno_args={\"rotation\":90},\n                  marker_size=(30,30),sig_line_color=\"red\")\n</code></pre> <p></p>"},{"location":"BrisbanePlot/#calculate-the-density-for-sumstats","title":"Calculate the density for sumstats","text":"<pre><code>mysumstats.get_density(windowsizekb=100)\n</code></pre> <ul> <li><code>windowsizekb</code>: window size for calculation of signal density.</li> </ul> <p>Calculate signal density</p> <pre><code>mysumstats.get_density(windowsizekb=100)\n\nmysumstats.data\n    SNPID   CHR POS P   STATUS  DENSITY\n0   rs2710888   1   959842  2.190000e-57    9999999 1\n1   rs3934834   1   1005806 2.440000e-29    9999999 1\n2   rs182532    1   1287040 1.250000e-18    9999999 1\n3   rs17160669  1   1305561 1.480000e-28    9999999 1\n4   rs9660106   1   1797947 1.860000e-12    9999999 0\n... ... ... ... ... ... ...\n12106   rs9628283   22  50540766    5.130000e-15    9999999 1\n12107   rs28642259  22  50785718    1.140000e-13    9999999 1\n12108   rs11555194  22  50876662    2.000000e-15    9999999 2\n12109   rs762669    22  50943423    3.000000e-30    9999999 1\n12110   rs9628185   22  51109992    5.430000e-12    9999999 0\n</code></pre>"},{"location":"BrisbanePlot/#reference","title":"Reference","text":"<p>Citation for Brisbane plot</p> <p>Yengo, L., Vedantam, S., Marouli, E., Sidorenko, J., Bartell, E., Sakaue, S., ... &amp; Lee, J. Y. (2022). A saturated map of common genetic variants associated with human height. Nature, 1-16.</p>"},{"location":"CommonData/","title":"Commonly used data in GWASLab","text":"<p>GWASLab integrates a few pre-defined datasets for quick conversion and access, which are used in the functions of GWASLab.</p>"},{"location":"CommonData/#chromosme-notation-conversion-dictionary","title":"Chromosme notation conversion dictionary","text":"<ul> <li><code>get_chr_list()</code> : get a full list of chromosomes</li> <li>chr/ number &lt;-&gt; NC dictionary<ul> <li><code>get_chr_to_NC(build)</code> : </li> <li><code>get_number_to_NC(build)</code></li> <li><code>get_NC_to_chr(build)</code></li> <li><code>get_NC_to_number(build)</code></li> </ul> </li> <li>chr &lt;-&gt; number </li> <li><code>get_chr_to_number()</code></li> <li><code>get_number_to_chr()</code></li> </ul>"},{"location":"CommonData/#high-ld-region-bed","title":"High-LD region bed","text":"<ul> <li><code>get_high_ld(build)</code></li> </ul>"},{"location":"CommonData/#sumstats-format-list","title":"Sumstats Format list","text":"<ul> <li><code>get_format_dict(fmt)</code></li> <li><code>get_formats_list()</code></li> </ul>"},{"location":"CommonData/#gene-gtf","title":"Gene GTF","text":"<ul> <li><code>get_gtf(chrom, build=\"19\",source=\"ensembl\")</code></li> </ul>"},{"location":"Conversion/","title":"Statistics conversion","text":"<p>GWASLab can convert equvalent statistics, including:</p> Target stats Original stats Implementation MLOG10P P <code>sumstats[\"MLOG10P\"] = -np.log10(sumstats[\"P\"])</code> P MLOG10P <code>sumstats[\"P\"] = np.power(10,-sumstats[\"MLOG10P\"])</code> P Z <code>sumstats[\"P\"] = ss.norm.sf(np.abs(sumstats[\"Z\"])) * 2</code> P CHISQ <code>sumstats[\"P\"] = ss.chi2.sf(sumstats[\"CHISQ\"], 1)</code> OROR_95LOR_95U BETASE <code>sumstats[\"OR\"]   = np.exp(sumstats[\"BETA\"])</code>,  <code>sumstats[\"OR_95L\"] = np.exp(sumstats[\"BETA\"]-ss.norm.ppf(0.975)*sumstats[\"SE\"])</code>,  <code>sumstats[\"OR_95U\"] = np.exp(sumstats[\"BETA\"]+ss.norm.ppf(0.975)*sumstats[\"SE\"])</code> BETA  SE OR OR_95LOR_95U <code>sumstats[\"BETA\"]  = np.log(sumstats[\"OR\"])</code>,  <code>sumstats[\"SE\"]=(np.log(sumstats[\"OR\"]) - np.log(sumstats[\"OR_95L\"]))/ss.norm.ppf(0.975)</code>,  <code>sumstats[\"SE\"]=(np.log(sumstats[\"OR_95U\"]) - np.log(sumstats[\"OR\"]))/ss.norm.ppf(0.975)</code> Z BETA/SE <code>sumstats[\"Z\"] = sumstats[\"BETA\"]/sumstats[\"SE\"]</code> CHISQ P <code>sumstats[\"CHISQ\"] = ss.chi2.isf(sumstats[\"P\"], 1)</code> CHISQ Z <code>sumstats[\"CHISQ\"] = (sumstats[\"Z\"])**2</code> MAF EAF <code>sumstats[\"MAF\"] =  sumstats[\"EAF\"].apply(lambda x: min(x,1-x) if pd.notnull(x) else np.nan)</code> <p>Note</p> <p>The conversion is implemented using scipy and numpy.</p> <ul> <li>ss : <code>import scipy.stats as ss</code></li> <li>np : <code>import numpy as np</code></li> </ul> <p>See examples here.</p>"},{"location":"Conversion/#fill_data","title":"fill_data()","text":"<pre><code>mysumstats.fill_data( \n    to_fill=[],\n    df=None,\n    overwrite=False,\n    only_sig=False\n    )\n</code></pre>"},{"location":"Conversion/#options","title":"Options","text":"<ul> <li><code>to_fill</code>: the columns to fill. [\"OR\",\"OR_95L\",\"OR_95U\",\"BETA\",\"SE\",\"P\",\"MLOG10P\",\"Z\",\"CHISQ\"]</li> <li><code>df</code> : columns name for degree of freedom</li> <li><code>overwrite</code>: if overwrite when the specified column existed</li> <li><code>only_sig</code> : fill the data only for significant variants</li> </ul>"},{"location":"Conversion/#priority","title":"Priority","text":"<ul> <li>For P : using MLOG10P, Z, CHISQ </li> <li>For MLOG10P : using P, MLOG10P, Z, CHISQ </li> <li>For BETA/SE : using OR/OR_95L/OR_95U</li> <li>For OR/OR_95L/OR_95U : using BETA/SE</li> <li>For Z : using BETA/SE</li> <li>For CHISQ : using  Z, P</li> </ul>"},{"location":"Conversion/#example","title":"Example","text":"<p>Example</p> <pre><code># raw data\n#SNPID  CHR POS EA  NEA EAF BETA    SE  P   STATUS\n#1:725932_G_A   1   725932  G   A   0.9960  -0.0737 0.1394  0.5970  9999999\n#1:725933_A_G   1   725933  G   A   0.0040  0.0737  0.1394  0.5973  9999999\n#1:737801_T_C   1   737801  C   T   0.0051  0.0490  0.1231  0.6908  9999999\n\n# let's fill \"MLOG10P\",\"Z\",\"OR\",\"OR_95L\",\"OR_95U\"\n# gwaslab will automatically search for equivalent statistics\n\nmysumstats.fill_data(to_fill=[\"MLOG10P\",\"Z\",\"OR\",\"OR_95L\",\"OR_95U\"])\n\nWed Oct 19 10:13:30 2022 Start filling data using existing columns...\nWed Oct 19 10:13:30 2022  -Raw input columns:  ['SNPID', 'CHR', 'POS', 'EA', 'NEA', 'EAF', 'BETA', 'SE', 'P', 'STATUS']\nWed Oct 19 10:13:30 2022  -Overwrite mode:  False\nWed Oct 19 10:13:30 2022   - Skipping columns:  []\nWed Oct 19 10:13:30 2022 Filling columns:  ['MLOG10P', 'OR', 'OR_95L', 'OR_95U']\nWed Oct 19 10:13:30 2022   - Filling OR using BETA column...\nWed Oct 19 10:13:31 2022   - Filling OR_95L/OR_95U using BETA/SE columns...\nWed Oct 19 10:13:32 2022   - Filling MLOG10P using P column...\nWed Oct 19 10:13:38 2022 Finished filling data using existing columns.\n</code></pre> <p>For more examples: Utility_data_conversion</p>"},{"location":"Download/","title":"Download reference data","text":""},{"location":"Download/#downloading-and-file-management-system","title":"Downloading and file management system","text":"functions options description <code>gl.check_available_ref()</code> list current available reference data GWASLab can use <code>gl.check_downloaded_ref()</code> list downloaded reference data <code>gl.download_ref(keyword)</code> keyword download the refernce data <code>gl.remove_file(keyword)</code> keyword remove the downloaded data <code>gl.get_path(keyword)</code> keyword get the path to the refernce data <p>Currently, you can download the following files using GWASLab with the keywords:</p> <p>Processed datasets are currently hosted on Dropbox which may not be accessible for users in certain regions.</p> Keyword Description Note '1kg_eas_hg19','1kg_eas_hg19_tbi' 1KGp3v5 low-coverage EAS VCF and index (hg19) Processed, Dropbox '1kg_eur_hg19','1kg_eur_hg19_tbi' 1KGp3v5 low-coverage EUR VCF and index (hg19) Processed, Dropbox '1kg_eas_hg38','1kg_eas_hg38_tbi' 1KGp3v5 30x EAS VCF and index (hg38) Processed, Dropbox '1kg_eur_hg38','1kg_eur_hg38_tbi' 1KGp3v5 30x EUR VCF and index (hg38) Processed, Dropbox 'dbsnp_v151_hg19' dbSNP151 (hg19, !!very large) Original source 'dbsnp_v151_hg38' dbSNP151 (hg38, !!very large) Original source 'ucsc_genome_hg19' UCSC human reference genome (hg19) Original source 'ucsc_genome_hg38' UCSC human reference genome (hg38) Original source '1kg_dbsnp151_hg19_auto' 1KGp3v5 variants SNPID-rsID conversion table (hg19) Processed, Dropbox '1kg_dbsnp151_hg38_auto' 1KGp3v5 variants SNPID-rsID conversion table (hg38) Processed, Dropbox 'recombination_hg19' Recombination rate reference files from Hapmap Project (hg19) Processed, Dropbox 'recombination_hg38' Recombination rate reference files from Hapmap Project (hg38) Processed, Dropbox 'ensembl_hg19_gtf' GTF file for genes from Ensembl (hg19) Original source 'ensembl_hg38_gtf' GTF file for genes from Ensembl (hg38) Original source 'refseq_hg19_gtf' GTF file for genes from Refseq (hg19) Original source 'refseq_hg38_gtf' GTF file for genes from Refseq (hg19) Original source"},{"location":"Download/#configurations","title":"Configurations","text":"<p>GWASLab uses 3 files and a default path for reference management:</p> <ul> <li><code>config</code> : a dictionary of <code>keyword</code>:<code>local path</code> for local file management.</li> <li><code>reference</code> : a dictionary of <code>keyword</code>:<code>url</code> for automatically downloading reference files.</li> <li><code>formatbook</code> : a dictionary used for format header conversions. </li> <li><code>data_directory</code>: the path for downloaded reference file. default: (<code>~/.gwaslab</code>)</li> </ul> <p>You can use <code>gl.options.paths</code> to check the paths of the three files.</p> <pre><code>gl.options.paths\n{'config': '/Users/he/work/gwaslab/src/gwaslab/data/config.json',\n 'reference': '/Users/he/work/gwaslab/src/gwaslab/data/reference.json',\n 'formatbook': '/Users/he/work/gwaslab/src/gwaslab/data/formatbook.json',\n 'data_directory': '/Users/he/.gwaslab/'}\n</code></pre> <p>Sometimes you might need to use your own files, which can be done using <code>gl.options.set_option(key, newpath)</code> (simply run this after loadnig the gwaslab package):</p> <pre><code># change the path for formatbook\n\ngl.options.set_option(\"formatbook\",\"/newpath/formatbook.json\")\ngl.options.paths\n{'config': '/Users/he/work/gwaslab/src/gwaslab/data/config.json',\n 'reference': '/Users/he/work/gwaslab/src/gwaslab/data/reference.json',\n 'formatbook': '/newpath/formatbook.json',\n 'data_directory': '/Users/he/.gwaslab/'}\n</code></pre>"},{"location":"EffectSize/","title":"Comparing effect sizes","text":""},{"location":"EffectSize/#scatter-plot-effect-size-comparison","title":"Scatter plot : effect size comparison","text":"<p><code>gl.compare_effect()</code> will plot effect size comparison plot using two sets of sumstats. Alleles will be aligned to effect alleles in sumstats1.</p> <pre><code>gl.compare_effect (path1,\n                   cols_name_list_1, effect_cols_list_1,\n                   path2,\n                   cols_name_list_2, effect_cols_list_2,\n                   eaf=[],\n                   maf_level=None,\n                   label=[\"Sumstats_1\",\"Sumstats_2\",\"Both\",\"None\"],\n                   snplist=None,\n                   mode=\"beta\",\n                   anno=False,\n                   wc_correction=False, \n                   null_beta=0,\n                   is_q=True,\n                   q_level=0.05,\n                   sig_level=5e-8,\n                   wc_sig_level=5e-8,\n                   reg_box=dict(boxstyle='round', facecolor='white', alpha=1,edgecolor=\"grey\"),\n                   is_reg=True,\n                   r2_se=False,\n                   is_45_helper_line=True,\n                   legend_title=r'$ P &lt; 5 x 10^{-8}$ in:',\n                   legend_pos='upper left',\n                   scatterargs={\"s\":20},\n                   plt_args={\"figsize\":(8,8),\"dpi\":300},\n                   xylabel_prefix=\"Per-allele effect size in \",\n                   helper_line_args={\"color\":'black', \"linestyle\":'-',\"lw\":1},\n                   fontargs={'fontsize':12},\n                   # 'family':'sans','fontname':'Arial',\n                   errargs={\"ecolor\":\"#cccccc\",\"elinewidth\":1},\n                   sep=[\"\\t\",\"\\t\"],\n                   log = Log(),\n                   verbose=True)\n</code></pre>"},{"location":"EffectSize/#options","title":"Options","text":""},{"location":"EffectSize/#path-and-column","title":"Path and column","text":"<ul> <li><code>path1</code> and <code>path2</code> : the paths to the sumstats.</li> <li><code>cols_name_list_1</code> and <code>cols_name_list_2</code> : list of column names for variants basic information</li> <li><code>effect_cols_list_1</code> and <code>effect_cols_list_1</code> : list of column names for effect size-related columns</li> <li><code>mode</code> : use beta or OR </li> <li>examples:<ul> <li>[snpid,p,ea,nea]        ,[effect,se]</li> <li>[snpid,p,ea,nea,chr,pos],[effect,se]</li> <li>[snpid,p,ea,nea,chr,pos],[OR,OR_l,OR_h]</li> </ul> </li> </ul>"},{"location":"EffectSize/#snplist","title":"Snplist","text":"<ul> <li><code>snplist</code> : optional, specify the variants you want to compare. If None, GWASLab will automatically extract lead variants from both sumstats.</li> </ul>"},{"location":"EffectSize/#filter-by-maf","title":"Filter by maf:","text":"<ul> <li><code>eaf</code> : optional, a list column names for effect allele frequency, in the order of [sumstats1_eaf, sumstats2_eaf]. It is needed when you need to filter by maf using <code>maf_level</code>.</li> <li><code>maf_level</code>: the maf filter for variants. Vairants with maf &lt; maf_level will be removed from comparison.</li> </ul>"},{"location":"EffectSize/#label-and-annotation","title":"Label and annotation","text":"<ul> <li><code>label</code> : a list of labels for the legend , in the order of [\"Sumstats_1\",\"Sumstats_2\",\"Both\",\"None\"].</li> <li><code>anno</code> : if annotate the variants</li> <li><code>sig_level</code>: the significance level for auto-extracting lead variants.</li> <li><code>legend_title</code>: r'$ P &lt; 5 x 10^{-8}$ in:',</li> <li><code>legend_pos</code>: legend position, default: 'upper left'</li> <li><code>xylabel_prefix</code> : \"Per-allele effect size in \"</li> <li><code>is_reg</code> : draw regression line or not</li> <li><code>is_45_helper_line</code>: draw 45 degree line or not</li> </ul>"},{"location":"EffectSize/#heterogeneity-test","title":"Heterogeneity test","text":"<ul> <li><code>is_q</code> : if apply the heterogeneity tests by Cochran's Q test.</li> <li><code>q_level</code> : the significance threshold for Cochran's Q test.</li> </ul>"},{"location":"EffectSize/#r2-se","title":"R2 SE","text":"<ul> <li><code>r2_se</code>: <code>boolean</code> If True, SE for r2 will be estimated using the jackknife method.</li> </ul> \\[ s.e.(\\hat{r^2}_{jack}) = \\sqrt{ {{n-1}\\over{n}} \\sum_{i=1}^n(\\hat{r^2_i} -\\bar{r^2}_{jack} )^2 } \\]"},{"location":"EffectSize/#example","title":"Example:","text":"<p>Male-specific and female-specific BMI Sumstats from JENGER</p> <pre><code>!wget -O bbj_bmi_male.txt.gz http://jenger.riken.jp/2analysisresult_qtl_download/\n!wget -O bbj_bmi_female.txt.gz http://jenger.riken.jp/4analysisresult_qtl_download/\n\nHeaders of the files : # SNP    CHR POS REF ALT Frq Rsq BETA    SE  P\n</code></pre> <p><pre><code># GWASLab will automatically extract significant variants from both sumstats. \na = gl.compare_effect(\"bbj_bmi_female.txt.gz\",\n                      [\"SNP\",\"P\",\"REF\",\"ALT\",\"CHR\",\"POS\"],[\"BETA\",\"SE\"],\n                      \"bbj_bmi_male.txt.gz\",\n                      [\"SNP\",\"P\",\"REF\",\"ALT\",\"CHR\",\"POS\"],[\"BETA\",\"SE\"],\n                      label=[\"Female\",\"Male\",\"Both\",\"None\"],\n                      xylabel_prefix=\"Per-allele effect size for \",\n                      sig_level=5e-6,\n                      legend_title=r'$ P &lt; 5 x 10^{-6}$ in:',\n                      verbose=True)\n</code></pre> </p> <p>Reference: Akiyama, M., Okada, Y., Kanai, M., Takahashi, A., Momozawa, Y., Ikeda, M., ... &amp; Kamatani, Y. (2017). Genome-wide association study identifies 112 new loci for body mass index in the Japanese population. Nature genetics, 49(10), 1458-1467.</p>"},{"location":"ExtractLead/","title":"Extract lead variants","text":"<p>GWASLab can extract the lead variants from identified significant loci using a sliding window.</p>"},{"location":"ExtractLead/#usage","title":"Usage","text":"<pre><code>mysumstats.get_lead(\n           windowsizekb=500,\n           sig_level=5e-8,\n           anno=False,\n           build=\"19\",\n           source=\"ensembl\",\n           verbose=True)\n</code></pre> <p>Quote</p> <p>GWASLab basically adopted the definition for novel loci from Global Biobank Meta-analysis Initiative flagship paper. </p> <p>\"We defined genome-wide significant loci by iteratively spanning the \u00b1500 kb region around the most significant variant and merging overlapping regions until no genome-wide significant variants were detected within \u00b11 Mb.\" </p> <p>(Details are described in Zhou, W., Kanai, M., Wu, K. H. H., Rasheed, H., Tsuo, K., Hirbo, J. B., ... &amp; Study, C. O. H. (2022). Global Biobank Meta-analysis Initiative: Powering genetic discovery across human disease. Cell Genomics, 2(10), 100192. )</p> <p>GWASlab currently iteratively extends \u00b1 <code>windowsizekb</code> kb region around the most significant variant and merges overlapping regions until no genome-wide significant variants were detected within \u00b1 <code>windowsizekb</code>. (slightly different from the GBMI paper. When <code>windowsizekb=1000</code>, it is equvalent to GBMI's definition.)</p>"},{"location":"ExtractLead/#options","title":"Options","text":"<ul> <li><code>windowsizekb</code> : <code>int</code>. Specify the sliding window size in kb (default: <code>500</code>)</li> <li><code>sig_level</code> : <code>float</code>.Specify the P value threshold (default: <code>5e-8</code>).</li> <li><code>anno</code>: <code>boolean</code>. If annotate the lead variants with nearest gene names.</li> <li><code>source</code>: <code>ensembl</code> or <code>refseq</code>. When anno is True, annotate variants using gtf file from <code>ensembl</code> or <code>refseq</code> (default: <code>ensembl</code>). </li> <li><code>build</code> : <code>string</code>. genome build version \"19\" or \"38\".</li> </ul> <p>Return a dataframe of the lead variants.</p> <p>Note</p> <p>Please trying running <code>.basic_check()</code> to standardize the sumstats if there are any errors.</p>"},{"location":"ExtractLead/#example","title":"Example","text":"<p>Example</p> <p>Sample sumstats: IS from pheweb.jp https://pheweb.jp/pheno/IS <pre><code>mysumstats = gl.Sumstats(\"./hum0197.v3.BBJ.IS.v1/GWASsummary_IS_Japanese_SakaueKanai2020.auto.txt.gz\",  fmt=\"saige\")\nmysumstats.get_lead()\n</code></pre> </p>"},{"location":"ExtractNovel/","title":"Checking if lead variants are novel or not","text":"<p>GWASLab can check if the lead variants of your summary statistics overlap with reported variants or not based on the physical distance.</p>"},{"location":"ExtractNovel/#get_novel","title":"get_novel()","text":"<pre><code>sumstats.get_novel(\n                    known,\n                    efo,\n                    only_novel=False,\n                    windowsizekb_for_novel=1000,\n                    windowsizekb=500,\n                    sig_level=5e-8,\n                    output_known=False)\n</code></pre> <p>Required (either):</p> <p>GWASLab can check with a local files of variants or query GWASCatalog.</p> <ul> <li><code>known</code> : <code>string</code>, path to local file of reported variants</li> <li><code>efo</code> : <code>string</code>, efo id for the target trait, which is used for querying the GWASCatalog.</li> </ul> <p>Options:</p> <ul> <li><code>sig_level=5e-8</code> : significance threshold for extracting lead variants</li> <li><code>windowsizekb=500</code> : windowsize for extracting lead variants</li> <li><code>windowsizekb_for_novel=1000</code> : windowsize for determining if lead variants overlap with reported variants in GWASCatalog</li> <li><code>only_novel</code>: output only novel variants</li> <li><code>output_known</code>: additionally output the reported variants</li> </ul> <p>EFO ID</p> <p>You can find the efo id by simply searching in GWASCatalog. For example, the EFO ID for T2D can be obtained like:</p> <p></p>"},{"location":"ExtractNovel/#checking-with-gwascatalog-api","title":"Checking with GWAScatalog API","text":"<p>Only works when your sumstats are based on GRCh38</p> <p>Querying the GWAS Catalog</p> <pre><code># sample data\nReference : Suzuki, K., Akiyama, M., Ishigaki, K., Kanai, M., Hosoe, J., Shojima, N., ... &amp; Kadowaki, T. (2019). Identification of 28 new     susceptibility loci for type 2 diabetes in the Japanese population. Nature genetics, 51(3), 379-386.\n!wget -O t2d_bbj.txt.gz http://jenger.riken.jp/14/\n\n# load data and run a basic check\nmysumstats = gl.Sumstats(\"t2d_bbj.txt.gz\",\n             snpid=\"SNP\",\n             chrom=\"CHR\",\n             pos=\"POS\",\n             se=\"SE\",\n             p=\"P\")\nmysumstats.basic_check()\n\n# liftover to grch38 (original sumstats are based on grch37)\nmysumstats.liftover(from_build=\"19\",to_build=\"38\")\n\n# run get_novel with efo id for type 2 diabetes mellitus\nmysumstats.get_novel(efo=\"MONDO_0005148\")\n\nFri Feb  3 12:11:44 2023 Start to check if lead variants are known...\nFri Feb  3 12:11:44 2023 Start to extract lead variants...\nFri Feb  3 12:11:44 2023  -Processing 1035234 variants...\nFri Feb  3 12:11:44 2023  -Significance threshold : 5e-08\nFri Feb  3 12:11:44 2023  -Sliding window size: 500  kb\nFri Feb  3 12:11:44 2023  -Found 9458 significant variants in total...\nFri Feb  3 12:11:45 2023  -Identified 89 lead variants!\nFri Feb  3 12:11:45 2023 Finished extracting lead variants successfully!\nFri Feb  3 12:11:45 2023 Start to retrieve data from GWASCatalog...\nFri Feb  3 12:11:45 2023  -Requesting (GET) trait information through the GWASCatalog API...\nFri Feb  3 12:11:45 2023  -EFO trait api: https://www.ebi.ac.uk/gwas/rest/api/efoTraits/MONDO_0005148\nFri Feb  3 12:11:46 2023  -Trait Name: type 2 diabetes mellitus\nFri Feb  3 12:11:46 2023  -Trait URL: http://purl.obolibrary.org/obo/MONDO_0005148\nFri Feb  3 12:11:46 2023  -Requesting (GET) GWAS associations through the GWASCatalog API...\nFri Feb  3 12:11:46 2023  -associationsByTraitSummary API: https://www.ebi.ac.uk/gwas/rest/api/efoTraits/MONDO_0005148/associations?    projection=associationByEfoTrait\nFri Feb  3 12:11:46 2023  -Note: this step might take a while...\nFri Feb  3 12:18:55 2023  -Status code 200 OK: Retrieved data from GWASCatalog successffully ...\nFri Feb  3 12:18:55 2023  -Loading json ...\nFri Feb  3 12:18:58 2023  -Parsing json ...\nFri Feb  3 12:18:58 2023  -Number of reported associations for MONDO_0005148 in GWASCatalog: 5345\nFri Feb  3 12:18:58 2023  -Loading retrieved data into gwaslab Sumstats object ...\nFri Feb  3 12:18:58 2023 GWASLab version 3.3.24 https://cloufield.github.io/gwaslab/\nFri Feb  3 12:18:58 2023 (C) 2022-2023, Yunye He, Kamatani Lab, MIT License, gwaslab@gmail.com\nFri Feb  3 12:18:58 2023   - format_name  : gwaslab\nFri Feb  3 12:18:58 2023   - format_source  : https://cloufield.github.io/gwaslab/\nFri Feb  3 12:18:58 2023   - format_version  : 20220729_v3\nFri Feb  3 12:19:00 2023 Finished retrieving data from GWASCatalog...\nFri Feb  3 12:19:00 2023  -Retrieved 4036 associations from GWAS catalog.\nFri Feb  3 12:19:00 2023  -Lead variants in known loci: 4036\nFri Feb  3 12:19:00 2023  -Checking the minimum distance between identified lead variants and provided known variants...\nFri Feb  3 12:19:00 2023  -Identified  89  known vairants in current sumstats...\nFri Feb  3 12:19:00 2023  -Identified  0  novel vairants in current sumstats...\nFri Feb  3 12:19:00 2023 Finished checking known or novel successfully!\n\nSNPID   CHR POS SE  P   MLOG10P STATUS  DISTANCE_TO_KNOWN   KNOWN_ID    KNOWN_PUBMED_ID KNOWN_AUTHOR    NOVEL   LOCATION_OF_KNOWN\n0   1:22068326_A_G  1   21741833    0.0103  1.629000e-09    8.788079    3860999 0   rs1825307   30718926    Suzuki K    False   Same\n1   1:51103268_T_C  1   50637596    0.0120  2.519000e-11    10.598772   3860999 0   rs12031188  30718926    Suzuki K    False   Same\n2   1:154309595_TA_T    1   154337119   0.0166  3.289000e-08    7.482936    3860999 1   rs68062313  30718926    Suzuki K    False       Upstream\n3   2:640986_CACAT_C    2   640986  0.0150  2.665000e-10    9.574303    3860999 1   rs72156956  30718926    Suzuki K    False   Upstream\n4   2:27734972_G_A  2   27512105    0.0088  3.897000e-15    14.409270   3860999 0   rs6547692   30718926    Suzuki K    False   Same\n... ... ... ... ... ... ... ... ... ... ... ... ... ...\n84  X:21569920_A_G  23  21551802    0.0076  2.616000e-08    7.582362    3860999 0   rs6633421   30718926    Suzuki K    False   Same\n85  X:48724648_CAA_C    23  48866248    0.0103  4.576000e-09    8.339514    3860999 1   rs782100977 30718926    Suzuki K    False       Upstream\n86  X:57170781_A_AT 23  57144348    0.0076  4.583000e-09    8.338850    3860999 1   rs144226500 30718926    Suzuki K    False   Upstream\n87  X:117915163_T_TA    23  118781200   0.0071  9.818000e-15    14.007977   3860999 1   rs11390176  30718926    Suzuki K    False       Upstream\n88  X:152908887_G_A 23  153643433   0.0077  9.197000e-58    57.036354   3860999 0   rs1894299   30718926    Suzuki K    False   Same\n</code></pre> <p>All of the lead variants are reported which is expected of course. </p> <p>Currently, there is a one-basepair difference in positions for indels. Please pay attention to the positions. ( It will be fixed later)</p> <p>Warning</p> <p>GWAS Catalog API is unstable sometimes.</p>"},{"location":"ExtractNovel/#checking-with-local-files","title":"Checking with local files","text":"<p>Example</p> <p>Suppose we have a list of reported variants like:</p> <pre><code>cat ./toy_data/known_loci.txt\nCHR POS\n1 154309595\n1 51103268\n</code></pre> <pre><code>mysumstats.get_novel(known=\"./toy_data/known_loci.txt\")\n\nFri Feb  3 11:44:12 2023 Start to check if lead variants are known...\nFri Feb  3 11:44:12 2023 Start to extract lead variants...\nFri Feb  3 11:44:12 2023  -Processing 1035804 variants...\nFri Feb  3 11:44:12 2023  -Significance threshold : 5e-08\nFri Feb  3 11:44:12 2023  -Sliding window size: 500  kb\nFri Feb  3 11:44:12 2023  -Found 9461 significant variants in total...\nFri Feb  3 11:44:13 2023  -Identified 89 lead variants!\nFri Feb  3 11:44:13 2023 Finished extracting lead variants successfully!\nFri Feb  3 11:44:13 2023  -Lead variants in known loci: 2\nFri Feb  3 11:44:13 2023  -Checking the minimum distance between identified lead variants and provided known variants...\nFri Feb  3 11:44:13 2023  -Identified  2  known vairants in current sumstats...\nFri Feb  3 11:44:13 2023  -Identified  87  novel vairants in current sumstats...\nFri Feb  3 11:44:13 2023 Finished checking known or novel successfully!\n\nSNPID   CHR POS SE  P   MLOG10P STATUS  DISTANCE_TO_KNOWN   KNOWN_ID    NOVEL   LOCATION_OF_KNOWN\n0   1:22068326_A_G  1   22068326    0.0103  1.629000e-09    8.788079    9960999 29034942    1:51103268  True    Upstream\n1   1:51103268_T_C  1   51103268    0.0120  2.519000e-11    10.598772   9960999 0   1:51103268  False   Same\n2   1:154309595_TA_T    1   154309595   0.0166  3.289000e-08    7.482936    9960999 0   1:154309595 False   Same\n3   2:640986_CACAT_C    2   640986  0.0150  2.665000e-10    9.574303    9960999 &lt;NA&gt;    &lt;NA&gt;    True    NoneOnThisChr\n4   2:27734972_G_A  2   27734972    0.0088  3.897000e-15    14.409270   9960999 &lt;NA&gt;    &lt;NA&gt;    True    NoneOnThisChr\n... ... ... ... ... ... ... ... ... ... ... ...\n84  X:21569920_A_G  23  21569920    0.0076  2.616000e-08    7.582362    9960999 &lt;NA&gt;    &lt;NA&gt;    True    NoneOnThisChr\n85  X:48724648_CAA_C    23  48724648    0.0103  4.576000e-09    8.339514    9960999 &lt;NA&gt;    &lt;NA&gt;    True    NoneOnThisChr\n86  X:57170781_A_AT 23  57170781    0.0076  4.583000e-09    8.338850    9960999 &lt;NA&gt;    &lt;NA&gt;    True    NoneOnThisChr\n87  X:117915163_T_TA    23  117915163   0.0071  9.818000e-15    14.007977   9960999 &lt;NA&gt;    &lt;NA&gt;    True    NoneOnThisChr\n88  X:152908887_G_A 23  152908887   0.0077  9.197000e-58    57.036354   9960999 &lt;NA&gt;    &lt;NA&gt;    True    NoneOnThisChr\n</code></pre>"},{"location":"ExtractNovel/#reference","title":"Reference","text":"<ul> <li>Buniello, A., MacArthur, J. A. L., Cerezo, M., Harris, L. W., Hayhurst, J., Malangone, C., ... &amp; Parkinson, H. (2019). The NHGRI-EBI GWAS Catalog of published genome-wide association studies, targeted arrays and summary statistics 2019. Nucleic acids research, 47(D1), D1005-D1012.</li> </ul>"},{"location":"ForestPlot/","title":"Coming soon","text":""},{"location":"Format/","title":"Output sumstats in certain formats","text":"<p>GWASLab provides a flexible formatting and saving function.</p>"},{"location":"Format/#usage","title":"Usage","text":"<pre><code>to_format(\n          path=\"./sumstats\",\n          fmt=\"ldsc\",   \n          extract=None,\n          exclude=None,\n          id_use=\"rsID\",\n          hapmap3=False,\n          exclude_hla=False,  \n          build=\"19\", \n          verbose=True,\n          output_log=True,\n          to_csvargs={},\n          float_formats={},\n          xymt_number=False,\n          xymt=[\"X\",\"Y\",\"MT\"],\n          chr_prefix=None,\n          bgzip=False,\n          tabix=False\n          )\n</code></pre> <ul> <li><code>path</code> : <code>string</code>, the path for the output, only prefix is needed.</li> <li><code>fmt</code>=\"ldsc\": output format for sumstats. Currently support <code>plink</code> ,<code>plink2</code>, <code>ldsc</code>, <code>saige</code>, <code>fastgwa</code>, <code>regenie</code> . For details , please check  https://github.com/Cloufield/formatbook.</li> <li><code>extract</code>:<code>list</code>, a list of variants to include.</li> <li><code>exclude</code>:<code>list</code>, a list of variants to exclude.</li> <li><code>id_use</code>:<code>string</code>, specify which ID to use when merging with Hapmap3 SNPs.</li> <li><code>hapmap3</code>:<code>boolean</code> , if True, only output Hapmap3 SNPs.</li> <li><code>exclude_hla</code>:<code>boolean</code> , if True, exclude variants in MHC region from output.</li> <li><code>build</code> : <code>string</code>, reference genome build. </li> <li><code>xymt_number</code> : if True, output chrX/Y/MT as 23/24/25.</li> <li><code>xymt</code> : <code>list</code>, descript how to convert chromosome 23,24,25.</li> <li><code>chr_prefix</code> : <code>string</code>, add a prefix to chromosomes when output chr. 6 -&gt; Chr6.</li> <li><code>bgzip</code> : <code>boolean</code>, if True, bgzip the output file. Only works for bed format.</li> <li><code>tabix</code> : <code>boolean</code>, if True, use tabix to index the bgzipped output file. Only works for bed format.</li> <li><code>to_csvargs</code> : <code>dict</code> , extra parameters for pd.to_csv()</li> <li><code>float_formats</code> : <code>dict</code>, a dictionary to specify the float format for each column.</li> <li><code>verbose</code> : <code>boolean</code>, if True, print logs.</li> <li><code>output_log</code> : <code>boolean</code>, if True, save log to a file.</li> </ul>"},{"location":"Format/#example-1-common-tabular-format","title":"Example 1: common tabular format","text":"<p>GWASLab support commonly used tabular format, which are listed in a companion repository <code>formatbook</code>.</p> <p>formatbook</p> <p>for more details, please check formatbook ssf: GWAS-SSF format gwascatalog : GWAS Catalog format pgscatalog : PGS Catalog format plink: PLINK output format plink2: PLINK2 output format saige: SAIGE output format regenie: output format fastgwa: output format metal: output format mrmega: output format fuma: input format ldsc: input format locuszoom: input format vcf: gwas-vcf format bolt_lmm : output format</p> <p>output metal format</p> <pre><code>import gwaslab as gl\n# load your raw sumstats\nmysumstats = gl.Sumstats(...)\n# basic QC\nmysumstats.basic_check()\n# output metal format\nmysumstats.to_format(\"./test\",fmt=\"metal\")\n\nTue Sep 13 18:00:41 2022 Start to format the output sumstats in:  metal  format\nTue Sep 13 18:00:41 2022  -Formatting statistics ...\nTue Sep 13 18:00:41 2022  - Float statistics formats:\nTue Sep 13 18:00:41 2022   - Columns: ['EAF', 'BETA', 'SE', 'P']\nTue Sep 13 18:00:41 2022   - Output formats: ['{:.4g}', '{:.4f}', '{:.4f}', '{:.4e}']\nTue Sep 13 18:00:41 2022  - Start outputting sumstats in metal format...\nTue Sep 13 18:00:41 2022  -metal format will be loaded...\nTue Sep 13 18:00:41 2022  -metal format meta info:\nTue Sep 13 18:00:41 2022   - format_name  :  metal\nTue Sep 13 18:00:41 2022   - format_source  :  https://genome.sph.umich.edu/wiki/METAL_Documentation\nTue Sep 13 18:00:41 2022   - format_version  :  20220726\nTue Sep 13 18:00:41 2022  -gwaslab to metal format dictionary:\nTue Sep 13 18:00:41 2022   - gwaslab keys: ['SNPID', 'EA', 'NEA', 'EAF', 'BETA', 'SE', 'P', 'DIRECTION']\nTue Sep 13 18:00:41 2022   - metal values: ['MarkerName', 'Allele1', 'Allele2', 'Freq1', 'Effect', 'StdErr', 'P-value', 'Direction']\nTue Sep 13 18:00:41 2022  -Output columns: Index(['MarkerName', 'Allele1', 'Allele2', 'Freq1', 'Effect', 'StdErr',\n       'P-value'],\n      dtype='object')\nTue Sep 13 18:00:41 2022  -Output path: ./test.metal.tsv.gz\nTue Sep 13 18:00:41 2022  -Saving log file: ./test.metal.log\nTue Sep 13 18:00:41 2022 Finished outputting successfully!\n</code></pre>"},{"location":"Format/#example-2-ldsc","title":"Example 2 : LDSC","text":"<p>LDSC format, extract hapmap3 SNPs and exclude SNPs in HLA region</p> <pre><code>## format the sumstats to ldsc format\n## extract only hapmap3 SNPs\n## exclude SNPs in HLA region\nmysumstats.to_format(\"./test\",fmt=\"ldsc\", hapmap3=True, exclude_hla=False, build=\"19\")\n</code></pre>"},{"location":"Format/#example-3-bed","title":"Example 3 : BED","text":"<p>Example</p> <pre><code># output 1-based bed-like files for vep\nmysumstats.to_format(\"./test\",fmt=\"vep\",xymt_number=True,chr_prefix=\"Chr\")\n\n# output 0-based bed-like file, and then bgzip and index the file.\nmysumstats.to_format(\"./test\",fmt=\"bed\",bgzip=True,tabix=True)\n</code></pre>"},{"location":"Format/#example-4-vcf","title":"Example 4: VCF","text":"<p>Example</p> <pre><code># output vcf file, and then bgzip and index the file.\nmysumstats.to_format(\"./test\",fmt=\"vcf\",bgzip=True,tabix=True)\n</code></pre>"},{"location":"Format/#example-5-gwas-ssf","title":"Example 5: GWAS-ssf","text":"<p>Example</p> <pre><code># output  GWAS-ssf format\nmysumstats.to_format(\"./test\",fmt=\"ssf\")\n</code></pre> <p>For sample codes, please check here.</p>"},{"location":"GeneticCorrelation/","title":"Genetic correlation loading and plotting","text":""},{"location":"GeneticCorrelation/#heatmap-genetic-correlation-matrix","title":"Heatmap: Genetic correlation matrix","text":"<p>Available since v3.4.15</p> <pre><code>gl.plot_rg(ldsc)\n</code></pre> <p>Simple plot</p> <pre><code># load ldsc log files\nldsc_log_file_list = [\"ldscrg.log\"] \n\nldsc = gl.read_ldsc(ldsc_log_file_list, mode=\"rg\")\n\ngl.plot_rg( ldsc )\n</code></pre> <p></p> <p>Options:</p> <ul> <li><code>ldscrg</code> : <code>DataFrame</code>, results from ldsc-rg. 4 columns are required, <code>p1</code>,<code>p2</code>,<code>p</code>,<code>rg</code>.</li> <li><code>p1</code>: <code>string</code>, column name for trait1, defaul: <code>p1</code></li> <li><code>p2</code>: <code>string</code>, column name for trait2 defaul: <code>p2</code></li> <li><code>rg</code>: <code>string</code>, column name for rg defaul: <code>rg</code></li> <li><code>p</code>: <code>string</code>, column name for p defaul: <code>p</code></li> <li><code>sig_levels</code>: <code>list</code>, default: <code>[0.05]</code></li> <li><code>panno</code>: <code>boolean</code>, default: <code>True</code></li> <li><code>corrections</code>: <code>list</code>,<code>non</code> no correction, <code>fdr</code> FDR, <code>bon</code> bonferroni , default: <code>[\"non\",\"fdr\",\"bom\"]</code></li> <li><code>panno_texts</code>: <code>list</code>, text to annotate significant correlations, match the number of <code>corrections</code> times the number of <code>sig_levels</code>, default: <code>[\"*\",\"**\",\"***\"]</code></li> <li><code>sort_key</code>: <code>function</code>, sort the columns , default: <code>None</code></li> <li><code>equal_aspect</code>: <code>`, defaul:</code>True`</li> <li><code>fontsize</code>: <code>`, defaul:</code>10`</li> <li><code>save</code>: <code>string</code> or <code>boolean</code>, defaul: <code>None</code></li> <li><code>save_args</code>: <code>dict</code>, defaul: <code>None</code></li> <li><code>full_cell</code>: <code>tuple</code>, threshold for full cell, default: <code>(\"fdr\",0.05)</code></li> <li><code>yticklabel_args</code>: <code>dict</code>, default: <code>{\"fontsize\":10}</code></li> <li><code>xticklabel_args</code>: <code>dict</code>, default: <code>{\"rotation\":45,\"horizontalalignment\":\"left\", \"verticalalignment\":\"bottom\",\"fontsize\":10}</code></li> <li><code>colorbar_args</code> :  <code>dict</code> , default:<code>{\"shrink\":0.82}</code></li> <li><code>cmap</code>: <code>cmap</code>, default:<code>matplotlib.cm.get_cmap('RdBu')</code></li> </ul> <p>Customized plot</p> <pre><code># or load from tabular files\nldsc = pd.read_csv(\"toy_data/input_rg.txt\",sep=\"\\t\")\nldsc\n#prepare the final dataset\ntrait =  pd.read_csv(\"toy_data/trait_list.txt\",sep=\"\\t\")\ntrait[\"order\"] = range(len(trait))\norder = trait[\"TRAIT\"].values\ntrait_set1 = trait.loc[trait[\"order\"]&gt;=59,\"TRAIT\"].values\ntrait_set2 = trait.loc[trait[\"order\"]&lt;59,\"TRAIT\"].values\nldsc = ldsc.loc[((ldsc[\"p1\"].isin(trait_set1))&amp;(ldsc[\"p2\"].isin(trait_set2))) | ((ldsc[\"p1\"].isin(trait_set2))&amp;(ldsc[\"p2\"].isin(trait_set1))),:]\nmap_dic={order[i]:i+1 for i in range(len(order))}\nkey=lambda x:x.map(map_dic)\n\n# plot\ndf = gl.plot_rg( ldsc,\n            sig_levels=[0.05],\n            corrections =[\"non\"],\n            p=\"q\",\n            p1=\"p2\",\n            p2=\"p1\",\n            full_cell=(\"non\",0.05),\n            panno_texts=[\"*\"],\n            fig_args={\"figsize\":(15,15),\"dpi\":300},\n            colorbar_args={\"shrink\":0.4},\n            panno_args={\"size\":12,\"c\":\"black\"},fdr_method=\"i\",\n            fontsize=8,\n            sort_key=key\n            )\n</code></pre> <p></p> <p>sample data source: https://github.com/mkanai/ldsc-corrplot-rg , Kanai, M., Akiyama, M., Takahashi, A., Matoba, N., Momozawa, Y., Ikeda, M., ... &amp; Kamatani, Y. (2018). Genetic analysis of quantitative traits in the     Japanese population links cell types to complex human diseases. Nature genetics, 50(3), 390-400.</p>"},{"location":"Harmonization/","title":"Harmonization","text":"<p>GWASLab provides reference-dependent harmonization functions.</p> <p>See examples here.</p>"},{"location":"Harmonization/#methods-summary","title":"Methods summary","text":"Sumstats Methods Options Description <code>.check_ref()</code> <code>ref_path</code>, <code>chr_dict=get_chr_to_number()</code> Check alignment with a reference sequence <code>.assign_rsid()</code> <code>ref_rsid_tsv</code>, <code>ref_rsid_vcf</code>, <code>n_cores=1</code>, <code>chunksize=5000000</code>, <code>chr_dict=get_number_to_chr()</code>, <code>overwrite=\"empty\"</code> Annotate rsid using a reference vcf file <code>.infer_strand()</code> <code>ref_infer</code>,<code>ref_alt_freq=None</code>,<code>maf_threshold=0.40</code>,<code>remove_snp=\"\"</code>,<code>mode=\"pi\"</code>,<code>n_cores=1</code>,<code>remove_indel=\"\"</code> Infer the strand of a variant using reference vcf file with EAF in INFO <code>.check_daf()</code> <code>ref_infer</code>,<code>ref_alt_freq=None</code>,<code>maf_threshold=0.40</code>,<code>n_cores=1</code> Calculate difference in allele frequencies <code>.flip_allele_stats()</code> After alignment and inferring, flip the alleles to harmonise the variants. <code>.harmonize()</code> <code>basic_check=True</code>,  <code>ref_seq=None</code>,<code>ref_rsid_tsv=None</code>,<code>ref_rsid_vcf=None</code>,<code>ref_infer=None</code>,<code>ref_alt_freq=None</code>,<code>maf_threshold=0.40</code>,<code>n_cores=1</code>,<code>remove=False</code>,<code>checkref_args={}</code>,<code>removedup_args={}</code>,<code>assignrsid_args={}</code>,<code>inferstrand_args={}</code>,<code>flipallelestats_args={}</code>,<code>fixid_args={}</code>,<code>fixchr_agrs={}</code>,<code>fixpos_args={}</code>,<code>fixallele_args={}</code>,<code>sanitycheckstats_args={}</code>,<code>normalizeallele_args={}</code> all-in-one function for harmonization"},{"location":"Harmonization/#align-nea-with-ref-in-the-reference-genome","title":"Align NEA with REF in the reference genome","text":"<p><code>.check_ref()</code>:  Check if NEA is aligned with the reference sequence. After checking, the tracking status code will be changed accordingly. </p> <p>Example</p> <pre><code>mysumstats.check_ref(ref_path=\"ref_genome.fa\")\nmysumstats.flip_allele_stats()\n</code></pre> <p>Note</p> <p><code>check_ref()</code> only change the status code. Use flip function <code>.flip_allele_stats()</code> to flip the allele-specific stats.</p>"},{"location":"Harmonization/#assign-rsid-according-to-chr-pos-refalt","title":"Assign rsID according to CHR, POS, REF/ALT","text":"<p><code>.assign_rsid()</code> : Annotated variants with rsID using a reference tsv file (1KG variants) and reference vcf file (tabix indexed, entire dbSNP).</p> <p>Example</p> <pre><code>mysumstats.assign_rsid(ref_rsid_tsv, ref_rsid_vcf, n_cores=1)\n</code></pre> <ul> <li>For tsv file, variants will be matched using SNPID (CHR:POS:NEA:EA) for quick assigning.</li> <li>For VCF file, GWASLab will first extract all variants in the reference file with matching CHR and POS. And then compare EA/NEA in sumstats with REF/ALT in reference vcf. When matching, it will annotate the variant in sumstats with the matching rsID in reference vcf.  </li> </ul>"},{"location":"Harmonization/#check-panlidromic-snps-or-undistingushable-indels","title":"Check panlidromic SNPs or undistingushable Indels","text":"<p><code>.infer_strand()</code>:</p> <ul> <li>Infer the strand for palindromic SNPs (AT, or CG), the default threshold is 0.40. </li> <li>Checking the alignment status of indels with the REF allele in a reference vcf file.</li> </ul> <p>Example</p> <pre><code>mysumstats.infer_strand()\nmysumstats.flip_allele_stats()\n</code></pre> <p>Note</p> <p><code>infer_strand()</code> only change the status code. Use filp function <code>.flip_allele_stats()</code> to filp the allele-specific stats.</p>"},{"location":"Harmonization/#check-the-difference-in-allele-frequency","title":"Check the difference in allele frequency","text":"<p><code>.check_daf()</code> : check the allele frequency discrepancy with a reference vcf. Please make sure your sumstats are already harmonized, and the variants in reference VCF are also aligned. gwaslab will retrieve infomation only for matched variants (CHR, POS, EA-ALT, and NEA-REF).</p> <p><code>ref_infer</code>: reference VCF file path. <code>ref_alt_freq</code>:  allele frequency for ALT in the INFO field of reference VCF file. <code>n_cores</code>: number of cores to use.</p> <p>Example</p> <pre><code>mysumstats.check_af(ref_infer=gl.get_path(\"1kg_eas_hg19\"), \n                    ref_alt_freq=\"AF\",\n                    n_cores=2)\n</code></pre> <p>DAF : Difference between Effect allele frequency and Reference ALT frequency EAF: Effect allele frequency RAF: Reference ALT allele frequency</p> <p>You may want to check the allele frequency discrepancy with a reference VCF. Just specify the path and the right allele frequency for your target ancestry in INFO field.</p>"},{"location":"Harmonization/#allele-frequency-correlation-plot","title":"Allele frequency correlation plot","text":"<p>GWASlab will simply calculate DAF = AF-EAF - AF-ALT , and store the results in DAF column. DAF can then be used for plotting (<code>.plot_daf()</code>) or filter variants.</p> <p>Example</p> <pre><code>mysumstats.plot_daf(threshold=0.12)\n</code></pre> <p></p>"},{"location":"Harmonization/#flipping-based-on-status-code","title":"Flipping based on status code","text":"<p><code>.flip_allele_stats()</code> :  Flip allele-specific statistics to harmonize the variants based on the tracking status code. </p> <p>Example</p> <pre><code>mysumstats.check_ref(ref_path=\"ref_genome.fa\")\nmysumstats.flip_allele_stats()\n\nmysumstats.infer_strand()\nmysumstats.flip_allele_stats()\n</code></pre>"},{"location":"Harmonization/#assign-chr-and-pos-according-to-rsid-and-reference-data","title":"Assign CHR and POS according to rsID and reference data","text":"<pre><code>mysumstats.rsid_to_chrpos()  \n</code></pre>"},{"location":"HeritabilityConversion/","title":"Heritability conversion","text":"<p>GWASLab can convert Observed-scale heritability to Liability-scale heritability. </p> <p>Quote</p> <p>Conversion formula (Equation 23 from Lee. 2011): $$ h^2_{liability-scale} = h^2_{observed-scale} * {{K(1-K)}\\over{Z^2}} *  {{K(1-K)}\\over{P(1-P)}} $$</p> <ul> <li>\\(K\\) : Population disease prevalence.</li> <li>\\(P\\) : Sample disease prevalence.</li> <li>\\(Z\\) : The height of the standard normal probability density function at threshold T. <code>scipy.stats.norm.pdf(T, loc=0, scale=1)</code>.</li> <li>\\(T\\) : The threshold. <code>scipy.stats.norm.ppf(1 - K, loc=0, scale=1)</code> or <code>scipy.stats.norm.isf(K)</code>.</li> </ul> <p>Reference: Estimating Missing Heritability for Disease from Genome-wide Association Studies https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3059431/</p>"},{"location":"HeritabilityConversion/#usage","title":"Usage","text":"<pre><code>gl.h2_obs_to_liab(h2_obs, P, K, se_obs=None)\n</code></pre>"},{"location":"HeritabilityConversion/#parameters","title":"Parameters","text":"<ul> <li><code>h2_obs</code> : float. Heritability on the observed scale in an ascertained sample. </li> <li><code>P</code> : float in (0,1). Prevalence of the phenotype in the sample. </li> <li><code>K</code> : float in (0,1) . Prevalence of the phenotype in the population. </li> <li><code>se_obs</code> : float. se of h2_obs.</li> </ul> <p>Quote</p> <p>Codes were adopted from LDSC. </p> <p>Reference : Bulik-Sullivan, B. K., Loh, P. R., Finucane, H. K., Ripke, S., Yang, J., Patterson, N., ... &amp; Neale, B. M. (2015). LD Score regression distinguishes confounding from polygenicity in genome-wide association studies. Nature genetics, 47(3), 291-295.</p>"},{"location":"InferBuild/","title":"Infer Genome Build","text":"<p>GWASLab use the chromosome and basepair position information for Hapmap3 SNPs to infer the reference genome build for sumstats.</p> <p>Reference genome build will be simply assigned based on the matching count. (Note: the results are more reliable if you have more than 10,000 variants)</p> <p>Status codes (first two digits) will be changed based on the matching results.</p> <p>Example</p> <pre><code>mysumstats.infer_build()\n\nWed Oct 19 11:01:01 2022  -Start to infer genome build version using hapmap3 SNPs...\nWed Oct 19 11:01:01 2022  -Loading Hapmap3 variants data...\nWed Oct 19 11:01:04 2022  -chr:pos will be used for matching...\nWed Oct 19 11:01:33 2022  -Matching variants for hg19: num_hg19= 1092441\nWed Oct 19 11:01:33 2022  -Matching variants for hg38: num_hg38= 15997\nWed Oct 19 11:01:33 2022  -Since num_hg19&gt;num_hg38, assigning genome build hg19...\n</code></pre>"},{"location":"LiftOver/","title":"Liftover","text":"<p>GWASLab can directly liftover the positions of variants in sumstats.</p> <p>See examples here.</p>"},{"location":"LiftOver/#usage","title":"Usage","text":"<pre><code>mysumstats.liftover(n_cores=3, \n                    from_build=\"19\", \n                    to_build=\"38\",\n                    remove=True)\n</code></pre> <p>Note</p> <p>GWASLab will only liftover basepair positions. If needed, please perform harmonization using the reference file of the target build.  </p>"},{"location":"LiftOver/#options","title":"Options","text":"<ul> <li><code>n_cores</code> : <code>Interger</code>. Number of threads to use for liftover.</li> <li><code>from_build</code> : <code>\"19\"</code> or <code>\"38\"</code>. Original genome build.</li> <li><code>to_build</code> : <code>\"19\"</code> or <code>\"38\"</code>. Target genome build.</li> <li><code>remove</code> : <code>Boolean</code>. If True, remove unmapped variants</li> </ul> <p>Quote</p> <p>This method is based on GitHub - jeremymcrae/liftover: liftover for python, made fast with cython</p>"},{"location":"LiftOver/#example","title":"example","text":"<p>Example</p> <pre><code>mysumstats = gl.Sumstats(\"t2d_bbj.txt.gz\",\n             snpid=\"SNP\",\n             chrom=\"CHR\",\n             pos=\"POS\",\n             ea=\"ALT\",\n             nea=\"REF\",\n             neaf=\"Frq\",\n             beta=\"BETA\",\n             se=\"SE\",\n             p=\"P\")\nmysumstats.basic_check()\nmysumstats.liftover(n_cores=3, from_build=\"19\", to_build=\"38\")\n</code></pre>"},{"location":"LoadLDSC/","title":"Batch load LDSC log file","text":"<p>GWASLab provides a standalone function for batch loading ldsc log file into a <code>pd.DataFrame</code>. </p> <p>GWASLab uses regular expression to match the values and fill them into a dataframe.</p> <p><code>gl.read_ldsc()</code> </p>"},{"location":"LoadLDSC/#usage","title":"Usage","text":"<pre><code>gl.read_ldsc(filelist, mode=\"h2\")\n</code></pre>"},{"location":"LoadLDSC/#opions","title":"Opions","text":"<ul> <li><code>filelist</code> : <code>list</code> .A list of paths to ldsc log files</li> <li><code>mode</code> : <code>string</code>. <code>h2</code> or <code>rg</code>.  </li> </ul>"},{"location":"LoadLDSC/#example","title":"Example","text":"<p>Example</p> <pre><code>#mode=h2\npaths = [\n    '/home/he/work/GWASTutorial/08_LDSC/BBJ_HDLC.log',\n    '/home/he/work/GWASTutorial/08_LDSC/BBJ_LDLC.log'\n]\n\ndf = gl.read_ldsc(ldsc_file_list, mode=\"h2\")\n\nLoading file 1 :/home/he/work/GWASTutorial/08_LDSC/BBJ_HDLC.log ...\nLoading file 2 :/home/he/work/GWASTutorial/08_LDSC/BBJ_LDLC.log ...\n\ndf\nFilename    h2_obs  h2_se   Lambda_gc   Mean_chi2   Intercept   Intercept_se    Ratio   Ratio_se\nBBJ_HDLC.log    0.1583  0.0281  1.1523  1.2843  1.0563  0.0114  0.1981  0.0402\nBBJ_LDLC.log    0.0743  0.0123  1.0833  1.1465  1.0296  0.0107  0.2019  0.0727\n</code></pre> <p>Example</p> <pre><code>#mode=rg\n\npaths = [\n    '/home/he/work/GWASTutorial/08_LDSC/BBJ_HDLC_LDLC.log',\n]\n\ndf = gl.read_ldsc(paths, mode=\"rg\")\nLoading file 1 :/home/he/work/GWASTutorial/08_LDSC/BBJ_HDLC_LDLC.log ...\n\ndf\np1  p2  rg  se  z   p   h2_obs  h2_obs_se   h2_int  h2_int_se   gcov_int    gcov_int_se\nBBJ_HDLC.sumstats.gz    BBJ_LDLC.sumstats.gz    0.1601  0.1821  0.8794  0.3792  0.0543  0.0211  1.0583  0.0335  -0.0198 0.0121\n</code></pre>"},{"location":"LoadLDSC/#plot-ldsc-rg-under-construction","title":"plot ldsc rg (under construction)","text":"<p>For genetic correlation, after loading, you can use <code>gl.plot_rg()</code> to plot a heat map to visualize the results. No extra manipulation needed.</p> <pre><code>gl.plot_rg(myldscrg)\n</code></pre>"},{"location":"MiamiPlot/","title":"Miami plot","text":"<p>Implemented since v3.3.4</p> <p>As a standalone function, GWASLab can plot miami plot given a pair of sumstats files.</p>"},{"location":"MiamiPlot/#usage","title":"Usage","text":"<pre><code>gl.plot_miami( \n          path1,\n          path2,\n          cols1=[\"CHR\",\"POS\",\"P\"],\n          cols2=[\"CHR\",\"POS\",\"P\"],\n          sep=[\"\\t\",\"\\t\"],\n          anno= None\n          )\n</code></pre> <ul> <li><code>path1</code> : <code>string</code> path to sumstats1</li> <li><code>path2</code> : <code>string</code> path to sumstats2</li> <li><code>cols1</code> : <code>list</code> CHR,POS,P names for sumstats1</li> <li><code>cols2</code> : <code>list</code> CHR,POS,P names for sumstats2</li> <li><code>sep</code>   : <code>list</code> separator for each sumstats</li> <li><code>anno</code>  : <code>boolean</code> or <code>GENENAME</code></li> <li><code>region</code> : only plot a region. For example, <code>region=(2,2153874,21753874)</code> .</li> <li><code>highlight1</code>: <code>list</code> , list of loci to highlight for sumstats1. For example, <code>highlight1=[(5,124289158)]</code> .</li> <li><code>highlight2</code>: <code>list</code> , list of loci to highlight for sumstats2. </li> <li><code>pinpoint1</code>: <code>list</code> , list of variants to pinpolint for sumstats1.</li> <li><code>pinpoint2</code>: <code>list</code>,  list of variants to pinpolint for sumstats2.</li> <li><code>titles</code>:<code>list</code>, two titles. For example,<code>titles=[\"male\",\"female\"]</code></li> </ul>"},{"location":"MiamiPlot/#example","title":"Example","text":"<p>Miami plot for male- amd female-specific GWAS on BMI</p> <p>Sample datasets are obtained from JENGER:</p> <pre><code>!wget -O bmi_male_bbj.txt.gz http://jenger.riken.jp/2analysisresult_qtl_download/\n!wget -O bmi_female_bbj.txt.gz http://jenger.riken.jp/4analysisresult_qtl_download/\n</code></pre> <pre><code>mysumstats = gl.plot_miami(path1=\"bmi_male_bbj.txt.gz\" ,\n                           path2=\"bmi_female_bbj.txt.gz\",\n                           cols1=[\"CHR\",\"POS\",\"P\"],\n                           cols2=[\"CHR\",\"POS\",\"P\"],\n                           titles=[\"bmi male\",\"bmi female\"],\n                           titles_pad=[0.15,0.0],\n                           anno=\"GENENAME\",\n                           region_grid=True,\n                           highlight1=[(5,124289158)],\n                           pinpoint2=[(2,653874)]\n                           )\n</code></pre> <p></p> <pre><code>mysumstats = gl.plot_miami(path1=\"bmi_male_bbj.txt.gz\" ,\n                           path2=\"bmi_female_bbj.txt.gz\",\n                           cols1=[\"CHR\",\"POS\",\"P\"],\n                           cols2=[\"CHR\",\"POS\",\"P\"],\n                           titles=[\"male\",\"female\"],\n                           region=(2,2153874,21753874),\n                           titles_pad=[0.1,-0.05],\n                           anno=\"GENENAME\",\n                           region_grid=True\n                           )\n</code></pre>"},{"location":"PerSNPh2/","title":"Per SNP Heritability","text":"<p>GWASLab provides a simple function to calculate the variance explained by each SNP.</p> <pre><code>mysumstats.get_per_snp_r2()\n</code></pre> <p>It needs effect size <code>BETA</code> and effect allele frequency <code>EAF</code> for calculation. If <code>N</code> is available, it will also calculate the F-statistics.</p> <p>For SNP <code>i</code></p> \\[ h^2_{i} = 2 \\times \\beta_i^2 \\times EAF \\times (1 - EAF) \\] \\[ F = h^2_{i} \\times (n -2) / (1 - h^2_{i}) \\] <p>Example</p> <pre><code>SNPID   EAF BETA    N   STATUS\n0   1:725932_G_A    0.9960  -0.0737 166718  9999999\n1   1:725933_A_G    0.0040  0.0737  166718  9999999\n2   1:737801_T_C    0.0051  0.0490  166718  9999999\n3   1:749963_T_TAA  0.8374  0.0213  166718  9999999\n4   1:751343_T_A    0.8593  0.0172  166718  9999999\n\nmysumstats.get_per_snp_r2()\n\nTue Jan 31 22:44:34 2023 Start to calculate per-SNP heritibility...\nTue Jan 31 22:44:34 2023  -Calculating per-SNP heritibility by 2 * (BETA**2) * AF * (1-AF)...\nTue Jan 31 22:44:35 2023  -Calculating F-statistic...\nTue Jan 31 22:44:35 2023 Finished calculating per-SNP heritibility!\n\nSNPID   EAF BETA    N   STATUS  SNPH2   F\n0   1:725932_G_A    0.9960  -0.0737 166718  9999999 0.000043    7.215732\n1   1:725933_A_G    0.0040  0.0737  166718  9999999 0.000043    7.215732\n2   1:737801_T_C    0.0051  0.0490  166718  9999999 0.000024    4.062184\n3   1:749963_T_TAA  0.8374  0.0213  166718  9999999 0.000124    20.600305\n4   1:751343_T_A    0.8593  0.0172  166718  9999999 0.000072    11.927080\n</code></pre>"},{"location":"Pickle/","title":"Save the Sumstats Object","text":"<p>GWASLab provides functions to save and load unfinished <code>gl.Sumstats</code> Objects.</p>"},{"location":"Pickle/#usage","title":"Usage","text":"<pre><code>gl.dump_pickle(SumstatsObject, path, overwrite=False)\n\ngl.load_pickle(path)\n</code></pre>"},{"location":"Pickle/#options","title":"Options","text":"<ul> <li><code>SumstatsObject</code> : <code>gl.Sumstats()</code>. GWASLab Sumstats Object.</li> <li><code>path</code> : <code>string</code>. dumped pickle file path.</li> <li><code>overwrite</code> : <code>boolean</code>. If <code>True</code>, overwrite the file if it already exists.</li> </ul>"},{"location":"Pickle/#example","title":"Example","text":"<p>Example</p> <pre><code>gl.dump_pickle(mysumstats,\"./first.pickle\",overwrite=True)\nWed Jan 11 23:29:47 2023 Start to dump the Sumstats Object.\nWed Jan 11 23:29:47 2023  -Dump the Sumstats Object to :  ./first.pickle\n\nmy2sumstats = gl.load_pickle(\"./first.pickle\")\nWed Jan 11 23:45:59 2023 Loaded dumped Sumstats object from :  ./first.pickle\n</code></pre>"},{"location":"QC%26Filtering/","title":"QC and filtering","text":"<p>GWASLab provides all-in-one function and customizable functions for sumstats QC and filtering.</p> <p>See examples here.</p>"},{"location":"QC%26Filtering/#methods-summary","title":"Methods Summary","text":"Sumstats Methods Options Description <code>.check_sanity()</code> <code>n=(0,2**31 -1)</code>, <code>eaf=(0,1)</code>, <code>mac=(0,float(\"Inf\"))</code>, <code>chisq=(0,float(\"Inf\"))</code>, <code>p=(5e-300,1)</code>, <code>mlog10p=(0,float(\"Inf\"))</code>, <code>beta=(-10,10)</code>, <code>z=(-37.5,37.5)</code>, <code>se=(0,float(\"Inf\"))</code>, <code>OR=(-10,10)</code> , <code>OR_95L=(0,float(\"Inf\"))</code>, <code>OR_95U=(0,float(\"Inf\"))</code>, <code>info=(0,float(\"Inf\"))</code> sanity check for statistics including BETA, SE, Z, CHISQ, EAF, OR, N... <code>.remove_dup()</code> <code>mode=\"md\"</code>, <code>keep='first'</code>, <code>keep_col=\"P\"</code>, <code>remove=False</code> remove duplicated, multiallelic or NA variants <code>.filter_value()</code> expr filter in variants base on expr <code>.filter_region_in()</code> <code>path</code> ,  <code>inplace=True</code> , <code>high_ld=False</code>,  <code>build=\"19\"</code> filter in variants in the specified region define by a bed file <code>.filter_region_out()</code> <code>path</code> ,  <code>inplace=True</code> , <code>high_ld=False</code>,  <code>build=\"19\"</code> filter out variants in the specified region define by a bed file"},{"location":"QC%26Filtering/#statistics-sanity-check","title":"Statistics Sanity Check","text":"<p><code>.check_sanity()</code>: Basic sanity check will. be performed on statistics to check if there are any <code>extreme values</code> or <code>values out of expected ranges</code>.</p> Parameters Type Range <code>n=(0,2**31-1))</code> <code>interger</code> 0&lt;N&lt; \\(2^{31}-1\\) <code>eaf=(0,1)</code> <code>float</code> 0&lt;=EAF&lt;=1 <code>mac=(0,float(\"Inf\"))</code> <code>float</code> MAC&gt;0 <code>chisq=(0,float(\"Inf\"))</code> <code>float</code> CHISQ&gt;0 <code>p=(5e-300,1)</code> <code>float</code> 5e-300&lt;P&lt;=1 <code>mlog10p=(0,float(\"Inf\"))</code> <code>float</code> MLOG10&gt;0 <code>beta=(-10,10)</code> <code>float</code> -10&lt;BETA&lt;10 <code>z=(-37.5,37.5)</code> <code>float</code> -37.5&lt;z&lt;37.5 <code>se=(0,float(\"Inf\"))</code> <code>float</code> SE&gt;0 <code>OR=(-10,10)</code> <code>float</code> -10&lt;log(OR)&lt;10 <code>OR_95L=(0,float(\"Inf\"))</code> <code>float</code> OR_95L&gt;0 <code>OR_95U=(0,float(\"Inf\"))</code> <code>float</code> OR_95U&gt;0 <code>info=(0,float(\"Inf\"))</code> <code>float</code> INFO&gt;0 <code>direction</code> <code>string</code> only contains <code>\"+\"</code>,<code>\"-\"</code> ,<code>\"0\"</code>or <code>\"?\"</code> <p>Example</p> <pre><code>sumstats.check_sanity()\n\nFri Jan 13 16:31:50 2023 Start sanity check for statistics ...\nFri Jan 13 16:31:50 2023  -Current Dataframe shape : 12557761  x  12\nFri Jan 13 16:31:51 2023  -Checking if  0 &lt;=N&lt;= 2147483647  ...\nFri Jan 13 16:31:57 2023  -Removed 0 variants with bad N.\nFri Jan 13 16:31:57 2023  -Checking if  0 &lt;=EAF&lt;= 1  ...\nFri Jan 13 16:32:01 2023  -Removed 0 variants with bad EAF.\nFri Jan 13 16:32:01 2023  -Checking if  0 &lt;=MAC&lt;= inf  ...\nFri Jan 13 16:32:07 2023  -Removed 0 variants with bad MAC.\nFri Jan 13 16:32:07 2023  -Checking if  5e-300 &lt;= P &lt;= 1  ...\nFri Jan 13 16:32:09 2023  -Removed 0 variants with bad P.\nFri Jan 13 16:32:09 2023  -Checking if  -10 &lt;BETA)&lt; 10  ...\nFri Jan 13 16:32:11 2023  -Removed 0 variants with bad BETA.\nFri Jan 13 16:32:11 2023  -Checking if  0 &lt;SE&lt; inf  ...\nFri Jan 13 16:32:15 2023  -Removed 0 variants with bad SE.\nFri Jan 13 16:32:15 2023  -Checking STATUS...\nFri Jan 13 16:32:16 2023  -Coverting STAUTUS to interger.\nFri Jan 13 16:32:20 2023  -Removed 0 variants with bad statistics in total.\nFri Jan 13 16:32:20 2023 Finished sanity check successfully!\n</code></pre>"},{"location":"QC%26Filtering/#remove-duplicated-or-multiallelic-variants","title":"Remove duplicated or multiallelic variants","text":"<p>After standardizing and normalizing the sumstats, you can also remove duplicated or multiallelic variants using</p> <pre><code>.remove_dup(mode=\"md\")\n</code></pre> <ul> <li><code>mode=d</code> ,remove duplicate.<ul> <li>remove duplicate SNPs based on  1. SNPID, </li> <li>remove duplicate SNPs based on  2. CHR, POS, EA, and NEA</li> <li>remove duplicate SNPs based on  3. rsID</li> </ul> </li> <li><code>mode=m</code>, remove multiallelic variants.<ul> <li>remove multiallelic SNPs based on  4. CHR, POS</li> </ul> </li> <li><code>remove=True</code> : remove NAs </li> <li><code>keep_col</code> : use which column to sort the values (<code>keep_ascend=True</code>: ascending order)</li> <li><code>keep</code>: keep 'first' or 'last'.</li> </ul> <p>Example</p> <pre><code>sumstats.remove_dup(mode=\"md\",keep='first',keep_col=\"P\",remove=False)\n\nFri Jan 13 17:34:38 2023 Start to sort the sumstats using P...\nFri Jan 13 17:34:38 2023 Start to remove duplicated variants based on snpid...\nFri Jan 13 17:34:38 2023  -Current Dataframe shape : 9  x  11\nFri Jan 13 17:34:38 2023  -Which variant to keep:  first\nFri Jan 13 17:34:38 2023  -Removed  1  based on SNPID...\nFri Jan 13 17:34:38 2023 Start to remove duplicated variants based on rsID...\nFri Jan 13 17:34:38 2023  -Removed  1  based on rsID...\nFri Jan 13 17:34:38 2023 Start to remove duplicated variants based on CHR,POS,EA and NEA...\nFri Jan 13 17:34:38 2023  -Current Dataframe shape : 7  x  11\nFri Jan 13 17:34:38 2023  -Which variant to keep:  first\nFri Jan 13 17:34:38 2023  -Removed  1  based on CHR,POS,EA and NEA...\nFri Jan 13 17:34:38 2023 Start to remove multiallelic variants based on chr:pos...\nFri Jan 13 17:34:38 2023  -Which variant to keep:  first\nFri Jan 13 17:34:38 2023  -Removed  0  multiallelic variants...\nFri Jan 13 17:34:38 2023  -Removed  3  variants in total.\nFri Jan 13 17:34:38 2023  -Sort the coordinates...\nFri Jan 13 17:34:38 2023 Finished removing successfully!\n</code></pre> <p>This will remove duplicated and multiallelic variants and keep the one with the lowest P.</p> <p>Before:</p> <p></p> <p>After</p> <p></p>"},{"location":"QC%26Filtering/#filtering-by-condition","title":"Filtering by condition","text":"<p>Filter the sumstats by <code>expr</code> (a wrapper of <code>pandas.DataFrame.query</code>), and return a new Sumstats Object by default. This allows method chaining. For example, you can filter certain variants first and then create a Mahanttan plot like <code>mysumstats.filter_value('BETA&lt;0 &amp; CHR==1').plot_mqq()</code>.</p> <pre><code>.filter_value(expr,inplace=False)\n</code></pre> <ul> <li><code>expr</code>: <code>string</code>. the query string used fot filtering. (for example: '1&gt;BETA&gt;0 &amp; N&gt;10000')</li> <li><code>inplace</code>: <code>boolean</code>. If False, return a new  Sumstats Object (so chain calling is possible). If true, the current Sumstats Object will be filtered in place.</li> </ul> <p>!!! quote pd.DataFrame.query()     Please check https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.query.html</p> <p>Example</p> <p><pre><code>mysumstats.filter_value('BETA&lt;0 &amp; CHR==1').plot_mqq()\nWed Dec  7 01:32:06 2022 Start filtering values by condition: BETA&lt;0 &amp; CHR==1\nWed Dec  7 01:32:06 2022  -Removing 12075769 variants not meeting the conditions: BETA&lt;0 &amp; CHR==1\nWed Dec  7 01:32:06 2022 Finished filtering values.\nWed Dec  7 01:32:06 2022 Start to plot manhattan/qq plot with the following basic settings:\nWed Dec  7 01:32:06 2022  -Genome-wide significance level is set to 5e-08 ...\nWed Dec  7 01:32:06 2022  -Raw input contains 481992 variants...\nWed Dec  7 01:32:06 2022  -Plot layout mode is : mqq\nWed Dec  7 01:32:06 2022 Finished loading specified columns from the sumstats.\nWed Dec  7 01:32:06 2022 Start conversion and sanity check:\nWed Dec  7 01:32:06 2022  -Removed 0 variants with nan in CHR or POS column ...\nWed Dec  7 01:32:06 2022  -Removed 0 variants with nan in P column ...\nWed Dec  7 01:32:06 2022  -P values are being converted to -log10(P)...\nWed Dec  7 01:32:06 2022  -Sanity check after conversion: 0 variants with P value outside of (0,1] will be removed...\nWed Dec  7 01:32:06 2022  -Sanity check: 0 na/inf/-inf variants will be removed...\nWed Dec  7 01:32:07 2022  -Maximum -log10(P) values is 10.598771832501887 .\nWed Dec  7 01:32:07 2022 Finished data conversion and sanity check.\nWed Dec  7 01:32:07 2022 Start to create manhattan plot with 481992 variants:\nWed Dec  7 01:32:09 2022  -Found 2 significant variants with a sliding window size of 500 kb...\nWed Dec  7 01:32:09 2022 Finished creating Manhattan plot successfully!\nWed Dec  7 01:32:09 2022  -Skip annotating\nWed Dec  7 01:32:09 2022 Start to create QQ plot with 481992 variants:\nWed Dec  7 01:32:09 2022  -Calculating GC using P : 1.2372836632762023\nWed Dec  7 01:32:09 2022 Finished creating QQ plot successfully!\n</code></pre> </p>"},{"location":"QC%26Filtering/#filtering-regions","title":"Filtering regions","text":"<p><pre><code>.filter_region_in(path=\"./abc.bed\")\n.filter_region_out(high_ld=True)\n</code></pre> filter variants in certain regions defined in bed files.</p> <ul> <li><code>path</code> : path to the bed files</li> <li><code>high_ld</code> : high-ld region (built-in data, no additional bed needed)</li> </ul> <p>Example</p> <pre><code>mysumstats.filter_region_in(high_ld=True,inplace=False).data\n\nmysumstats.filter_region_out(high_ld=True,inplace=False).data\n</code></pre>"},{"location":"QC%26Filtering/#filter_in-filter_out-deprecated","title":"filter_in &amp; filter_out (deprecated)","text":"<p><pre><code>.filter_in(gt={},lt={},eq={},inplace=False)\n\n.filter_out(gt={},lt={},eq={},inplace=False)\n</code></pre> - <code>gt</code>: greater than - <code>lt</code>: less than - <code>eq</code>: equal to - <code>inplace</code>: True or False. If False, return a dataframe. If true, the Sumstats object will be filtered.</p>"},{"location":"Reference/","title":"Reference data for handling Sumstats","text":""},{"location":"Reference/#reference-genome-sequence-for-variant-allele-alignment","title":"Reference genome sequence for variant allele alignment","text":"<ul> <li>GRCh37 / hg19 : ucsc_hg19</li> <li>GRCh38 / hg38 : ucsc_hg38</li> </ul> <p>For details about reference genome, please check https://cloufield.github.io/CTGCatalog/Reference_data_Genome_README/</p>"},{"location":"Reference/#processed-reference-files-for-harmonization","title":"Processed Reference files for harmonization","text":""},{"location":"Reference/#1000-genome-projecthg19","title":"1000 Genome Project(hg19)","text":"<p>Download: Index of /vol1/ftp/release/20130502/</p> <p>Process the 1000 genome vcf file for EAS sample:</p> <ul> <li>Extract EAS sample</li> <li>Split multiallelic variants</li> <li>Normalize variants</li> <li>Rename variants as CHR:POS:REF:ALT</li> <li>Remove duplicated variants</li> <li>Calculate Alternative allele frequency</li> <li>Tabix index</li> </ul>"},{"location":"Reference/#sample-code","title":"Sample code:","text":"<p><pre><code>#!/bin/bash\n# extract EAS sample ID\nawk '$3==\"EAS\"{print $1}' integrated_call_samples_v3.20130502.ALL.panel &gt;EAS.sample\n\n# process\nfor chr in {1..22}\ndo\nbcftools view -S EAS.sample ALL.chr\"${chr}\".phase3_shapeit2_mvncall_integrated_v5a.20130502.genotypes.vcf.gz | \\\nbcftools norm -m-any --check-ref w -f human_g1k_v37.fasta | \\\nbcftools annotate -x ID,INFO -I +'%CHROM:%POS:%REF:%ALT' | \\\nbcftools norm --rm-dup both | \\\nbcftools +fill-tags -Oz  -- -t AF  \\\n&gt; EAS.chr\"${chr}\".split_norm_af.vcf.gz\n\u00a0\u00a0\u00a0\u00a0tabix -p vcf EAS.chr\"${chr}\".split_norm_af.vcf.gz\n    echo \"EAS.chr\"${chr}\".split_norm_af.vcf.gz\" &gt;&gt;concat_list.txt done\n\n# merge\nbcftools concat -a -d both -f concat_list.txt -Ob | bcftools sort -Oz  &gt; EAS.ALL.split_norm_af.1kgp3v5.hg19.vcf.gz\ntabix -p vcf EAS.ALL.split_norm_af.1kgp3v5.hg19.vcf.gz\n</code></pre> The processed dataset can then be used for:</p> <ul> <li>infer palindromic SNPs / indels</li> <li>check allele frequency difference </li> <li>regional plot</li> </ul>"},{"location":"Reference/#rsid-conversion-table-for-quick-annotation","title":"rsID conversion table for quick annotation","text":"<p>Since GWASLab will check chr:pos and ea/nea to match rsID, it would take a little bit longer if we only use vcf. </p> <p>But we can use a pre-annotated conversion table for common SNPs, and then annotate the rest of SNPs using large VCF file from dbSNP.  <pre><code>for i in range(1,23):\n    sumstats = gl.Sumstats(\"./EAS.chr\"+str(i)+\".split_norm_af.vcf.gz\",snpid=\"ID\",fmt=\"vcf\")\n    sumstats.harmonize( basic_check=True,\n                        ref_seq=\"./reference_genome/hg19/human_g1k_v37_decoy.fasta\",\n                        ref_rsid_vcf=\"./All_20180423.vcf.gz\", \n                        n_cores=4)\n    sumstats.data.loc[:,[\"SNPID\",\"rsID\",\"CHR\",\"POS\",\"NEA\",\"EA\"]].to_csv(\"./1kg_af_dbsnp151.\"+str(i)+\".txt.gz\",\"\\t\",index=None)\n</code></pre></p> <p>In terminal, combine the files: <pre><code># get header\nzcat 1kg_af_dbsnp151.1.txt.gz | head -1 &gt; 1kg_af_dbsnp151_auto.txt\n\nfor i in $(seq 1 22)\ndo\n# get complete SNPID-rsID pairs\nzcat 1kg_af_dbsnp151.${i}.txt.gz | awk -v FS=\"\\t\" -v OFS=\"\\t\" 'NR&gt;1 &amp;&amp; $2!=\"\" {print $0}' &gt;&gt;1kg_af_dbsnp151_auto.txt\ndone\n</code></pre></p>"},{"location":"Reference/#dbsnp-database-for-annotation-of-rsid","title":"dbsnp: database for annotation of rsID","text":"<ul> <li>dbsnp v151 (GRCh37): https://ftp.ncbi.nih.gov/snp/organisms/human_9606_b151_GRCh37p13/VCF/00-All.vcf.gz</li> <li>dbsnp v151 (GRCh37): https://ftp.ncbi.nih.gov/snp/organisms/human_9606_b151_GRCh37p13/VCF/00-All.vcf.gz.tbi</li> <li>dbsnp v151 (GRCh38): https://ftp.ncbi.nih.gov/snp/organisms/human_9606_b151_GRCh38p7/VCF//00-All.vcf.gz</li> <li>dbsnp v151 (GRCh38): https://ftp.ncbi.nih.gov/snp/organisms/human_9606_b151_GRCh38p7/VCF//00-All.vcf.gz.tbi</li> <li>latest release: Index of /snp/latest_release/VCF</li> </ul>"},{"location":"Reference/#gnomad","title":"gnomad","text":"<ul> <li>Allele frequency for major ancestries and rsID</li> <li>gnomAD v2 &amp; gnomAD v2 liftover &amp; gnomAD v3:   gnomAD </li> </ul>"},{"location":"Reference/#reference-library-for-variants-annotation","title":"Reference Library for variants annotation","text":"<p>GWASLab uses:</p> <ul> <li>ensembl release 87 (hg19): https://ftp.ensembl.org/pub/grch37/release-109/gtf/homo_sapiens/</li> <li>ensembl release 109 (hg38):  https://ftp.ensembl.org/pub/release-109/gtf/homo_sapiens/</li> <li>NCBI refseq GRCh37 : https://ftp.ncbi.nlm.nih.gov/refseq/H_sapiens/annotation/GRCh37_latest/refseq_identifiers/GRCh37_latest_genomic.gtf.gz</li> <li>NCBI refseq GRCh38 : https://ftp.ncbi.nlm.nih.gov/refseq/H_sapiens/annotation/GRCh38_latest/refseq_identifiers/GRCh38_latest_genomic.gtf.gz</li> </ul> <p>Currently, GWASLab could use either ensembl or refseq gtf reference data to annotate lead SNPs with the nearest gene name.</p>"},{"location":"RegionalPlot/","title":"Regional plots","text":"<p>GWASLab provides off-line functions for creating regional plots.</p> <p>See examples here.</p>"},{"location":"RegionalPlot/#usage","title":"Usage","text":"<p><pre><code>mqqplot(  vcf_path=None,\n          vcf_chr_dict=get_number_to_chr(),\n          gtf_path=\"defualt\",\n          mlog10p=\"MLOG10P\",\n          scaled=False,\n          mode=\"r\",\n          # region\n          region = None,\n          region_step = 21,\n          region_grid = False,\n          region_grid_line = {\"linewidth\": 2,\"linestyle\":\"--\"},\n          region_lead_grid = True,\n          region_lead_grid_line = {\"alpha\":0.5,\"linewidth\" : 2,\"linestyle\":\"--\",\"color\":\"#FF0000\"},\n          region_hspace=0.02,\n          region_ld_threshold = [0.2,0.4,0.6,0.8],\n          region_ld_colors = [\"#E4E4E4\",\"#020080\",\"#86CEF9\",\"#24FF02\",\"#FDA400\",\"#FF0000\",\"#FF0000\"],\n          region_ld_colors1 = [\"#E4E4E4\",\"#F8CFCF\",\"#F5A2A5\",\"#F17474\",\"#EB4445\",\"#E51819\",\"#E51819\"],\n          region_ld_colors2 = [\"#E4E4E4\",\"#D8E2F2\",\"#AFCBE3\",\"#86B3D4\",\"#5D98C4\",\"#367EB7\",\"#367EB7\"],\n          region_recombination = True,\n          region_protein_coding=True,\n          region_flank_factor = 0.05,\n          taf=[4,0,0.95,1,1],\n          # track_n, track_n_offset,font_ratio,exon_ratio,text_offset\n          mqqratio=3,\n          windowsizekb=500,\n          anno=None,\n          anno_set=[],\n          anno_alias={},\n          anno_d={},\n          anno_source = \"ensembl\",\n          arm_offset=50,\n          arm_scale=1,\n          cut=0,\n          skip=0,\n          cutfactor=10,\n          cut_line_color=\"#ebebeb\",  \n          sig_level=5e-8,\n          sig_line_color=\"grey\",\n          suggestive_sig_level=5e-6,\n          highlight = [],\n          highlight_color=\"#CB132D\",\n          highlight_windowkb = 500,\n          pinpoint=[],\n          pinpoint_color =\"red\",\n          stratified=False,\n          maf_bins=[(0, 0.01), (0.01, 0.05), (0.05, 0.25),(0.25,0.5)],\n          maf_bin_colors = [\"#f0ad4e\",\"#5cb85c\", \"#5bc0de\",\"#000042\"],\n          gc=True,\n          title =None,\n          mtitle=None,\n          qtitle=None,\n          figargs= {\"figsize\":(15,5),\"dpi\":100},\n          fontsize = 10,\n          colors=[\"#597FBD\",\"#74BAD3\"],\n          marker_size=(5,25),\n          use_rank=False,\n          verbose=True,\n          repel_force=0.03,\n          build=\"19\",\n          title_pad=1.08, \n          save=None,\n          saveargs={\"dpi\":400,\"facecolor\":\"white\"},\n          log=Log()\n          ):\n</code></pre> GWASLab regional plot function is based on plot_mqq().</p>"},{"location":"RegionalPlot/#regional-mqq-plot","title":"Regional mqq plot","text":"<pre><code>!wget -O t2d_bbj.txt.gz http://jenger.riken.jp/14/\n</code></pre> <p><pre><code>mysumstats = gl.Sumstats(\"t2d_bbj.txt.gz\",\n             snpid=\"SNP\",\n             chrom=\"CHR\",\n             pos=\"POS\",\n             neaf=\"Frq\",\n             p=\"P\")\n\nmysumstats.plot_mqq(region=(7,156538803,157538803))\n</code></pre> </p>"},{"location":"RegionalPlot/#regional-plot-without-ld","title":"Regional plot without LD","text":"<p><pre><code>mysumstats.plot_mqq(mode=\"r\", region=(7,156538803,157538803),region_grid=True)\n</code></pre> </p>"},{"location":"RegionalPlot/#regional-plot","title":"Regional plot","text":"<p><pre><code>mysumstats.plot_mqq(mode=\"r\",region=(7,156538803,157538803),region_grid=True,\n                    vcf_path=\"/home/yunye/mydata/d_disk/eas_1kg_af/EAS.chr7.split_norm_af.vcf.gz\")\n</code></pre> </p>"},{"location":"RegionalPlot/#two-reference-variant-regional-plot","title":"Two-reference-variant regional plot","text":"<p><pre><code>mysumstats.plot_mqq(mode=\"r\",region=(7,156538803,157538803),\n                    region_grid=True,\n                    region_ref =\"7:156994964_C_T\",\n                    region_ref2=\"7:156793713_T_C\",\n                    vcf_path=gl.get_path(\"1kg_eas_hg19\"))\n</code></pre> </p>"},{"location":"Standardization/","title":"Standardization and Normalization","text":"<p>After loading raw sumstats into gwaslab.Sumstats Object, the first thing we probably want to do is to standardize the variant-related notations, normalize the indels and check if there are any unexpected errors in the statistics. When checking is finished, the status code will be automatically changed.</p> <p>See examples here.</p>"},{"location":"Standardization/#methods-summary","title":"Methods Summary","text":"Sumstats Methods Options Description <code>.fix_id()</code> <code>fixchrpos=False</code>, <code>fixid=False</code>, <code>fixsep=False</code>,<code>overwrite=False</code>,<code>forcefixid=False</code> check and\u00a0 fix rsID or SNPID(chr:pos:ref:alt), or use snpid to fix CHR and POS <code>.fix_chr()</code> <code>remove=False</code>, <code>x=(\"X\",23)</code>, <code>y=(\"Y\",24)</code>, <code>mt=(\"MT\",25)</code>, <code>chrom_list = gl.get_chr_list()</code> standardize chromsome notation <code>.fix_pos()</code> <code>remove=False</code> , <code>limit=250000000</code> standardize basepair posituion notation and filter out bad values <code>.fix_allele()</code> <code>remove=False</code> standardize base notation to ATCG <code>.normalize_allele()</code> <code>n_cores=1</code> normalize indels (only support ATA:AA -&gt; AT:A but not -:T) <code>.sort_coordinate()</code> sort the variant coordinates <code>.sort_column()</code> sort the column order to GWASLab default <code>.basic_check()</code> all-in-one function to perform the defaul pipeline"},{"location":"Standardization/#1-ids","title":"1. IDs","text":"<p>GWASLab requires at least one ID column for sumstats, either in the form of SNPID or rsID, (or both). GWASLab will automatically check if SNPID is mixed in rsID.</p> <ul> <li><code>SNPID</code> : it could be user-provided IDs, or in <code>CHR:POS:REF:ALT</code> format, delimiters can be <code>\":\"</code>,<code>\"_\"</code> or <code>\"-\"</code>.</li> <li><code>rsID</code>: dbSNP rsIDs</li> </ul> <p>GWASLab will check if the IDs is valid SNPID or rsID.  It can also extract CHR and POS information from the <code>CHR:POS:REF:ALT</code> formatted IDs using <code>.fix_id()</code> method.</p> <p>SNPID will be fixed by <code>CHR:POS:NEA:EA</code>  only when the variants are already aligned with the reference genome. Otherwise, a temporary SNPID in the format of <code>CHR:POS</code> will be assigned.</p> <p><code>.fix_id()</code>: check or fix SNPID and rsID.\u00a0\u00a0\u00a0</p> <code>.fix_id()</code> options Type Description <code>fixchrpos</code> <code>Boolean</code> If True, extract CHR and POS from SNPID (CHR:POS:NEA:EA) to fill CHR and POS columns (deaful:<code>False</code>) <code>fixid</code> <code>Boolean</code> If True, use CHR/POS/NEA/EA to reconstruct the SNPID. For variant that are not aligned with reference genome. Only CHR/POS will be used. (deaful:<code>False</code>) <code>forcefixid</code> <code>Boolean</code> If True, use CHR/POS/NEA/EA to reconstruct the SNPID without checking if the variant is aligned. (deaful:<code>False</code>) <code>fixsep</code> <code>Boolean</code> If True, fix SNPID delimiter (For example: 1:123_A_C to 1:123:A:C) (deaful:<code>False</code>) <code>overwrite</code> <code>Boolean</code> If True, overwrite existing data. (deaful:<code>False</code>) <p>Example</p> <pre><code>sumstats.fix_id(fixchrpos=False,\n                fixid=False,\n                fixsep=False,\n                forcefixid=False,\n                overwrite=False)\n</code></pre>"},{"location":"Standardization/#2-chr","title":"2. CHR","text":"<pre><code>.fix_chr(\n    x=(\"X\",23), \n    y=(\"Y\",24), \n    mt=(\"MT\",25),\n    chrom_list=gl.get_chr_list()\n)\n</code></pre> <p>CHR will be standardized to integers. </p> <ul> <li><code>\"x\",\"y\",\"mt\"</code>: <code>tuple</code> , how to convert sex chromosomes. For examplem <code>x = (\"X\",23)</code></li> <li><code>chrom_list</code> : <code>list</code> , vaild chromosome notations for filtering. Datatype should be <code>string</code> or <code>object</code>.</li> </ul> <p>(by default) For human chromosomes, CHR will be converted to integers for autosomes, <code>23</code> for <code>X</code>, <code>24</code> for <code>Y</code>, and <code>25</code> for <code>MT</code>. </p> <ul> <li><code>x=(\"X\",23)</code> </li> <li><code>y=(\"Y\",24)</code> </li> <li><code>mt=(\"MT\",25)</code></li> </ul> <p>For other species, you can change it like:</p> <ul> <li><code>x=(\"X\",26)</code> </li> <li><code>y=(\"Y\",27)</code> </li> <li><code>mt=(\"MT\",28)</code></li> <li><code>chrom_list=gl.get_chr_list(n=28)</code></li> </ul> <p>Example</p> <pre><code>sumstats.fix_chr(x=(\"X\",23))\n</code></pre> <p>!!! tip gl.get_chr_list()     Get a chromosome list for n autosomes and 'X', 'Y', 'M', 'MT. (\"string\" data type)     <pre><code>gl.get_chr_list(n=10)\n['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'X', 'Y', 'M', 'MT']\n</code></pre></p>"},{"location":"Standardization/#3-pos","title":"3. POS","text":"<p><code>.fix_pos()</code></p> <p>Values in POS must be positive integer numbers. Basepair position will be force converted to integers. Invalid pos will be converted to NA. </p> <p><code>limit=250000000</code> : After conversion, GWASLab will also sanity check if POS is in the range of 1 to 250,000,000. (the longest chromosome, CHR1, is around 250,000,000bp long)  </p> <p>Example</p> <pre><code>sumstats.fix_pos(remove=False, limit=250000000)\n</code></pre>"},{"location":"Standardization/#4-allele","title":"4. Allele","text":""},{"location":"Standardization/#41-allele-notation-standardization","title":"4.1 Allele notation Standardization","text":"<p><code>.fix_allele()</code></p> <ul> <li>Currently, GWASLab only supports processing SNPs and INDELs. </li> <li>All alleles will be checked if containing letters other than <code>A</code>,<code>T</code>,<code>C</code>,<code>G</code>.</li> <li>Copy number variant (CNV) like <code>&lt;CN0&gt;</code> won't be recognized.</li> <li>Lower cases will be converted to UPPERCASES.</li> </ul> <p>Example</p> <pre><code>sumstats.fix_allele(remove=False)\n</code></pre>"},{"location":"Standardization/#42-variant-normalization","title":"4.2 Variant Normalization","text":"<p><code>.normalize_allele()</code></p> <p>Alleles will be normalized according to the left alignment and parsimony principle. For example, chr1:123456:ATG:AT will be normalized to chr1:123457:TG:T.</p> <p><code>n_cores</code>: threads to use for normalization.</p> <p>Note</p> <p>Currently, the normalization is implemented without checking reference, which means it can not normalize variants like chr1:123456:G:- if the missing information needs to be obtained from a reference genome.  </p> <p>Quote</p> <p>For details on variant normalization, please check: https://genome.sph.umich.edu/wiki/Variant_Normalization )</p> <p>Example</p> <pre><code>sumstats.normalize_allele(n_cores=1)\n</code></pre> <p>Before:</p> <p></p> <p>After:</p> <p></p>"},{"location":"Standardization/#5-coordinate-sorting","title":"5. Coordinate sorting","text":"<p>Sort genomic coordinates. Make sure CHR and POS are fixed beforehand.</p> <p>Example</p> <pre><code>sumstats.sort_coordinate()\n</code></pre>"},{"location":"Standardization/#6-column-sorting","title":"6. Column sorting","text":"<p>The default column order is <code>\"SNPID\",\"rsID\", \"CHR\", \"POS\", \"EA\", \"NEA\", \"EAF\", \"BETA\", \"SE\", \"Z\",  \"CHISQ\", \"P\", \"MLOG10P\", \"OR\", \"OR_95L\", \"OR_95U\", \"INFO\", \"N\",\"DIRECTION\",\"STATUS\" and other additional columns</code>.</p> <p><code>order</code>:<code>list</code> , column order.</p> <p>Example</p> <pre><code>sumstats.sort_column()\n</code></pre>"},{"location":"Standardization/#all-in-one-basic_check","title":"All-in-one <code>.basic_check()</code>","text":"<p><pre><code>.basic_check()\n</code></pre> Fix data without dropping any variant.</p> <p><code>basic_check()</code> pipeline</p> <ul> <li>fix_id()</li> <li>fix_chr()</li> <li>fix_pos()</li> <li>fix_allele()</li> <li>normalize_allele()</li> <li>sort_coordinate()</li> <li>sort_column()</li> </ul>"},{"location":"Standardization/#example","title":"Example","text":"<p>Please check https://cloufield.github.io/gwaslab/standardization_workflow/</p>"},{"location":"StatusCode/","title":"Status Code","text":"<ul> <li>A 7-digit code:  showing the status of a variant.</li> <li>Reflecting the reliability of the statistics.</li> <li>Design principals:<ul> <li>Traceable</li> <li>Higher value -&gt; higher uncertainty </li> </ul> </li> </ul> Digit Description 1,2 Genome_build 3 rsID &amp; SNPID 4 CHR, POS 5 EA, NEA 6 REF-NEA Alignment 7 Palindromic SNPs + Indels"},{"location":"StatusCode/#summary","title":"Summary","text":"<pre><code>mysumstats.summary()\n</code></pre>"},{"location":"StatusCode/#look-up-the-status-code","title":"Look up the status code","text":"<pre><code>mysumstats.lookup_status()\n</code></pre>"},{"location":"StatusCode/#reference-table","title":"Reference table","text":""},{"location":"SumstatsObject/","title":"Sumstats Object in GWASLab","text":"<p>In GWASLab, sumstats were stored in a <code>Sumstats Object</code>\uff0cwhich is built on <code>pandas Dataframe</code>. All other function are designed as methods of this Sumstats Object. </p> <p>To load any sumstats into the object, simply specify the column name and load the raw GWAS summary statsitics from a pandas dataframe or specifying file path. All raw data will be loaded as <code>\"string\"</code> datatype. </p>"},{"location":"SumstatsObject/#usage","title":"Usage","text":"<pre><code>mysumstats = gl.Sumstats(\n             sumstats,\n             fmt=None,\n             snpid=None,\n             rsid=None,\n             chrom=None,\n             pos=None,\n             ea=None,\n             nea=None,\n             ref=None,\n             alt=None,\n             eaf=None,\n             neaf=None,\n             n=None,\n             beta=None,\n             se=None,\n             chisq=None,\n             z=None,\n             p=None,\n             mlog10p=None,\n             info=None,\n             OR=None,\n             OR_95L=None,\n             OR_95U=None,\n             status=None,\n             other=[],\n             direction=None,\n             verbose=True,\n             build=\"99\",\n             **args\n)\n</code></pre>"},{"location":"SumstatsObject/#parameters","title":"Parameters","text":"<p><code>sumstats</code>: either a file path <code>string</code> or a pandas <code>DataFrame</code></p> <p>Currently, GWASLab supports the following columns:</p> <ul> <li><code>snpid</code>: variant ID column name, preferably in chr:pos:ea:nea format.</li> <li><code>rsid</code>: dbSNP rsID column name</li> </ul> <p>The minimum required columns are just either <code>rsid</code>or <code>snpid</code>.  All other columns and options are optional.</p> <ul> <li><code>fmt</code>: <code>string</code>, input sumstats format. For formats supported by GWASLab, please check https://github.com/Cloufield/formatbook</li> <li><code>chrom</code>: <code>string</code>, chromosome column name</li> <li><code>pos</code>: <code>string</code>, basepair position column name</li> <li><code>ea</code>: <code>string</code>, effect allele column name. </li> <li><code>nea</code>: <code>string</code>, non-effect allele column name.</li> <li><code>ref</code>: <code>string</code>, reference allele column name.</li> <li><code>alt</code>: <code>string</code>, alternative allele column name , when <code>ea</code>,<code>ref</code> and <code>alt</code> are specified, <code>nea</code> will be inferred.</li> <li><code>eaf</code>: <code>string</code>, effect allele frequency</li> <li><code>neaf</code>: <code>string</code>, non-effect allele frequency. NEAF will be converted to EAF (EAF = 1 - NEAF) while loading.</li> <li><code>n</code> <code>string</code> or <code>integer</code>, sample size column name or just input a single <code>integer</code> as sample size for all variants.</li> <li><code>beta</code>: <code>string</code>, effect size beta column name</li> <li><code>se</code>: <code>string</code>, standard error column name</li> <li><code>chisq</code>: <code>string</code>, chi square column name</li> <li><code>z</code>: <code>string</code>, z score column name</li> <li><code>p</code>: <code>string</code>, p value column name</li> <li><code>mlog10p</code>: <code>string</code>, -log10(P) column name</li> <li><code>info</code>: <code>string</code>, imputation info or rsq column name</li> <li><code>OR</code>: <code>string</code>, odds ratio column name</li> <li><code>OR_95L</code>: <code>string</code>, odds ratio lower 95% ci column name</li> <li><code>OR_95U</code>:<code>string</code>, odds ratio upper 95% ci column name</li> <li><code>direction</code>: <code>string</code>, direction column name. GWASLab uses METAL format (e.g. \"++--+?+\")</li> <li><code>other</code>: <code>list</code>, a list  of other column names you want to keep with the core columns (probably some annotations).</li> <li><code>status</code>: <code>string</code>, status code column name. GWASLab uses a 7-digit vairant status code. For details, please check status code page.</li> <li><code>verbose</code>: <code>boolean</code>, if True, print log. </li> <li><code>build</code>:  <code>string</code>, genome build. <code>19</code> for hg19, <code>38</code> for hg38 and <code>99</code> for unknown.</li> <li><code>**arg</code>: additional parameters for pd.read_table() function. Some common options include : <code>sep</code>,<code>nrows</code>, <code>skiprows</code> and <code>na_values</code>.</li> </ul>"},{"location":"SumstatsObject/#loading-sumstats","title":"Loading sumstats","text":"<p>You can load the sumstats by specifying the columns like:</p> <p>Load sumstats by manually specifying columns</p> <pre><code>mysumstats = gl.Sumstats(\"t2d_bbj.txt.gz\",\n             snpid=\"SNPID\",\n             chrom=\"CHR\",\n             pos=\"POS\",\n             ea=\"Allele2\",\n             nea=\"Allele1\",\n             eaf=\"AF_Allele2\",\n             beta=\"BETA\",\n             se=\"SE\",\n             p=\"p.value\",\n             n=\"N\")\n</code></pre> <p>or just specify the sumstats format:</p> <p>Load sumstats by simply specifying the format</p> <pre><code>mysumstats = gl.Sumstats(\"t2d_bbj.txt.gz\", fmt=\"saige\")\n</code></pre> <p>Note</p> <p>GWASLab uses manually curated format conversion dictionary in https://github.com/Cloufield/formatbook</p> <p>Supported formats:</p> <ul> <li><code>ssf</code>: GWAS-SSF</li> <li><code>gwascatalog</code> : GWAS Catalog format</li> <li><code>pgscatalog</code> : PGS Catalog format</li> <li><code>plink</code>: PLINK output format</li> <li><code>plink2</code>: PLINK2 output format</li> <li><code>saige</code>: SAIGE output format</li> <li><code>regenie</code>: output format</li> <li><code>fastgwa</code>: output format</li> <li><code>metal</code>: output format</li> <li><code>mrmega</code>: output format</li> <li><code>fuma</code>: input format</li> <li><code>ldsc</code>: input format</li> <li><code>locuszoom</code>: input format</li> <li><code>vcf</code>: gwas-vcf format</li> <li><code>bolt_lmm</code>: output format</li> </ul>"},{"location":"SumstatsObject/#loading-sumstats-from-chromosome-separated-files","title":"Loading sumstats from chromosome-separated files","text":"<p>GWASLab support loading sumstats from chromosome-separated files (file names need to be in the same pattern.). Just use @ to replace chromosome number. </p> <p>Example</p> <pre><code>mysumstats = gl.Sumstats(\"t2d.chr@.txt.gz\",fmt=\"metal\")\n</code></pre>"},{"location":"SumstatsObject/#check-and-save-sumstats","title":"Check and save sumstats","text":"<p>After loading, the raw data columns will be renamed to new columns without ambiguity and the dataframe is store in <code>.data</code> :</p> <p>Example</p> <pre><code>mysumstats.data\n</code></pre> <p>You can simply save the processed data using pandas saving functions, for example:</p> <p>Example</p> <pre><code>mysumstats.data.to_csv(\"./mysumstats.csv\")\n</code></pre> <p>or convert the sumstats to other sumstats using GWASLab <code>to_format()</code> function (strongly recommended):</p> <p>Example</p> <pre><code>mysumstats.to_format(\"./mysumstats\", fmt=\"ldsc\",hapmap3=True, exclude_hla=True, build=\"19\")\n</code></pre> <p>Please check GWASLab - Format for more details.</p>"},{"location":"SumstatsObject/#saving-half-finished-sumstats-object","title":"Saving half-finished Sumstats Object","text":"<p>If the pipeline is very long, and you need to temporarily save the Sumstats Object, you can use the <code>.dump_pickle()</code> method to temporarily save the Sumstats Object.</p> <p>Please check GWASLab - Pickle for more details.</p>"},{"location":"SumstatsObject/#logging","title":"Logging","text":"<p>All manipulation conducted to the sumstats will be logged for reproducibility and traceability. </p> <p>The log is stored in a <code>gl.Log()</code> object . You can check it by <code>.log.show()</code>and save it using <code>.log.save()</code></p> <p>Example</p> <pre><code>mysumstats.log.show()\n\nmysumstats.log.save()\n</code></pre>"},{"location":"SumstatsObject/#sumstats-summary","title":"Sumstats summary","text":"<p>You can check the meta information of sumstats by:</p> <p>Example</p> <pre><code>mysumstats.summary()\n</code></pre>"},{"location":"SumstatsObject/#other-functions","title":"Other functions","text":"<p>Other functions of GWASLab are implemented as the methods of Sumstats Object.</p> <p>Example</p> <pre><code>mysumstats.basic_check()\n\nmysumstats.plot_mqq()\n\n...\n</code></pre>"},{"location":"Tutorial/","title":"Quick Start","text":""},{"location":"Tutorial/#import-gwaslab-and-load-data","title":"import gwaslab and load data","text":"<p>Using a jupyter notebook, we first import gwaslab package:</p> <pre><code>import gwaslab as gl\n</code></pre> <p>The sample sumstats we use in this study: </p> <pre><code>!wget -O t2d_bbj.txt.gz http://jenger.riken.jp/14/\n</code></pre> <p>Let's import this raw sumstats into the gwaslab Sumstats Object by specifying the necessary columns, and all data are imported as strings. Note: you can either specify eaf (effect allele frequency) or neaf(non-effect allele frequency), if neaf is specified, it will be converted to eaf when loading sumstats. <pre><code>mysumstats = gl.Sumstats(\"t2d_bbj.txt.gz\",\n             snpid=\"SNP\",\n             chrom=\"CHR\",\n             pos=\"POS\",\n             ea=\"ALT\",\n             nea=\"REF\",\n             neaf=\"Frq\",\n             beta=\"BETA\",\n             se=\"SE\",\n             p=\"P\",\n             direction=\"Dir\",\n             n=\"N\",\n             build=\"19\")\n</code></pre> See details in SumstatsObject.</p> <p>Sumstats are loaded stored as pandas DataFrame, you can check the data by  <pre><code>mysumstats.data\n\n    SNPID   CHR POS EA  NEA EAF BETA    SE  P   N   DIRECTION   STATUS\n0   1:725932_G_A    1   725932  G   A   0.9960  -0.0737 0.1394  0.5970  166718  -?+-    9999999\n1   1:725933_A_G    1   725933  G   A   0.0040  0.0737  0.1394  0.5973  166718  +?-+    9999999\n2   1:737801_T_C    1   737801  C   T   0.0051  0.0490  0.1231  0.6908  166718  +?-+    9999999\n3   1:749963_T_TAA  1   749963  TAA T   0.8374  0.0213  0.0199  0.2846  166718  -?++    9999999\n4   1:751343_T_A    1   751343  T   A   0.8593  0.0172  0.0156  0.2705  166718  -?++    9999999\n</code></pre></p> <p>Maybe the first thing you want to check is the manhattan plot, you can do this with one line of code, gwaslab will perform a minimum QC for just the plotting. For details, please check: https://cloufield.github.io/gwaslab/Visualization/</p>"},{"location":"Tutorial/#quick-mqq-plot","title":"quick mqq plot","text":"<p><pre><code>mysumstats.plot_mqq(skip=2)\n</code></pre> <code>skip=2</code> : skip variants with -log10P&lt;2 for plotting, which greatly improves plotting speed.</p> <p></p>"},{"location":"Tutorial/#standardization-normalization","title":"Standardization &amp; normalization","text":"<p>It is needed to check ID,CHR,POS and alleles first before any manipulations:</p> <p>Simply run the following function and every thing will be checked. </p> <pre><code>mysumstats.basic_check()\n</code></pre> <p><code>.basic_check()</code> is a wrapper of all the following basic functions, you can use these separately.</p> <p><pre><code>mysumstats.fix_ID()\nmysumstats.fix_chr()\nmysumstats.fix_pos()\nmysumstats.fix_allele()\nmysumstats.check_sanity()\nmysumstats.normalize_allele()\n</code></pre> See details in Standardization.</p>"},{"location":"Tutorial/#fix-id","title":"Fix ID","text":"<p>Usually we want SNPID to be in a stadardized format chr:pos:ref:alt, we can use fix_id for this:</p> <pre><code>mysumstats.fix_id(fixsep=True)\n</code></pre>"},{"location":"Tutorial/#extract-lead-variants","title":"Extract lead variants","text":"<p>Let's extract the lead variants in each significant loci to check our data. </p> <p>The significant loci are detected based on a sliding window (default window size: 500kb)</p> <pre><code>mysumstats.get_lead(anno=True)\n</code></pre> <p>By specifying <code>anno=True</code> , gwaslab will also annotate the lead variant with its nearest gene names and distance.</p> <p>Note: gwaslab default genome build version is <code>build=\"19\"</code> (GRCh37/hg19), you can change it to <code>build=\"38\"</code> (GRCh38/hg38) when needed.</p> <pre><code>SNPID   CHR POS EA  NEA EAF BETA    SE  P   N   DIRECTION   STATUS  LOCATION    GENE\n96739   1:22068326:A:G  1   22068326    G   A   0.7550  0.0621  0.0103  1.629000e-09    191764  ++++    9960099 0   USP48\n213860  1:51103268:T:C  1   51103268    C   T   0.7953  -0.0802 0.0120  2.519000e-11    191764  ----    9960099 0   FAF1\n534095  1:154309595:TA:T    1   154309595   TA  T   0.0947  -0.0915 0.0166  3.289000e-08    191764  ----    9960399 0   ATP8B2\n969974  2:640986:CACAT:C    2   640986  C   CACAT   0.9006  -0.0946 0.0150  2.665000e-10    191764  ----    9960399 26349   TMEM18\n1091807 2:27734972:G:A  2   27734972    G   A   0.5605  0.0691  0.0088  3.897000e-15    191764  ++++    9960099 0   GCKR\n</code></pre> <p>See details in ExtractLead.</p>"},{"location":"Tutorial/#customized-manhattan-plot","title":"Customized manhattan plot","text":"<p>GWASlab can plot more complicated manhattan plot.</p> <p>For details, please check: https://cloufield.github.io/gwaslab/Visualization/</p> <pre><code>mysumstats.plot_mqq(snpid=\"SNPID\",mode=\"mqq\",\n                  cut=20,skip=3, eaf=\"EAF\",\n                  anno=True,anno_set=[\"9:22132729_A_G\",\"6:20688121_T_A\",\"9:22132729_A_G\",\"15:62394264_G_C\"] ,\n                  pinpoint=[\"9:22132729_A_G\",\"5:176513896_C_A\"], \n                  highlight=[\"7:127253550_C_T\",\"19:46166604_C_T\"],\n                  highlight_windowkb =1000,\n                  stratified=True,\n                  marker_size=(5,10),\n                  figargs={\"figsize\":(15,5),\"dpi\":300})\n</code></pre> <p></p> <p>See details in Visualization.</p>"},{"location":"Tutorial/#regional-plot","title":"Regional plot","text":"<p>Quick regional plot without LD-information <pre><code>mysumstats.plot_mqq(mode=\"r\",region=(7,156538803,157538803),region_grid=True)\n</code></pre></p> <p>Note: gwaslab default genome build version is <code>build=\"19\"</code> (GRCh37/hg19), you can change it to <code>build=\"38\"</code> (GRCh38/hg38) when needed. For gene tracks, default is <code>gtf_path=\"ensembl\"</code> , you can also use <code>gtf_path=\"refseq\"</code> (NCBA RefSeq)</p> <p></p> <p>Full regional plot using a user-provided vcf  (e.g 1000 genome, see Reference: https://cloufield.github.io/gwaslab/Reference/))</p> <pre><code>mysumstats.plot_mqq(mode=\"r\",region=(7,156538803,157538803),region_grid=True,anno=True,\n                    vcf_path=\"/Users/he/Documents/Mydata/eas_1kg_af/EAS.chr7.split_norm_af.1kgp3v5.vcf.gz\")\n</code></pre> <p></p>"},{"location":"Tutorial/#random-sampling","title":"Random sampling","text":"<p>There are more than 10 million variants in the original sumstats and it will take long to process the entrie dataset.  Since it might take a while to process the entire datasets, let us just random sample 1 million variants for this tutorial.</p> <pre><code>mysumstats.random_variants(n=100000)\n</code></pre>"},{"location":"Tutorial/#harmonise-the-sumstats","title":"Harmonise the sumstats","text":"<ul> <li>ref_seq : reference genome fasta file for allele alignment</li> <li>ref_rsid_tsv : tsv file for annotation of common used variants</li> <li>ref_rsid_vcf : vcf file for annotation of other variants</li> <li>ref_infer : vcf file with allele frequency information for inferring strand and comparing allele frequency </li> <li>ref_alt_freq : field in INFO of vcf file for alternative allele frequency</li> </ul> <p>For details see: https://cloufield.github.io/gwaslab/Harmonization/</p> <p><pre><code>mysumstats.harmonize(basic_check=False,\n                    n_cores=3,\n                    ref_seq=\"/Users/he/Documents/Mydata/human_g1k_v37.fasta\",\n                    ref_rsid_tsv=\"/Users/he/Documents/Mydata/EAS_1kg_af_dbsnp151.ALL.tsv\",\n                    ref_rsid_vcf=\"/Users/he/Documents/Mydata/All_20180423.vcf.gz\",\n                    ref_infer=\"/Users/he/Documents/Mydata/eas_1kg_af/EAS.ALL.split_norm_af.1kgp3v5.hg19.vcf.gz\",ref_alt_freq=\"AF\")\n</code></pre> gwaslab will then harmonize the sumstats based on reference files.  <pre><code>Fri Oct 21 16:05:39 2022 Start to check if NEA is aligned with reference sequence...\nFri Oct 21 16:05:39 2022  -Current Dataframe shape : 100000  x  12\nFri Oct 21 16:05:39 2022  -Reference genome fasta file: /Users/he/Documents/Mydata/human_g1k_v37.fasta\nFri Oct 21 16:05:39 2022  -Checking records: 1  2  3  4  5  6  7  8  9  10  11  12  13  14  15  16  17  18  19  20  21  22  X  Y  MT  \nFri Oct 21 16:06:11 2022  -Variants allele on given reference sequence :  41646\nFri Oct 21 16:06:11 2022  -Variants flipped :  50095\nFri Oct 21 16:06:11 2022   -Raw Matching rate :  91.74%\nFri Oct 21 16:06:11 2022  -Variants inferred reverse_complement :  0\nFri Oct 21 16:06:11 2022  -Variants inferred reverse_complement_flipped :  0\nFri Oct 21 16:06:11 2022  -Both allele on genome + unable to distinguish :  8259\nFri Oct 21 16:06:11 2022  -Variants not on given reference sequence :  0\nFri Oct 21 16:06:11 2022  -Current Dataframe shape : 100000  x  12\nFri Oct 21 16:06:12 2022 Start to flip allele-specific stats for SNPs with status xxxxx[35]x: alt-&gt;ea , ref-&gt;nea ... \nFri Oct 21 16:06:12 2022  -Flipping 50095 variants...\nFri Oct 21 16:06:12 2022  -Swapping column: NEA &lt;=&gt; EA...\nFri Oct 21 16:06:12 2022  -Flipping column: BETA = - BETA...\nFri Oct 21 16:06:12 2022  -Flipping column: EAF = 1 - EAF...\nFri Oct 21 16:06:12 2022  -Flipping column: DIRECTION +-? &lt;=&gt; -+? ...\nFri Oct 21 16:06:13 2022  -Changed the status for flipped variants : xxxxx[35]x -&gt; xxxxx[12]x\nFri Oct 21 16:06:13 2022 Finished converting successfully!\nFri Oct 21 16:06:13 2022 Start to infer strand for palindromic SNPs...\nFri Oct 21 16:06:13 2022  -Current Dataframe shape : 100000  x  12\nFri Oct 21 16:06:13 2022  -Reference vcf file: /Users/he/Documents/Mydata/eas_1kg_af/EAS.ALL.split_norm_af.1kgp3v5.hg19.vcf.gz\nFri Oct 21 16:06:13 2022  -Alternative allele frequency in INFO: AF\nFri Oct 21 16:06:14 2022  -Identified  14046  palindromic SNPs...\nFri Oct 21 16:06:14 2022  -After filtering by MAF&lt;  0.4  , the strand of  12814  palindromic SNPs will be inferred...\nFri Oct 21 16:06:36 2022   -Non-palindromic :  76945\nFri Oct 21 16:06:36 2022   -Palindromic SNPs on + strand:  12456\nFri Oct 21 16:06:37 2022   -Palindromic SNPs on - strand and need to be flipped: 22\nFri Oct 21 16:06:37 2022   -Palindromic SNPs with maf not availble to infer :  1232\nFri Oct 21 16:06:37 2022   -Palindromic SNPs with no macthes or no information :  186\nFri Oct 21 16:06:38 2022  -Identified  8259  indistinguishable Indels...\nFri Oct 21 16:06:38 2022  -Indistinguishable Indels will be inferred from reference vcf ref and alt...\nFri Oct 21 16:07:11 2022   -Indels ea/nea match reference :  3520\nFri Oct 21 16:07:11 2022   -Indels ea/nea need to be flipped :  4468\nFri Oct 21 16:07:11 2022   -Indels with no macthes or no information :  271\nFri Oct 21 16:07:11 2022  -Current Dataframe shape : 100000  x  12\nFri Oct 21 16:07:12 2022 Start to flip allele-specific stats for standardized indels with status xxxx[123][67][6]: alt-&gt;ea , ref-&gt;nea ... \nFri Oct 21 16:07:12 2022  -Flipping 4468 variants...\nFri Oct 21 16:07:13 2022  -Swapping column: NEA &lt;=&gt; EA...\nFri Oct 21 16:07:13 2022  -Flipping column: BETA = - BETA...\nFri Oct 21 16:07:13 2022  -Flipping column: EAF = 1 - EAF...\nFri Oct 21 16:07:13 2022  -Flipping column: DIRECTION +-? &lt;=&gt; -+? ...\nFri Oct 21 16:07:13 2022  -Changed the status for flipped variants xxxx[123][67]6 -&gt; xxxx[123][67]4\nFri Oct 21 16:07:13 2022 Start to flip allele-specific stats for palindromic SNPs with status xxxxx[12]5: (-)strand &lt;=&gt; (+)strand ... \nFri Oct 21 16:07:13 2022  -Flipping 22 variants...\nFri Oct 21 16:07:13 2022  -Flipping column: BETA = - BETA...\nFri Oct 21 16:07:13 2022  -Flipping column: EAF = 1 - EAF...\nFri Oct 21 16:07:13 2022  -Flipping column: DIRECTION +-? &lt;=&gt; -+? ...\nFri Oct 21 16:07:13 2022  -Changed the status for flipped variants:  xxxxx[012]5: -&gt;  xxxxx[012]2\nFri Oct 21 16:07:13 2022 Finished converting successfully!\nFri Oct 21 16:07:13 2022 Start to annotate rsID based on chromosome and position information...\nFri Oct 21 16:07:13 2022  -Current Dataframe shape : 100000  x  12\nFri Oct 21 16:07:13 2022  -SNPID-rsID text file: /Users/he/Documents/Mydata/EAS_1kg_af_dbsnp151.ALL.tsv\nFri Oct 21 16:07:13 2022  -100000 rsID could be possibly fixed...\nFri Oct 21 16:07:14 2022  -Setting block size:  5000000\nFri Oct 21 16:07:14 2022  -Loading block: 0   1   2   3   4   5   6   7   8   9   10   11   12   13   14   15   16   \nFri Oct 21 16:11:57 2022  -rsID Annotation for 3250 need to be fixed!\nFri Oct 21 16:11:57 2022  -Annotated 96750 rsID successfully!\nFri Oct 21 16:11:57 2022 Start to assign rsID using vcf...\nFri Oct 21 16:11:57 2022  -Current Dataframe shape : 100000  x  13\nFri Oct 21 16:11:57 2022  -CPU Cores to use : 3\nFri Oct 21 16:11:57 2022  -Reference VCF file: /Users/he/Documents/Mydata/All_20180423.vcf.gz\nFri Oct 21 16:11:57 2022  -Assigning rsID based on chr:pos and ref:alt/alt:ref...\nFri Oct 21 16:12:18 2022  -rsID Annotation for 582 need to be fixed!\nFri Oct 21 16:12:18 2022  -Annotated 2668 rsID successfully!\nFri Oct 21 16:12:18 2022 Start to sort the genome coordinates...\nFri Oct 21 16:12:18 2022  -Current Dataframe shape : 100000  x  13\nFri Oct 21 16:12:18 2022  -Force converting POS to integers...\nFri Oct 21 16:12:18 2022  -Sorting genome coordinates...\nFri Oct 21 16:12:18 2022 Finished sorting genome coordinates successfully!\nFri Oct 21 16:12:18 2022 Start to reorder the columns...\nFri Oct 21 16:12:18 2022  -Current Dataframe shape : 100000  x  13\nFri Oct 21 16:12:18 2022  -Reordering columns to    : SNPID,rsID,CHR,POS,EA,NEA,EAF,BETA,SE,P,N,DIRECTION,STATUS\nFri Oct 21 16:12:18 2022 Finished sorting columns successfully!\n</code></pre></p>"},{"location":"Tutorial/#sumstats-summary","title":"Sumstats summary","text":"<p>You can check the summary of your sumstats by:</p> <pre><code>mysumstats.summary()\n</code></pre>"},{"location":"Tutorial/#format-and-output","title":"Format and Output","text":"<p>You can then foremat your sumstats and output.</p> <p>gwaslab support commonly used formats. For details see: https://cloufield.github.io/gwaslab/Format/ <pre><code>mysumstats.to_format(\"clean_sumstats\",fmt=\"ldsc\")\n</code></pre></p>"},{"location":"Tutorial/#liftover","title":"Liftover","text":"<pre><code>mysumstats.liftover(n_cores=1,from_build=\"19\", to_build=\"38\")\n</code></pre> <p>Gwaslab only liftover CHR and POS, and when lifted, the last two digits status code will be rolled back to 99. Since for difference reference genome, the reference allele or strand might be reverse, so it is need to align and check agin. </p> <p>See details in Harmonization.</p>"},{"location":"UpdateLogs/","title":"Update Logs","text":""},{"location":"UpdateLogs/#3415-20230620","title":"3.4.15 2023/06/20","text":"<ul> <li>LDSC-rg genetic correlation heatmap</li> <li>Allele frequency correlation plot</li> <li>Miami plot using gl.Sumstats Object pickle files</li> <li>Auto-check for VCF chromosome prefix (chr1 or 1)</li> <li>fill_data() is now implemented iteratively</li> <li>Downloaded files auto detection.</li> </ul>"},{"location":"UpdateLogs/#3414-20230609","title":"3.4.14 2023/06/09","text":"<ul> <li>fixed bug</li> </ul>"},{"location":"UpdateLogs/#3413-20230609","title":"3.4.13 2023/06/09","text":"<ul> <li>added two-reference-variant mode for regional plot</li> <li>auto-check for genome build version</li> <li>added <code>additional_line</code> and <code>additional_line_color</code> for plot_mqq</li> <li>fixed bugs for sig_level_lead</li> </ul>"},{"location":"UpdateLogs/#3412-20230530","title":"3.4.12 2023/05/30","text":"<ul> <li>added highlight_anno_args in plot_mqq()</li> <li>added GWAS-SSF style metadata yaml output support</li> <li>added region_ref for regional plots</li> <li>updated default formatbook</li> </ul>"},{"location":"UpdateLogs/#3411-20230428","title":"3.4.11 - 2023/04/28","text":"<ul> <li>fixed anno=None in miami plot</li> </ul>"},{"location":"UpdateLogs/#3410-20230427","title":"3.4.10 - 2023/04/27","text":"<ul> <li>fixed variant_id sep for ssf</li> <li>update tutorials</li> </ul>"},{"location":"UpdateLogs/#349-20230425","title":"3.4.9 - 2023/04/25","text":"<ul> <li>update variant matching criteria for regional plot</li> <li>fixed default values for mqqplot</li> <li>added qq_scatter_args</li> <li>added connection timeout, status code check and md5sum verification for download_ref</li> </ul>"},{"location":"UpdateLogs/#348-20230421","title":"3.4.8 - 2023/04/21","text":"<ul> <li>fixed regional plot lead variant line error</li> <li>added tutorial for v3.4</li> <li>fixed anno_alias priority</li> </ul>"},{"location":"UpdateLogs/#347-20230420","title":"3.4.7 - 2023/04/20","text":"<ul> <li>fixed font_family for annotation</li> <li>get_lead can now use mlo10p to extract lead variants </li> <li>added sig_level_lead in plot_mqq</li> </ul>"},{"location":"UpdateLogs/#346-20230418","title":"3.4.6 - 2023/04/18","text":"<ul> <li>updated yticklabel fontsize</li> <li>updated drop_chr_start</li> </ul>"},{"location":"UpdateLogs/#345-20230406","title":"3.4.5 - 2023/04/06","text":"<ul> <li>added rr_lim : input a tuple like (0,100) or \"max\"</li> </ul>"},{"location":"UpdateLogs/#344-20230404","title":"3.4.4 - 2023/04/04","text":"<ul> <li>fixed error in mqqplot (chr &gt; 26)</li> </ul>"},{"location":"UpdateLogs/#343-20230329","title":"3.4.3 - 2023/03/29","text":"<ul> <li>added jagged y-axis</li> <li>added cut_log</li> </ul>"},{"location":"UpdateLogs/#342-20230328","title":"3.4.2 - 2023/03/28","text":"<ul> <li>fixed y tick labels</li> <li>added font_family</li> <li>added ylabels</li> </ul>"},{"location":"UpdateLogs/#341-20230328","title":"3.4.1 - 2023/03/28","text":"<ul> <li>added sc_linewidth</li> <li>fixed use_rank</li> <li>fixed ystep</li> </ul>"},{"location":"UpdateLogs/#340","title":"3.4.0","text":"<ul> <li>restructured plot functions</li> <li>added dtype conversion for input pd.DataFrame</li> <li>reimplemented gtfparse and revised requirements</li> <li>update reference datasets</li> <li>fixed bugs when no variants were selected for mqqplot</li> <li>fixed bugs in <code>gl.check_downloaded_ref()</code></li> <li>added suggestive significance line</li> </ul>"},{"location":"UpdateLogs/#3324-20230201","title":"3.3.24 - 2023/02/01","text":"<ul> <li>update bugs in init.py</li> </ul>"},{"location":"UpdateLogs/#3323-20230131","title":"3.3.23 - 2023/01/31","text":"<ul> <li>update annotation arrow style <code>anno_style</code> for <code>.plot_mqq</code></li> <li>fixed effect size comparison bugs (added sorting)</li> <li>added allele check for effect size comparison</li> <li>update large number selection algorithm</li> <li>fixed dtype errors in <code>fix_chr</code> and <code>fix_pos</code></li> <li>added perSNPh2 <code>.get_per_snp_r2()</code> and F statistics</li> <li>implemented save in Miami plots</li> <li>fixed annotation error in Miami plots</li> </ul>"},{"location":"UpdateLogs/#3322-20230127","title":"3.3.22 - 2023/01/27","text":"<ul> <li>added checks for duplicates and NAs in compare_effect()</li> </ul>"},{"location":"UpdateLogs/#3321-20230127","title":"3.3.21 - 2023/01/27","text":"<ul> <li>implement package info gl.show_version()</li> <li>fixed rsid_to_chrpos()</li> </ul>"},{"location":"UpdateLogs/#3320","title":"3.3.20","text":"<ul> <li>updated get_density() to calculate the signal density for sumstats</li> <li>implemented winner's curse correction for effect size comparison</li> </ul>"},{"location":"UpdateLogs/#3319","title":"3.3.19","text":"<ul> <li>updated fontsize options for plot_mqq(). Added anno_fontsize, title_fontsize.</li> <li>updated default values and optimized methods for remove_dup(), fix_chr(), basic_check(),check_sanity().</li> <li>added dump_pickle() load_pickle() to save half-finished sumstats object.</li> </ul>"},{"location":"UpdateLogs/#3318","title":"3.3.18","text":"<ul> <li>updated config and downloading system</li> </ul>"},{"location":"UpdateLogs/#3317","title":"3.3.17","text":"<ul> <li>added xtcik_chr_dict</li> <li>fixed bugs in miami plot</li> </ul>"},{"location":"UpdateLogs/#3316","title":"3.3.16","text":"<ul> <li>added hg38 recombination rate file</li> <li>fixed bugs in get_novel</li> </ul>"},{"location":"UpdateLogs/#3315","title":"3.3.15","text":"<ul> <li>fixed bugs for reading gtf files</li> </ul>"},{"location":"UpdateLogs/#3314","title":"3.3.14","text":"<ul> <li>updated requirements for dependencies <ul> <li>pandas&gt;=1.3,&lt;1.5</li> <li>pyensembl==2.2.3</li> </ul> </li> <li>support customized gtf/vcf/recombination_rate files</li> <li>fixed bugs for regional plot</li> <li>calculate_gc()</li> <li>fill MAF : <code>.fill_data(to_fill=[\"MAF\"])</code></li> </ul>"},{"location":"UpdateLogs/#3313","title":"3.3.13","text":"<ul> <li>specified python engine for query </li> </ul>"},{"location":"UpdateLogs/#3312","title":"3.3.12","text":"<ul> <li>fixed bugs for matplotlib v3.6.x</li> <li>added method chain for filter_xxx functions</li> <li>updated requirements for dependencies <ul> <li>pySAM&gt;=0.18.1,&lt;0.20</li> <li>matplotlib&gt;=3.5</li> <li>pyensembl&gt;=2.2.3</li> </ul> </li> </ul>"},{"location":"UpdateLogs/#3311","title":"3.3.11","text":"<ul> <li>updated requirements for dependencies</li> </ul>"},{"location":"UpdateLogs/#3310","title":"3.3.10","text":"<ul> <li>updated bugs for mqqplot</li> </ul>"},{"location":"UpdateLogs/#v339","title":"v3.3.9","text":"<ul> <li>updated download system</li> </ul>"},{"location":"UpdateLogs/#v338","title":"v3.3.8","text":"<ul> <li>included recombination data</li> </ul>"},{"location":"UpdateLogs/#v337","title":"v3.3.7","text":"<ul> <li>updated packaging methods. Now when installing gwaslab, pip will install all dependencies as well.</li> </ul>"},{"location":"UpdateLogs/#v336-20221105","title":"v3.3.6 - 2022/11/05","text":"<ul> <li>added download function: <ul> <li>now you can download reference files from predefined list via gwaslab</li> <li><code>gl.check_available_ref()</code> : list available reference files</li> <li><code>gl.check_downloaded_ref()</code> : list downloaded reference files</li> <li><code>gl.download_ref(name)</code> : download reference files</li> <li><code>gl.remove_file(name)</code> : remove the local reference files</li> <li><code>gl.get_path(name)</code> : get the local path for the reference data name</li> </ul> </li> <li>implemented parsing gwas-vcf (<code>fmt=\"vcf\"</code>)</li> <li>implemented <code>Sumstats.filter_value(expr)</code></li> <li>fixed bugs for check_allele</li> <li>optimized functions for sorting columns</li> <li>removed outdated codes in Sumstats</li> </ul>"},{"location":"UpdateLogs/#v335-20221102","title":"v3.3.5 - 2022/11/02","text":"<ul> <li>added <code>filter_value</code></li> <li>integrate <code>gwascatalog</code> to <code>get_novel</code></li> <li>optimized <code>remove_dup</code></li> <li>fixed bugs</li> </ul>"},{"location":"UpdateLogs/#v334-20221031","title":"v3.3.4 - 2022/10/31","text":"<ul> <li>added gwascatalog_trait()</li> <li>optimized check_sanity()</li> <li>optimized the logic for removing duplicated and multiallelic variants </li> <li>added update_formatbook()</li> <li>added functions to read vcf.gz <code>gl.Sumstats(\"myvcf.vcf.gz\",fmt=\"vcf\")</code></li> <li>gwaslab is now able to read chromosome-separated files</li> <li>fixed bugs</li> </ul>"},{"location":"UpdateLogs/#v333","title":"v3.3.3","text":"<ul> <li>added Miami plot</li> <li>added Brisbane plot</li> <li>updated tutorials </li> <li>mqq plot annotation: new customization options</li> </ul>"},{"location":"UpdateLogs/#v332-20221021","title":"v3.3.2 - 2022/10/21","text":"<ul> <li>added forcefixid for fix_id()</li> <li>fixed bugs for plotting gene tracks</li> </ul>"},{"location":"UpdateLogs/#v331","title":"v3.3.1","text":"<ul> <li>extract novel loci given a list of known lead variants</li> <li>fixed bugs in fill_data()</li> <li>fixed path for hapmap3 snps for infer_build()</li> </ul>"},{"location":"UpdateLogs/#v330-20221018","title":"v3.3.0 - 2022/10/18","text":"<ul> <li>added forest plot</li> <li>fixed options for mqqplot</li> <li>supported vcf</li> </ul>"},{"location":"UpdateLogs/#v320","title":"v3.2.0","text":"<ul> <li>incorporated pyensembl and scikit-allel.</li> <li>get_lead() : support automatic gene name annotation (using pyensembl)</li> <li>to_format():<ul> <li>support common sumstats formats </li> <li>support 1-based bed-like formats for VEP</li> <li>support 0-based bed-like formats</li> </ul> </li> <li>manhattan plot:<ul> <li>optimized plotting logic</li> <li>annotate gene names</li> <li>added regional plot feature using a user-provided reference panel</li> </ul> </li> <li>comparison effect plot: <ul> <li>fix using OR</li> </ul> </li> </ul>"},{"location":"UpdateLogs/#v310","title":"v3.1.0","text":"<ul> <li>implemented formatbook: easily import sumstats and output sumstats in certain formats (support for commonly used formats including ldsc, plink, plink2, gwas-ssf, saige, regenie, fastgwa, metal, mrmega, pgscatalog, pgscatalog_hm, gwascatalog, gwascatalog_hm and gwaslab)</li> <li>added <code>.filter_region_in/out</code> using bed files (or in-built regions like high-ld or hla)</li> <li>implemented <code>.summay()</code> methods.</li> <li>optimized rsID annotation pipeline. Support annotation using curated chr:pos:ref:alt - rsID tsv for quick annotation.</li> <li>changed some datatypes and optimized memory usage.</li> <li>replaced pyVCF with pySAM</li> </ul>"},{"location":"Upload_checklist/","title":"Checklist for uploading to PyPI","text":"<ul> <li>update package info</li> <li>update the badge and install command in index.md</li> <li>update Update log</li> <li>update toml</li> <li>build package</li> <li>upload to PyPI</li> </ul>"},{"location":"Visualization/","title":"Manhattan plot and QQ plot : plot_mqq()","text":"<p>GWASLab provides customizable plotting functions for Manhattan and Q-Q plots.</p> <p>See examples here.</p>"},{"location":"Visualization/#quick-plot","title":"Quick plot","text":"<p>Quick Manhattan and Q-Q plot</p> <pre><code>mysumstats.plot_mqq()\n</code></pre> <p></p>"},{"location":"Visualization/#usage","title":"Usage","text":"<p>All options for <code>plot_mqq</code></p> <pre><code>mysumstats.plot_mqq(\n          mlog10p=\"MLOG10P\",\n          scaled=False,\n          mode=\"mqq\",\n          mqqratio=3,\n          windowsizekb=500,\n          anno=None,\n          anno_set=[],\n          anno_alias={},\n          anno_d={},\n          anno_style=\"right\",\n          anno_fixed_arm_length=None,\n          arm_offset=50,\n          arm_scale=1,\n          cut=0,\n          skip=0,\n          cutfactor=10,\n          cut_line_color=\"#ebebeb\",  \n          sig_level=5e-8,\n          sig_line_color=\"grey\",\n          suggestive_sig_level=5e-6,\n          highlight = [],\n          highlight_color=\"#CB132D\",\n          highlight_windowkb = 500,\n          pinpoint=[],\n          pinpoint_color =\"red\",\n          stratified=False,\n          maf_bins=[(0, 0.01), (0.01, 0.05), (0.05, 0.25),(0.25,0.5)],\n          maf_bin_colors = [\"#f0ad4e\",\"#5cb85c\", \"#5bc0de\",\"#000042\"],\n          gc=True,\n          title =None,\n          mtitle=None,\n          qtitle=None,\n          figargs= {\"figsize\":(15,5),\"dpi\":100},\n          title_fontsize=13,\n          fontsize = 10,\n          anno_fontsize = 10,\n          colors=[\"#597FBD\",\"#74BAD3\"],\n          marker_size=(5,25),\n          use_rank=False,\n          verbose=True,\n          repel_force=0.03,\n          build=\"19\",\n          title_pad=1.08, \n          save=None,\n          saveargs={\"dpi\":400,\"facecolor\":\"white\"},\n          ):\n</code></pre>"},{"location":"Visualization/#customized-plot-example","title":"Customized plot example","text":"<p>By setting the options, you can create highly customized Manhattan plots and Q-Q plots.</p> <p>A customized Manhattan and QQ plot</p> <pre><code>mysumstats.plot_mqq(\n                  mode=\"qqm\",\n                  cut=14,\n                  skip=3, \n                  anno_set=[\"rs12509595\",\"rs7989823\"] ,\n                  pinpoint=[\"rs7989823\"], \n                  highlight=[\"rs12509595\",\"19:15040733:T:C\"],\n                  highlight_windowkb =1000,\n                  stratified=True,\n                  marker_size=(5,10),\n                  figargs={\"figsize\":(15,5),\"dpi\":300})\n</code></pre> <p></p>"},{"location":"Visualization/#options","title":"Options","text":""},{"location":"Visualization/#manhattan-and-qq-plot-layout","title":"Manhattan and QQ plot layout","text":"<ul> <li><code>mode</code> : determine the layout of manhattan plot and qq plot.<ul> <li><code>mqq</code>: left manhatan, right QQ</li> <li><code>qqm</code>: left QQ , right manhatan</li> <li><code>\"m\"</code>: only manhattan plot</li> <li><code>\"qq\"</code>: only qq plot</li> <li><code>mqqratio</code>: width ratio</li> </ul> </li> </ul> <p>Layout</p> <p></p>"},{"location":"Visualization/#skip-low-and-shrink-high","title":"Skip \"low\" and shrink \"high\"","text":"<ul> <li><code>skip</code> : sometimes it is not necessary to plot all variants, we can skip the insignicant variants . For example, we can exclude varints with -log10p lower than 3 from the plot by specifying <code>skip=3</code></li> <li><code>cut</code> : loci with extremly large -log10(P) value are very likely to dwarf other significant loci , so we want to scale down the extrame loci from a certain threshold. </li> <li><code>cutfactor</code>:  shrinkage factor, default is 10 </li> <li><code>cut_line_color</code>: the color of the line above which y axis is rescaled </li> <li><code>sig_level=5e-8</code> : genome-wide significance threshold</li> </ul> <p>Auxiliary lines</p> <p></p> <p>Note</p> <p>lambda GC calculation for QQ plot will not be affected by skip and cut. The calculation is conducted using all variants in the original dataset.</p>"},{"location":"Visualization/#annotation","title":"Annotation","text":"<ul> <li><code>anno</code>: <code>boolean</code> or <code>string</code> or <code>\"GENENAME\"</code> <ul> <li><code>boolean</code>: <code>anno = True</code>,  the variants to annotate will be selected automatically using a sliding window with <code>windowsize=500</code>kb. chr:pos</li> <li><code>string</code>: the column name used for annotation</li> <li><code>\"GENENAME\"</code> : automatically annotate nrearest gene names, using pyensembl. (remember to specify <code>build</code>, default is <code>build=\"19\"</code>)</li> </ul> </li> <li><code>repel_force</code> : when the annotation overlaps with other, try increasing the repel_force to increase the padding between annotations. (deault is 0.01)</li> <li><code>anno_set</code>: if you want to annotate only a few specific variants, you can simply provide a list of SNPIDs. </li> <li><code>anno_alias</code> : snpid:text dictionary for customized annotation</li> </ul> <p>Repel force</p> <p></p> <p>Skip variants with -log10P&lt;3 and annotate the lead variants with chr:pos</p> <pre><code>mysumstats.plot_mqq(skip=3,anno=True)\n</code></pre> <p></p> <p>Skip variants with -log10P&lt;3 and annotate the lead variants with GENENAME</p> <pre><code>mysumstats.plot_mqq(skip=3,anno=\"GENENAME\",build=\"19\")\n</code></pre> <p></p> <p>Skip variants with -log10P&lt;3 and annotate the variants in <code>anno_set</code></p> <pre><code>mysumstats.plot_mqq(skip=3, anno_set=[\"rs12509595\",\"19:15040733:T:C\"])\n</code></pre> <p></p> <p>Skip variants with -log10P&lt;3 and annotate the variants in <code>anno_set</code> with alias in <code>anno_alias</code></p> <pre><code>mysumstats.plot_mqq(skip=3, anno_set=[\"rs12509595\",\"19:15040733:T:C\"], anno_alias={\"rs12509595\":\"anything you want here\"})\n</code></pre> <p></p>"},{"location":"Visualization/#annotation-style","title":"Annotation style","text":"<p>Added since 3.3.23</p> <p>GWASLab now support 3 types of annotation styles:</p> <ul> <li><code>expand</code></li> <li><code>right</code></li> <li><code>tight</code></li> </ul> <p><code>anno_style=\"expand\"</code></p> <p></p> <p><code>anno_style=\"right\"</code></p> <p></p> <p><code>anno_style=\"tight\"</code></p> <p></p>"},{"location":"Visualization/#adjust-arm-position","title":"Adjust arm position","text":"<ul> <li><code>anno_d</code>:<code>dict</code>,key is the number of arm starting form 0, value is the direction you want the arm to shift towards . For example, <code>anno_d = {4:\"r\"}</code> means shift the 4th arm to the right </li> <li><code>arm_offset</code>: <code>float</code> shift distance in points</li> <li><code>arm_scale</code>: <code>float</code> factors to adjust the height for all arms</li> <li><code>arm_scale_d</code>: <code>dict</code> factors to adjust the height for specific arms. key is the number of arm startinf form 0, value is the factor which will be multiplied to arm height.</li> </ul> <p>Adjust the direction the first to left and the thrd to right</p> <pre><code>mysumstats.plot_mqq(skip=2,anno=True)\n</code></pre> <p></p> <pre><code>mysumstats.plot_mqq(skip=2,anno=True,          \n                    anno_d={1:\"l\",3:\"r\"},\n                    arm_offset=50)\n</code></pre> <p></p> <p>Adjust the length of arm</p> <pre><code>mysumstats.plot_mqq(skip=2,anno=True,arm_scale=1.5)\n</code></pre> <p></p> <p>Adjust the length of arm for each variant</p> <pre><code>mysumstats.plot_mqq(skip=2,anno=True,arm_scale_d={1:1.5,2:1.2,3:1.1})\n</code></pre> <p></p>"},{"location":"Visualization/#highlight-specified-loci","title":"Highlight specified loci","text":"<p>Highlight specified loci (color all variants in a region by specifying variants and the length of flanking regions). </p> <ul> <li><code>highlight</code> : <code>list</code> specify the variants of loci for highlighting.</li> <li><code>highlight_color</code>: <code>string</code> specify the color ussed for highlighting.</li> <li><code>highlight_windowkb</code> : <code>int</code> specify the span of highlighted region (deault: <code>highlight_windowkb = 500</code> kp)</li> </ul>"},{"location":"Visualization/#pinpoint-specified-variants","title":"Pinpoint specified variants","text":"<p>Pinpoint certain variants in the manhattan plot.</p> <ul> <li><code>pinpoint</code> : a list of SNPIDs</li> <li><code>pinpoint_color</code> : color for pinpoint</li> </ul> <p>Highlight loci and pinpoint variants</p> <pre><code>mysumstats.plot_mqq(skip=3,anno=\"GENENAME\",build=\"19\",\n                   highlight=[\"rs12509595\",\"rs7989823\"],\n                   pinpoint=[\"rs671\",\"19:15040733:T:C\"])\n</code></pre> <p></p>"},{"location":"Visualization/#lines","title":"Lines","text":"<ul> <li><code>sig_line</code>: boolean. if True, plot the significant threshold line (default: True)</li> <li><code>sig_level</code>: float. The significance threshold (default:5e-8)</li> <li><code>sig_level_lead</code>: float. The significance threshold for extracting lead variants to annotate (default:5e-8)</li> <li><code>sig_line_color</code>:color. Significant threshold line color (default:\"grey\")</li> <li><code>suggestive_sig_line</code>:boolean. if True, plot the suggestive line (default:False),</li> <li><code>suggestive_sig_level</code>:float. The suggestive level (default:5e-6),</li> <li><code>suggestive_sig_line_color</code>:color. Suggestive level line color (default:\"grey\"),</li> <li><code>additional_line</code>: list of threshold. (default:None)</li> <li><code>additional_line_color</code>: list of colors. (default:None)</li> <li><code>cut_line_color</code>: color. the color for cut line (default: \"#ebebeb\")</li> </ul> <p>Plot lines</p> <p><pre><code>mysumstats.plot_mqq(skip=3,\n                build=\"19\",\n                anno=\"GENENAME\",\n                windowsizekb=1000000,\n                cut=20,\n                cut_line_color=\"purple\",\n                sig_level=5e-8,  \n                sig_level_lead=1e-6, \n                sig_line_color=\"grey\",\n                suggestive_sig_line = True,\n                suggestive_sig_level = 1e-6,\n                suggestive_sig_line_color=\"blue\",\n                additional_line=[1e-40,1e-60],\n                additional_line_color=[\"yellow\",\"green\"])\n</code></pre> </p>"},{"location":"Visualization/#maf-stratified-qq-plot","title":"MAF-stratified QQ plot","text":"<ul> <li><code>stratified</code>: <code>boolean</code> if True, plot MAF straitified QQ plot. Require EAF in sumstats.</li> <li><code>maf_bins</code>: <code>list</code> maf bins for straitification. (default: <code>maf_bins=[(0, 0.01), (0.01, 0.05), (0.05, 0.25),(0.25,0.5)]</code>)</li> <li><code>maf_bin_colors</code>: <code>list</code> colors used for each bin. (default: <code>maf_bin_colors = [\"#f0ad4e\",\"#5cb85c\", \"#5bc0de\",\"#000042\"]</code>)</li> </ul> <p>MAF-stratified Q-Q plot</p> <p></p>"},{"location":"Visualization/#colors-and-fontsizes","title":"Colors and Fontsizes","text":"<pre><code>mysumstats.plot_mqq(\n          colors=[\"#597FBD\",\"#74BAD3\"],\n          cut_line_color=\"#ebebeb\",\n          sig_line_color=\"grey\",\n          highlight_color=\"#CB132D\",\n          pinpoint_color =\"red\",\n          maf_bin_colors = [\"#f0ad4e\",\"#5cb85c\", \"#5bc0de\",\"#000042\"],\n          fontsize = 10,\n          anno_fontsize = 10,\n          title_fontsize = 13,\n          marker_size=(5,25)\n)\n</code></pre> <ul> <li><code>colors</code> : <code>list</code>, a list of color for Manhattan plot. (default: <code>[\"#597FBD\",\"#74BAD3\"]</code>)</li> <li><code>cut_line_color</code> : <code>string</code>, color for cut line.  (default: <code>\"#ebebeb\"</code>)</li> <li><code>sig_line_color</code> : <code>string</code>, color for significance threshold line. (default: <code>\"grey\"</code>)</li> <li><code>highlight_color</code> : <code>string</code>, color for highlighting. (default: <code>\"#CB132D\"</code>)</li> <li><code>pinpoint_color</code> : <code>string</code>, color for pinpointing. (default: <code>\"red\"</code>)</li> <li><code>maf_bin_colors</code> : <code>list</code>, a list of color formaf stratified Q-Q plot. (default: <code>\"[\"#f0ad4e\",\"#5cb85c\", \"#5bc0de\",\"#000042\"]\"</code>)</li> <li><code>fontsize = 10</code>: fontsize for ticklabels.</li> <li><code>title_fontsize = 13</code>, fontsize for title.</li> <li><code>anno_fontsize = 10</code>, fontsize for annotation.</li> </ul> <p>Example</p> <p><pre><code>mysumstats.plot_mqq(skip=2,\n                    cut=20,\n                    colors=sns.color_palette(\"Set3\"),\n                    sig_line_color=\"red\",\n                    fontsize = 8)\n</code></pre> </p>"},{"location":"Visualization/#titles","title":"Titles","text":"<pre><code>mysumstats.plot_mqq(\n          title =None,\n          mtitle=None,\n          qtitle=None,\n          title_pad=1.08\n        )\n</code></pre> <ul> <li>title : <code>string</code> , title for the whole plot</li> <li>mtitle : <code>string</code> , title for the Manhattan plot</li> <li>qtitle : <code>string</code> , title for the Q-Q plot</li> <li>title_pad : <code>float</code> , padding for title</li> </ul>"},{"location":"Visualization/#figure-settings","title":"Figure settings","text":"<pre><code>figargs= {\"figsize\":(15,5),\"dpi\":100}\n</code></pre> <ul> <li><code>figargs</code> : <code>dict</code>, key-values pairs that are passed to matplotlib <code>plt.subplots()</code><ul> <li><code>figsize</code> : figure size</li> <li><code>dpi</code> : dots per inch. For pulications, dpi&gt;=300 is on of the common criteria.</li> </ul> </li> </ul>"},{"location":"Visualization/#save-plots","title":"Save plots","text":"<p><pre><code>mysumstats.plot_mqq(save=\"mymqqplots.png\",saveargs={\"dpi\":400,\"facecolor\":\"white\"})\n</code></pre> Two options for saving plots in <code>.plot_mqq</code></p> <ul> <li><code>save</code>:<code>string</code>,path for saved plot</li> <li><code>saveargs</code>: <code>dict</code>, other parameters passed to matplotlib <code>savefig</code> function.</li> </ul> <p>Example</p> <ul> <li>save as png: <code>mysumstats.plot_mqq(save=\"mymqqplots.png\",saveargs={\"dpi\":300})</code></li> <li>save as PDF: <code>mysumstats.plot_mqq(save=\"mymqqplots.pdf\",saveargs={\"dpi\":300})</code></li> </ul>"},{"location":"functions/","title":"gwaslab.Sumstats methods","text":""},{"location":"functions/#glsumstats","title":"gl.Sumstats","text":""},{"location":"functions/#standardization","title":"Standardization","text":"Sumstats Methods Options Description <code>.fix_id()</code> <code>fixchrpos=False</code>, <code>fixid=False</code>, <code>fixsep=False</code>,<code>overwrite=False</code>,<code>forcefixid=False</code> check and\u00a0 fix rsID or SNPID(chr:pos:ref:alt), or use snpid to fix CHR and POS <code>.fix_CHR()</code> <code>remove=False</code> standardize chromsome notation <code>.fix_POS()</code> <code>remove=False</code> standardize basepair posituion notation and filter out bad values <code>.fix_allele()</code> <code>remove=False</code> standardize base notation to ATCG <code>.normalize_allele()</code> <code>n_cores=1</code> normalize indels (only support ATA:AA -&gt; AT:A but not -:T) <code>.sort_coordinate()</code> sort the variant coordinates <code>.sort_column()</code> sort the column order to GWASLab default <code>.basic_check()</code> all in one function"},{"location":"functions/#qc-and-filtering","title":"QC and filtering","text":"Sumstats Methods Options Description <code>.check_sanity()</code> <code>n=(0,float(\"Inf\"))</code>, <code>eaf=(0,1)</code>, <code>mac=(5,float(\"Inf\"))</code>, <code>chisq=(0,float(\"Inf\"))</code>, <code>p=(5e-300,1)</code>, <code>mlog10p=(0,float(\"Inf\"))</code>, <code>beta=(-10,10)</code>, <code>z=(-37.5,37.5)</code>, <code>se=(0,float(\"Inf\"))</code>, <code>OR=(-10,10)</code> , <code>OR_95L=(0,float(\"Inf\"))</code>, <code>OR_95U=(0,float(\"Inf\"))</code>, <code>info=(0,float(\"Inf\"))</code> sanity check for statistics including BETA, SE, Z, CHISQ, EAF, OR, N... <code>.remove_dup()</code> <code>mode=\"md\"</code>, <code>keep='first'</code>, <code>keep_col=\"P\"</code>, <code>remove=False</code> remove duplicated, multiallelic or NA variants <code>.filter_value()</code> expr filter in variants base on expr <code>.filter_in()</code> lt, gt, eq, inplace filter in variants base on given threshold <code>.filter_out()</code> lt, gt, eq, inplace filter out variants base on given threshold <code>.filter_region_in()</code> <code>path</code> ,  <code>inplace=True</code> , <code>high_ld=False</code>,  <code>build=\"19\"</code> filter in variants in the specified region define by a bed file <code>.filter_region_out()</code> <code>path</code> ,  <code>inplace=True</code> , <code>high_ld=False</code>,  <code>build=\"19\"</code> filter out variants in the specified region define by a bed file"},{"location":"functions/#harmonization","title":"Harmonization","text":"Sumstats Methods Options Description <code>.check_ref()</code> ref_path check alignment with a reference sequence <code>.rsid_to_chrpos()</code> path,\u00a0n_cores use rsid to fill CHR and POS <code>.rsid_to_chrpos2()</code> path use rsid to fill CHR and POS (muilti-thread, need hd5 file) <code>.assign_rsid()</code> path annotate rsid using a reference vcf file <code>.infer_strand()</code> ref_infer=\"\" , ref_alt_freq=None,\u00a0 maf_threshold=0.43 infer the strand of a variant using reference vcf file with EAF in INFO <code>.check_daf()</code> ref_infer=\"\" , ref_alt_freq=None, calculate difference in allele frequencies <code>.flip_allele_stats()</code> After alignment and inferring, flip the alleles to harmonise the variants. <code>.liftover()</code> n_cores=1,from_build=\"19\", to_build=\"38\" perform liftover"},{"location":"functions/#standalone-functions","title":"Standalone functions","text":"function catagory description"},{"location":"temp/","title":"Temp","text":"<pre><code>- \"Examples(outdated)\":\n   - \"Standardization and QC example\":\n      - \"Workflow\": standardization_workflow.ipynb\n      - \"QC and filtering\" : quality_control_and_filtering.ipynb\n   - \"Harmonization example\":\n      - \"Workflow\" : harmonization_workflow.ipynb\n      - \"Liftover\" : harmonization_liftover.ipynb\n   - \"Formatting and saving example\" : format_load_save.ipynb\n   - \"Utility example\":\n      - \"Data conversion\" : utility_data_conversion.ipynb\n      - \"Checking novel\" : utility_get_novel.ipynb\n   - \"Visualization example\" :\n      - \"Manhatann and Q-Q plot\" : visualization_mqq.ipynb\n      - \"Miami plot\": visualization_miami.ipynb\n      - \"Regional plot\": visualization_regional.ipynb\n      - \"Brisbane plot\": visualization_brisbane.ipynb\n   - \"Reference management\" :\n      - \"Download\" : Download_reference.ipynb\n</code></pre>"},{"location":"tutorial_3.4/","title":"Tutorial for gwaslab","text":"<ul> <li>In this tutorial, we will briefly describe the core functions in gwaslab for sumstats QC, standardization and harmonization.</li> <li>We will also show examples of visualization, including Manhattan plots, Q-Q plots and regional plots.</li> <li>This jupyter notebook can be downloaded from https://github.com/Cloufield/gwaslab/blob/main/docs/tutorial_3.4.ipynb</li> <li>Please note that the processed reference datasets are currently hosted on Dropbox.</li> </ul> <ul> <li>Using a jupyter notebook, we first download a sample dataset.</li> <li>The dataset we will use as an example is the sumstats of type 2 diabetes from BBJ (K. Suzuki et al., Nature Genetics. 51, 379\u2013386 (2019).)</li> <li>File size: 261M</li> </ul> In\u00a0[1]: Copied! <pre>!wget -O t2d_bbj.txt.gz http://jenger.riken.jp/14/\n</pre> !wget -O t2d_bbj.txt.gz http://jenger.riken.jp/14/ <pre>--2023-04-21 13:41:25--  http://jenger.riken.jp/14/\nResolving jenger.riken.jp (jenger.riken.jp)... 134.160.84.25, 161.232.72.25, 202.12.30.131, ...\nConnecting to jenger.riken.jp (jenger.riken.jp)|134.160.84.25|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 274187574 (261M) [text/plain]\nSaving to: \u2018t2d_bbj.txt.gz\u2019\n\nt2d_bbj.txt.gz      100%[===================&gt;] 261.49M  25.2MB/s    in 11s     \n\n2023-04-21 13:41:35 (24.7 MB/s) - \u2018t2d_bbj.txt.gz\u2019 saved [274187574/274187574]\n\n</pre> <p>Sometimes the link is not stable. You can also download from alternative source:  <code>!wget -O t2d_bbj.txt.gz https://www.dropbox.com/s/5vp93eq0gtsm92n/t2d_bbj.txt.gz?dl=1</code></p> <p>gwaslab can be installed using pip</p> In\u00a0[1]: Copied! <pre>!pip install gwaslab==3.4.10\n</pre> !pip install gwaslab==3.4.10 <p>If you installed gwaslab from pip, simply run the command to import the package:</p> In\u00a0[2]: Copied! <pre>import gwaslab as gl\n</pre> import gwaslab as gl <p>Or if you want to use the latest version from github (beta version), you can clone the repository and import the package by inserting your package path into the system path like:</p> In\u00a0[1]: Copied! <pre>import sys\nsys.path.insert(0,\"/home/yunye/work/gwaslab/src\")\nimport gwaslab as gl\n</pre> import sys sys.path.insert(0,\"/home/yunye/work/gwaslab/src\") import gwaslab as gl <p>Let's import the raw sumstats into the <code>gwaslab.Sumstats</code> Object by specifying the necessary columns.</p> <p>Note: you can either specify <code>eaf</code> (effect allele frequency) or <code>neaf</code> (non-effect allele frequency), if <code>neaf</code> is specified, it will be converted to <code>eaf</code> when loading the sumstats.</p> In\u00a0[2]: Copied! <pre>mysumstats = gl.Sumstats(\"t2d_bbj.txt.gz\",\n             snpid=\"SNP\",\n             chrom=\"CHR\",\n             pos=\"POS\",\n             ea=\"ALT\",\n             nea=\"REF\",\n             neaf=\"Frq\",\n             beta=\"BETA\",\n             se=\"SE\",\n             p=\"P\",\n             direction=\"Dir\",\n             n=\"N\",\n             sep=\"\\t\")\n</pre> mysumstats = gl.Sumstats(\"t2d_bbj.txt.gz\",              snpid=\"SNP\",              chrom=\"CHR\",              pos=\"POS\",              ea=\"ALT\",              nea=\"REF\",              neaf=\"Frq\",              beta=\"BETA\",              se=\"SE\",              p=\"P\",              direction=\"Dir\",              n=\"N\",              sep=\"\\t\") <pre>Thu Apr 27 11:42:12 2023 GWASLab version 3.4.10 https://cloufield.github.io/gwaslab/\nThu Apr 27 11:42:12 2023 (C) 2022-2023, Yunye He, Kamatani Lab, MIT License, gwaslab@gmail.com\nThu Apr 27 11:42:12 2023 Start to initiate from file :t2d_bbj.txt.gz\nThu Apr 27 11:42:25 2023  -Reading columns          : Dir,SE,POS,ALT,N,Frq,P,SNP,BETA,CHR,REF\nThu Apr 27 11:42:25 2023  -Renaming columns to      : DIRECTION,SE,POS,EA,N,EAF,P,SNPID,BETA,CHR,NEA\nThu Apr 27 11:42:25 2023  -Current Dataframe shape : 12557761  x  11\nThu Apr 27 11:42:25 2023  -Initiating a status column: STATUS ...\nThu Apr 27 11:42:27 2023  -NEAF is specified...\nThu Apr 27 11:42:27 2023  -Checking if 0&lt;= NEAF &lt;=1 ...\nThu Apr 27 11:42:28 2023  -Converted NEAF to EAF.\nThu Apr 27 11:42:28 2023  -Removed 0 variants with bad NEAF.\nThu Apr 27 11:42:28 2023 Start to reorder the columns...\nThu Apr 27 11:42:28 2023  -Current Dataframe shape : 12557761  x  12\nThu Apr 27 11:42:28 2023  -Reordering columns to    : SNPID,CHR,POS,EA,NEA,EAF,BETA,SE,P,N,DIRECTION,STATUS\nThu Apr 27 11:42:28 2023 Finished sorting columns successfully!\nThu Apr 27 11:42:28 2023 Finished loading data successfully!\n</pre> <p>Sumstats are stored in <code>Sumstats.data</code> as a pandas.DataFrame, you can check the data like:</p> In\u00a0[3]: Copied! <pre>mysumstats.data\n</pre> mysumstats.data Out[3]: SNPID CHR POS EA NEA EAF BETA SE P N DIRECTION STATUS 0 1:725932_G_A 1 725932 G A 0.9960 -0.0737 0.1394 0.5970 166718 -?+- 9999999 1 1:725933_A_G 1 725933 G A 0.0040 0.0737 0.1394 0.5973 166718 +?-+ 9999999 2 1:737801_T_C 1 737801 C T 0.0051 0.0490 0.1231 0.6908 166718 +?-+ 9999999 3 1:749963_T_TAA 1 749963 TAA T 0.8374 0.0213 0.0199 0.2846 166718 -?++ 9999999 4 1:751343_T_A 1 751343 T A 0.8593 0.0172 0.0156 0.2705 166718 -?++ 9999999 ... ... ... ... ... ... ... ... ... ... ... ... ... 12557756 X:154874837_A_G X 154874837 G A 0.7478 -0.0064 0.0117 0.5840 191764 -+-+ 9999999 12557757 X:154875192_GTACTC_G X 154875192 GTACTC G 0.2525 0.0071 0.0122 0.5612 191764 +-+- 9999999 12557758 X:154879115_A_G X 154879115 G A 0.7463 -0.0070 0.0122 0.5646 191764 -+-+ 9999999 12557759 X:154880669_T_A X 154880669 T A 0.2558 0.0071 0.0122 0.5618 191764 +-+- 9999999 12557760 X:154880917_C_T X 154880917 C T 0.2558 0.0072 0.0122 0.5570 191764 +-+- 9999999 <p>12557761 rows \u00d7 12 columns</p> <ul> <li>For details on gwaslab Sumstats Object, see: https://cloufield.github.io/gwaslab/SumstatsObject/</li> </ul> <p>The first thing you want to check is probably the Manhattan and Q-Q plots for your sumstats.</p> <p>gwaslab will conduct a minimal QC for sumstats when plotting.</p> In\u00a0[4]: Copied! <pre>mysumstats.plot_mqq()\n</pre> mysumstats.plot_mqq() <pre>Tue Apr 25 14:02:46 2023 Start to plot manhattan/qq plot with the following basic settings:\nTue Apr 25 14:02:46 2023  -Genome-wide significance level is set to 5e-08 ...\nTue Apr 25 14:02:46 2023  -Raw input contains 12557761 variants...\nTue Apr 25 14:02:46 2023  -Plot layout mode is : mqq\nTue Apr 25 14:02:48 2023 Finished loading specified columns from the sumstats.\nTue Apr 25 14:02:48 2023 Start conversion and sanity check:\nTue Apr 25 14:02:48 2023  -Removed 0 variants with nan in CHR or POS column ...\nTue Apr 25 14:02:48 2023  -Removed 0 variants with nan in P column ...\nTue Apr 25 14:02:49 2023  -Sanity check after conversion: 0 variants with P value outside of (0,1] will be removed...\nTue Apr 25 14:02:49 2023  -sumstats P values are being converted to -log10(P)...\nTue Apr 25 14:02:50 2023  -Sanity check: 0 na/inf/-inf variants will be removed...\nTue Apr 25 14:02:51 2023  -Maximum -log10(P) values is 167.58838029403677 .\nTue Apr 25 14:02:51 2023 Finished data conversion and sanity check.\nTue Apr 25 14:03:07 2023 Start to create manhattan plot with 12557761 variants:\nTue Apr 25 14:03:33 2023  -Found 89 significant variants with a sliding window size of 500 kb...\nTue Apr 25 14:03:33 2023 Finished creating Manhattan plot successfully!\nTue Apr 25 14:03:33 2023  -Skip annotating\nTue Apr 25 14:03:33 2023 Start to create QQ plot with 12557761 variants:\nTue Apr 25 14:03:35 2023  -Calculating lambda GC: 1.2128258399293808\nTue Apr 25 14:03:35 2023 Finished creating QQ plot successfully!\n</pre> Out[4]: <pre>(&lt;Figure size 3000x1000 with 2 Axes&gt;, &lt;gwaslab.Log.Log at 0x7f46449ff6a0&gt;)</pre> <p>Using <code>.plot_mqq()</code>, you can easily plot the Manhattan and QQ plot, but the plots without any manipulations are not really informative in this case, and plotting all points takes a relatively long time. The most significant locus dwarfed other less signicant loci. To adjust the plot, gwaslab provides a wide range of options for customization. For example, we can use <code>skip</code> and <code>cut</code> :</p> <ul> <li>skip : skip variants with MLOG10P &lt; <code>skip</code> for faster plotting speed</li> <li>cut : rescale the MLOG10P values when MLOG10P &gt; <code>cut</code></li> </ul> In\u00a0[5]: Copied! <pre>mysumstats.plot_mqq(skip=2, cut=20)\n</pre> mysumstats.plot_mqq(skip=2, cut=20) <pre>Tue Apr 25 14:05:16 2023 Start to plot manhattan/qq plot with the following basic settings:\nTue Apr 25 14:05:16 2023  -Genome-wide significance level is set to 5e-08 ...\nTue Apr 25 14:05:16 2023  -Raw input contains 12557761 variants...\nTue Apr 25 14:05:16 2023  -Plot layout mode is : mqq\nTue Apr 25 14:05:18 2023 Finished loading specified columns from the sumstats.\nTue Apr 25 14:05:18 2023 Start conversion and sanity check:\nTue Apr 25 14:05:18 2023  -Removed 0 variants with nan in CHR or POS column ...\nTue Apr 25 14:05:18 2023  -Removed 0 variants with nan in P column ...\nTue Apr 25 14:05:19 2023  -Sanity check after conversion: 0 variants with P value outside of (0,1] will be removed...\nTue Apr 25 14:05:19 2023  -sumstats P values are being converted to -log10(P)...\nTue Apr 25 14:05:20 2023  -Sanity check: 0 na/inf/-inf variants will be removed...\nTue Apr 25 14:05:21 2023  -Maximum -log10(P) values is 167.58838029403677 .\nTue Apr 25 14:05:21 2023  -Minus log10(P) values above 20 will be shrunk with a shrinkage factor of 10...\nTue Apr 25 14:05:21 2023 Finished data conversion and sanity check.\nTue Apr 25 14:05:21 2023 Start to create manhattan plot with 332882 variants:\nTue Apr 25 14:05:22 2023  -Found 89 significant variants with a sliding window size of 500 kb...\nTue Apr 25 14:05:22 2023 Finished creating Manhattan plot successfully!\nTue Apr 25 14:05:22 2023  -Skip annotating\nTue Apr 25 14:05:22 2023 Start to create QQ plot with 332882 variants:\nTue Apr 25 14:05:22 2023  -Calculating lambda GC: 1.2128258399293808\nTue Apr 25 14:05:22 2023 Finished creating QQ plot successfully!\n</pre> Out[5]: <pre>(&lt;Figure size 3000x1000 with 2 Axes&gt;, &lt;gwaslab.Log.Log at 0x7f46449ff6a0&gt;)</pre> <p>Looks better now. But what if we want to annotate some of the most significant loci (for example, lead variants with MLOG10P&gt;30) and only plot Manhattan plot?</p> In\u00a0[6]: Copied! <pre>mysumstats.plot_mqq(skip=2, cut=20, mode=\"m\", anno=True, sig_level_lead=1e-30)\n</pre> mysumstats.plot_mqq(skip=2, cut=20, mode=\"m\", anno=True, sig_level_lead=1e-30) <pre>Tue Apr 25 14:05:26 2023 Start to plot manhattan/qq plot with the following basic settings:\nTue Apr 25 14:05:26 2023  -Genome-wide significance level is set to 5e-08 ...\nTue Apr 25 14:05:26 2023  -Raw input contains 12557761 variants...\nTue Apr 25 14:05:26 2023  -Plot layout mode is : m\nTue Apr 25 14:05:28 2023 Finished loading specified columns from the sumstats.\nTue Apr 25 14:05:28 2023 Start conversion and sanity check:\nTue Apr 25 14:05:28 2023  -Removed 0 variants with nan in CHR or POS column ...\nTue Apr 25 14:05:28 2023  -Removed 0 variants with nan in P column ...\nTue Apr 25 14:05:29 2023  -Sanity check after conversion: 0 variants with P value outside of (0,1] will be removed...\nTue Apr 25 14:05:29 2023  -sumstats P values are being converted to -log10(P)...\nTue Apr 25 14:05:30 2023  -Sanity check: 0 na/inf/-inf variants will be removed...\nTue Apr 25 14:05:31 2023  -Maximum -log10(P) values is 167.58838029403677 .\nTue Apr 25 14:05:31 2023  -Minus log10(P) values above 20 will be shrunk with a shrinkage factor of 10...\nTue Apr 25 14:05:31 2023 Finished data conversion and sanity check.\nTue Apr 25 14:05:31 2023 Start to create manhattan plot with 332882 variants:\nTue Apr 25 14:05:32 2023  -Found 9 significant variants with a sliding window size of 500 kb...\nTue Apr 25 14:05:32 2023 Finished creating Manhattan plot successfully!\nTue Apr 25 14:05:32 2023  -Annotating using column CHR:POS...\nTue Apr 25 14:05:32 2023  -Adjusting text positions with repel_force=0.03...\n</pre> Out[6]: <pre>(&lt;Figure size 3000x1000 with 1 Axes&gt;, &lt;gwaslab.Log.Log at 0x7f46449ff6a0&gt;)</pre> <p>gwaslab supports a wide range of customizable options. For details on other options for Manhattan and Q-Q plots, see: https://cloufield.github.io/gwaslab/Visualization/</p> <p>It is needed to check variant ID (SNPID), rsID, chromosome(CHR), basepair position(POS), alleles (EA and NEA) and statistics first before any manipulations or analysis. gwaslab provides a all-in-one function for this, <code>.basic_check()</code>.</p> <p>Note: Sometimes you need do this before plotting if the sumstats are not in a standard format.</p> In\u00a0[7]: Copied! <pre>#check SNPID,rsID,CHR,POS,EA, NEA and statistics\nmysumstats.basic_check()\n</pre> #check SNPID,rsID,CHR,POS,EA, NEA and statistics mysumstats.basic_check() <pre>Tue Apr 25 15:12:32 2023 Start to check IDs...\nTue Apr 25 15:12:32 2023  -Current Dataframe shape : 12557761  x  12\nTue Apr 25 15:12:32 2023  -Checking if SNPID is chr:pos:ref:alt...(separator: - ,: , _)\nTue Apr 25 15:12:41 2023 Finished checking IDs successfully!\nTue Apr 25 15:12:41 2023 Start to fix chromosome notation...\nTue Apr 25 15:12:41 2023  -Current Dataframe shape : 12557761  x  12\nTue Apr 25 15:12:41 2023  -Checking CHR data type...\nTue Apr 25 15:12:45 2023  -Vairants with standardized chromosome notation: 12228970\nTue Apr 25 15:12:47 2023  -Vairants with fixable chromosome notations: 328791\nTue Apr 25 15:12:47 2023  -No unrecognized chromosome notations...\nTue Apr 25 15:12:48 2023  -Identifying non-autosomal chromosomes : X, Y, and MT ...\nTue Apr 25 15:12:49 2023  -Identified  328791  variants on sex chromosomes...\nTue Apr 25 15:12:50 2023  -Standardizing sex chromosome notations: X to 23...\nTue Apr 25 15:13:04 2023 Finished fixing chromosome notation successfully!\nTue Apr 25 15:13:04 2023 Start to fix basepair positions...\nTue Apr 25 15:13:04 2023  -Current Dataframe shape : 12557761  x  12\nTue Apr 25 15:13:04 2023  -Converting to Int64 data type ...\nTue Apr 25 15:13:16 2023  -Position upper_bound is: 250,000,000\nTue Apr 25 15:13:18 2023  -Remove outliers: 0\nTue Apr 25 15:13:20 2023  -Converted all position to datatype Int64.\nTue Apr 25 15:13:20 2023 Finished fixing basepair position successfully!\nTue Apr 25 15:13:20 2023 Start to fix alleles...\nTue Apr 25 15:13:20 2023  -Current Dataframe shape : 12557761  x  12\nTue Apr 25 15:13:20 2023  -Converted all bases to string datatype and UPPERCASE.\nTue Apr 25 15:13:23 2023  -Detected 0 variants with alleles that contain bases other than A/C/T/G .\nTue Apr 25 15:13:42 2023 Finished fixing allele successfully!\nTue Apr 25 15:13:42 2023 Start sanity check for statistics ...\nTue Apr 25 15:13:42 2023  -Current Dataframe shape : 12557761  x  12\nTue Apr 25 15:13:42 2023  -Checking if  0 &lt;=N&lt;= 2147483647  ...\nTue Apr 25 15:13:44 2023  -Removed 0 variants with bad N.\nTue Apr 25 15:13:44 2023  -Checking if  0 &lt;=EAF&lt;= 1  ...\nTue Apr 25 15:13:45 2023  -Removed 0 variants with bad EAF.\nTue Apr 25 15:13:45 2023  -Checking if  0 &lt;=MAC&lt;= inf  ...\nTue Apr 25 15:13:46 2023  -Removed 0 variants with bad MAC.\nTue Apr 25 15:13:46 2023  -Checking if  5e-300 &lt;= P &lt;= 1  ...\nTue Apr 25 15:13:47 2023  -Removed 0 variants with bad P.\nTue Apr 25 15:13:47 2023  -Checking if  -10 &lt;BETA)&lt; 10  ...\nTue Apr 25 15:13:48 2023  -Removed 0 variants with bad BETA.\nTue Apr 25 15:13:48 2023  -Checking if  0 &lt;SE&lt; inf  ...\nTue Apr 25 15:13:49 2023  -Removed 0 variants with bad SE.\nTue Apr 25 15:13:49 2023  -Checking STATUS...\nTue Apr 25 15:13:50 2023  -Coverting STAUTUS to interger.\nTue Apr 25 15:13:50 2023  -Removed 0 variants with bad statistics in total.\nTue Apr 25 15:13:50 2023 Finished sanity check successfully!\nTue Apr 25 15:13:50 2023 Start to normalize variants...\nTue Apr 25 15:13:50 2023  -Current Dataframe shape : 12557761  x  12\nTue Apr 25 15:13:56 2023  -Not normalized allele IDs:X:7151130_TT_TC X:9093382_CTTTT_CTTT X:12292253_ATTT_ATT X:16001576_ATT_ATTT X:33822416_GT_GTT ... \nTue Apr 25 15:13:56 2023  -Not normalized allele:['TT' 'TC']['CTTTT' 'CTTT']['ATTT' 'ATT']['ATTT' 'ATT']['GTT' 'GT']... \nTue Apr 25 15:13:56 2023  -Modified 13 variants according to parsimony and left alignment principal.\nTue Apr 25 15:13:57 2023 Finished normalizing variants successfully!\nTue Apr 25 15:13:57 2023 Start to sort the genome coordinates...\nTue Apr 25 15:13:57 2023  -Current Dataframe shape : 12557761  x  12\nTue Apr 25 15:13:57 2023  -Sorting genome coordinates...\nTue Apr 25 15:14:07 2023 Finished sorting genome coordinates successfully!\nTue Apr 25 15:14:07 2023 Start to reorder the columns...\nTue Apr 25 15:14:07 2023  -Current Dataframe shape : 12557761  x  12\nTue Apr 25 15:14:07 2023  -Reordering columns to    : SNPID,CHR,POS,EA,NEA,EAF,BETA,SE,P,N,DIRECTION,STATUS\nTue Apr 25 15:14:07 2023 Finished sorting columns successfully!\n</pre> In\u00a0[8]: Copied! <pre>mysumstats.data\n</pre> mysumstats.data Out[8]: SNPID CHR POS EA NEA EAF BETA SE P N DIRECTION STATUS 0 1:725932_G_A 1 725932 G A 0.9960 -0.0737 0.1394 0.5970 166718 -?+- 9960099 1 1:725933_A_G 1 725933 G A 0.0040 0.0737 0.1394 0.5973 166718 +?-+ 9960099 2 1:737801_T_C 1 737801 C T 0.0051 0.0490 0.1231 0.6908 166718 +?-+ 9960099 3 1:749963_T_TAA 1 749963 TAA T 0.8374 0.0213 0.0199 0.2846 166718 -?++ 9960399 4 1:751343_T_A 1 751343 T A 0.8593 0.0172 0.0156 0.2705 166718 -?++ 9960099 ... ... ... ... ... ... ... ... ... ... ... ... ... 12557756 X:154874837_A_G 23 154874837 G A 0.7478 -0.0064 0.0117 0.5840 191764 -+-+ 9960099 12557757 X:154875192_GTACTC_G 23 154875192 GTACTC G 0.2525 0.0071 0.0122 0.5612 191764 +-+- 9960399 12557758 X:154879115_A_G 23 154879115 G A 0.7463 -0.0070 0.0122 0.5646 191764 -+-+ 9960099 12557759 X:154880669_T_A 23 154880669 T A 0.2558 0.0071 0.0122 0.5618 191764 +-+- 9960099 12557760 X:154880917_C_T 23 154880917 C T 0.2558 0.0072 0.0122 0.5570 191764 +-+- 9960099 <p>12557761 rows \u00d7 12 columns</p> <p>By checking the log, we can see that the sumstats look good. But we still found several variants that were not normalized. gwaslab fixed the position and alleles for the un-normalizated indels. And gwaslab standardize the notation for chromosome X to 23.</p> <p>In fact, <code>.basic_check()</code> is a wrapper of the following basic functions, you can also use these separately.</p> <ul> <li>mysumstats.fix_ID()</li> <li>mysumstats.fix_chr()</li> <li>mysumstats.fix_pos()</li> <li>mysumstats.fix_allele()</li> <li>mysumstats.check_sanity()</li> <li>mysumstats.normalize_allele()</li> </ul> <p>For other options, see: https://cloufield.github.io/gwaslab/Standardization/</p> <p>Let's extract the lead variants in each significant loci to check our data.</p> <p>The significant loci are detected based on a sliding window (default window size: <code>windowsizekb=500</code> kb)</p> <p>By specifying <code>anno=True</code> , gwaslab will also annotate the lead variant with its nearest gene names and distance.</p> <p>Note: GWASLab default genome build version is <code>build=\"19\"</code> (GRCh37/hg19), you can change it to <code>build=\"38\"</code> (GRCh38/hg38) when needed.</p> <p>Note: GWASLab will donwload reference files when you run it for the first time. In this case, <code>ensembl_hg19_gtf_protein_coding</code> was downloaded and processed automatically.</p> In\u00a0[9]: Copied! <pre>mysumstats.get_lead(anno=True)\n</pre> mysumstats.get_lead(anno=True) <pre>Tue Apr 25 14:07:11 2023 Start to extract lead variants...\nTue Apr 25 14:07:11 2023  -Processing 12557761 variants...\nTue Apr 25 14:07:11 2023  -Significance threshold : 5e-08\nTue Apr 25 14:07:11 2023  -Sliding window size: 500  kb\nTue Apr 25 14:07:13 2023  -Found 9461 significant variants in total...\nTue Apr 25 14:07:13 2023  -Identified 89 lead variants!\nTue Apr 25 14:07:13 2023 Start to annotate variants with nearest gene name(s)...\nTue Apr 25 14:07:13 2023  -Assigning Gene name using ensembl_hg19_gtf for protein coding genes\nTue Apr 25 14:07:13 2023 File not exist.\nTue Apr 25 14:07:13 2023 Start to download  ensembl_hg19_gtf  ...\nTue Apr 25 14:07:13 2023  -Downloading to: /home/yunye/.gwaslab/Homo_sapiens.GRCh37.87.chr.gtf.gz\nTue Apr 25 14:09:05 2023  -Updating record in config file...\nTue Apr 25 14:09:05 2023 Downloaded  ensembl_hg19_gtf  successfully!\nTue Apr 25 14:09:05 2023  - Extracting protein_coding genes from /home/yunye/.gwaslab/Homo_sapiens.GRCh37.87.chr.gtf.gz\n</pre> <pre>INFO:root:Extracted GTF attributes: ['gene_id', 'gene_name', 'gene_biotype']\n</pre> <pre>Tue Apr 25 14:09:40 2023  - Loaded 20327 protein_coding genes.\nTue Apr 25 14:09:53 2023  - Extracted records are saved to : /home/yunye/.gwaslab/Homo_sapiens.GRCh37.87.chr.protein_coding.gtf.gz \n</pre> <pre>INFO:pyensembl.database:Creating database: /home/yunye/.gwaslab/Homo_sapiens.GRCh37.87.chr.protein_coding.gtf.db\nINFO:pyensembl.database:Reading GTF from /home/yunye/.gwaslab/Homo_sapiens.GRCh37.87.chr.protein_coding.gtf.gz\nINFO:root:Extracted GTF attributes: ['gene_id', 'gene_version', 'gene_name', 'gene_biotype', 'transcript_id', 'transcript_version', 'transcript_name', 'transcript_biotype', 'ccds_id', 'exon_number', 'exon_id', 'exon_version', 'protein_id', 'protein_version']\nINFO:datacache.database_helpers:Creating database /home/yunye/.gwaslab/Homo_sapiens.GRCh37.87.chr.protein_coding.gtf.db containing: stop_codon, exon, transcript, start_codon, CDS, gene\nINFO:datacache.database:Running sqlite query: \"CREATE TABLE stop_codon (transcript_id TEXT NOT NULL, end INT NOT NULL, transcript_version TEXT NOT NULL, transcript_biotype TEXT NOT NULL, protein_id TEXT NOT NULL, seqname TEXT NOT NULL, ccds_id TEXT NOT NULL, exon_id TEXT NOT NULL, gene_name TEXT NOT NULL, source TEXT NOT NULL, protein_version TEXT NOT NULL, strand TEXT NOT NULL, feature TEXT NOT NULL, exon_number TEXT NOT NULL, exon_version TEXT NOT NULL, gene_version TEXT NOT NULL, transcript_name TEXT NOT NULL, start INT NOT NULL, gene_id TEXT NOT NULL, gene_biotype TEXT NOT NULL)\"\nINFO:datacache.database:Inserting 75368 rows into table stop_codon\nINFO:datacache.database:Creating index on stop_codon (seqname, start, end)\nINFO:datacache.database:Creating index on stop_codon (gene_name)\nINFO:datacache.database:Creating index on stop_codon (gene_id)\nINFO:datacache.database:Creating index on stop_codon (transcript_id)\nINFO:datacache.database:Creating index on stop_codon (transcript_name)\nINFO:datacache.database:Creating index on stop_codon (exon_id)\nINFO:datacache.database:Creating index on stop_codon (protein_id)\nINFO:datacache.database:Creating index on stop_codon (ccds_id)\nINFO:datacache.database:Running sqlite query: \"CREATE TABLE exon (transcript_id TEXT NOT NULL, end INT NOT NULL, transcript_version TEXT NOT NULL, transcript_biotype TEXT NOT NULL, protein_id TEXT NOT NULL, seqname TEXT NOT NULL, ccds_id TEXT NOT NULL, exon_id TEXT NOT NULL, gene_name TEXT NOT NULL, source TEXT NOT NULL, protein_version TEXT NOT NULL, strand TEXT NOT NULL, feature TEXT NOT NULL, exon_number TEXT NOT NULL, exon_version TEXT NOT NULL, gene_version TEXT NOT NULL, transcript_name TEXT NOT NULL, start INT NOT NULL, gene_id TEXT NOT NULL, gene_biotype TEXT NOT NULL)\"\nINFO:datacache.database:Inserting 1070082 rows into table exon\nINFO:datacache.database:Creating index on exon (seqname, start, end)\nINFO:datacache.database:Creating index on exon (gene_name)\nINFO:datacache.database:Creating index on exon (gene_id)\nINFO:datacache.database:Creating index on exon (transcript_id)\nINFO:datacache.database:Creating index on exon (transcript_name)\nINFO:datacache.database:Creating index on exon (exon_id)\nINFO:datacache.database:Creating index on exon (protein_id)\nINFO:datacache.database:Creating index on exon (ccds_id)\nINFO:datacache.database:Running sqlite query: \"CREATE TABLE transcript (transcript_id TEXT UNIQUE PRIMARY KEY NOT NULL, end INT NOT NULL, transcript_version TEXT NOT NULL, transcript_biotype TEXT NOT NULL, protein_id TEXT NOT NULL, seqname TEXT NOT NULL, ccds_id TEXT NOT NULL, exon_id TEXT NOT NULL, gene_name TEXT NOT NULL, source TEXT NOT NULL, protein_version TEXT NOT NULL, strand TEXT NOT NULL, feature TEXT NOT NULL, exon_number TEXT NOT NULL, exon_version TEXT NOT NULL, gene_version TEXT NOT NULL, transcript_name TEXT NOT NULL, start INT NOT NULL, gene_id TEXT NOT NULL, gene_biotype TEXT NOT NULL)\"\nINFO:datacache.database:Inserting 145531 rows into table transcript\nINFO:datacache.database:Creating index on transcript (seqname, start, end)\nINFO:datacache.database:Creating index on transcript (gene_name)\nINFO:datacache.database:Creating index on transcript (gene_id)\nINFO:datacache.database:Creating index on transcript (transcript_name)\nINFO:datacache.database:Creating index on transcript (exon_id)\nINFO:datacache.database:Creating index on transcript (protein_id)\nINFO:datacache.database:Creating index on transcript (ccds_id)\nINFO:datacache.database:Running sqlite query: \"CREATE TABLE start_codon (transcript_id TEXT NOT NULL, end INT NOT NULL, transcript_version TEXT NOT NULL, transcript_biotype TEXT NOT NULL, protein_id TEXT NOT NULL, seqname TEXT NOT NULL, ccds_id TEXT NOT NULL, exon_id TEXT NOT NULL, gene_name TEXT NOT NULL, source TEXT NOT NULL, protein_version TEXT NOT NULL, strand TEXT NOT NULL, feature TEXT NOT NULL, exon_number TEXT NOT NULL, exon_version TEXT NOT NULL, gene_version TEXT NOT NULL, transcript_name TEXT NOT NULL, start INT NOT NULL, gene_id TEXT NOT NULL, gene_biotype TEXT NOT NULL)\"\nINFO:datacache.database:Inserting 83781 rows into table start_codon\nINFO:datacache.database:Creating index on start_codon (seqname, start, end)\nINFO:datacache.database:Creating index on start_codon (gene_name)\nINFO:datacache.database:Creating index on start_codon (gene_id)\nINFO:datacache.database:Creating index on start_codon (transcript_id)\nINFO:datacache.database:Creating index on start_codon (transcript_name)\nINFO:datacache.database:Creating index on start_codon (exon_id)\nINFO:datacache.database:Creating index on start_codon (protein_id)\nINFO:datacache.database:Creating index on start_codon (ccds_id)\nINFO:datacache.database:Running sqlite query: \"CREATE TABLE CDS (transcript_id TEXT NOT NULL, end INT NOT NULL, transcript_version TEXT NOT NULL, transcript_biotype TEXT NOT NULL, protein_id TEXT NOT NULL, seqname TEXT NOT NULL, ccds_id TEXT NOT NULL, exon_id TEXT NOT NULL, gene_name TEXT NOT NULL, source TEXT NOT NULL, protein_version TEXT NOT NULL, strand TEXT NOT NULL, feature TEXT NOT NULL, exon_number TEXT NOT NULL, exon_version TEXT NOT NULL, gene_version TEXT NOT NULL, transcript_name TEXT NOT NULL, start INT NOT NULL, gene_id TEXT NOT NULL, gene_biotype TEXT NOT NULL)\"\nINFO:datacache.database:Inserting 721572 rows into table CDS\nINFO:datacache.database:Creating index on CDS (seqname, start, end)\nINFO:datacache.database:Creating index on CDS (gene_name)\nINFO:datacache.database:Creating index on CDS (gene_id)\nINFO:datacache.database:Creating index on CDS (transcript_id)\nINFO:datacache.database:Creating index on CDS (transcript_name)\nINFO:datacache.database:Creating index on CDS (exon_id)\nINFO:datacache.database:Creating index on CDS (protein_id)\nINFO:datacache.database:Creating index on CDS (ccds_id)\nINFO:datacache.database:Running sqlite query: \"CREATE TABLE gene (transcript_id TEXT NOT NULL, end INT NOT NULL, transcript_version TEXT NOT NULL, transcript_biotype TEXT NOT NULL, protein_id TEXT NOT NULL, seqname TEXT NOT NULL, ccds_id TEXT NOT NULL, exon_id TEXT NOT NULL, gene_name TEXT NOT NULL, source TEXT NOT NULL, protein_version TEXT NOT NULL, strand TEXT NOT NULL, feature TEXT NOT NULL, exon_number TEXT NOT NULL, exon_version TEXT NOT NULL, gene_version TEXT NOT NULL, transcript_name TEXT NOT NULL, start INT NOT NULL, gene_id TEXT UNIQUE PRIMARY KEY NOT NULL, gene_biotype TEXT NOT NULL)\"\nINFO:datacache.database:Inserting 20327 rows into table gene\nINFO:datacache.database:Creating index on gene (seqname, start, end)\nINFO:datacache.database:Creating index on gene (gene_name)\nINFO:datacache.database:Creating index on gene (transcript_id)\nINFO:datacache.database:Creating index on gene (transcript_name)\nINFO:datacache.database:Creating index on gene (exon_id)\nINFO:datacache.database:Creating index on gene (protein_id)\nINFO:datacache.database:Creating index on gene (ccds_id)\nINFO:datacache.database:Running sqlite query: \"CREATE TABLE _datacache_metadata (version INT)\"\nINFO:datacache.database:Running sqlite query: \"INSERT INTO _datacache_metadata VALUES (3)\"\n</pre> <pre>Tue Apr 25 14:11:25 2023 Finished annotating variants with nearest gene name(s) successfully!\nTue Apr 25 14:11:25 2023 Finished extracting lead variants successfully!\n</pre> Out[9]: SNPID CHR POS EA NEA EAF BETA SE P N DIRECTION STATUS LOCATION GENE 96739 1:22068326_A_G 1 22068326 G A 0.7550 0.0621 0.0103 1.629000e-09 191764 ++++ 9960099 0 USP48 213860 1:51103268_T_C 1 51103268 C T 0.7953 -0.0802 0.0120 2.519000e-11 191764 ---- 9960099 0 FAF1 534095 1:154309595_TA_T 1 154309595 TA T 0.0947 -0.0915 0.0166 3.289000e-08 191764 ---- 9960399 0 ATP8B2 969974 2:640986_CACAT_C 2 640986 C CACAT 0.9006 -0.0946 0.0150 2.665000e-10 191764 ---- 9960399 26349 TMEM18 1091807 2:27734972_G_A 2 27734972 G A 0.5605 0.0691 0.0088 3.897000e-15 191764 ++++ 9960099 0 GCKR ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... 12272930 X:21569920_A_G 23 21569920 G A 0.3190 0.0423 0.0076 2.616000e-08 191764 ++++ 9960099 0 CNKSR2 12341406 X:48724648_CAA_C 23 48724648 C CAA 0.6260 -0.0602 0.0103 4.576000e-09 191764 ---- 9960399 26082 TIMM17B 12350767 X:57170781_A_AT 23 57170781 AT A 0.3003 -0.0447 0.0076 4.583000e-09 191764 ---- 9960399 -6723 SPIN2A 12469290 X:117915163_T_TA 23 117915163 TA T 0.5560 0.0548 0.0071 9.818000e-15 191764 ++++ 9960399 0 IL13RA1 12554976 X:152908887_G_A 23 152908887 G A 0.6792 -0.1235 0.0077 9.197000e-58 191764 ---- 9960099 0 DUSP9 <p>89 rows \u00d7 14 columns</p> <p>We extracted a total of 89 lead variants with a sliding window size of 500kb!</p> <p>For other options, see: https://cloufield.github.io/gwaslab/ExtractLead/</p> <p>GWASLab can create much more complicated Manhattan plots.</p> <p>For example,</p> <ul> <li>annotate the lead variants with closest gene names (threshold for annotation p&lt;1e-20)</li> <li>annotate selected variants with user-provided texts</li> <li>pinpoint some variants</li> <li>highlight some loci</li> <li>MAF-stratified Q-Q plot</li> <li>save as my_first_mqq_plot.png with {\"dpi\":400,\"facecolor\":\"white\"}</li> </ul> In\u00a0[10]: Copied! <pre>mysumstats.plot_mqq(mode=\"mqq\",\n                    cut=20,\n                    skip=2,\n                    anno=\"GENENAME\",\n                    sig_level_lead=1e-20,\n                    anno_alias={\"9:22132729_A_G\":\"some annotations\"},\n                    anno_style=\"expand\",\n                    xpad=0.01,\n                    pinpoint=[\"9:22132729_A_G\",\"5:176513896_C_A\"], \n                    pinpoint_color=\"green\",\n                    highlight=[\"7:127253550_C_T\",\"19:46166604_C_T\"],\n                    highlight_windowkb =1000,\n                    stratified=True,\n                    jagged=True,\n                    marker_size=(5,5),\n                    figargs={\"figsize\":(15,5),\"dpi\":300},\n                    save=\"my_first_mqq_plot.png\", \n                    saveargs={\"dpi\":400,\"facecolor\":\"white\"})\n</pre> mysumstats.plot_mqq(mode=\"mqq\",                     cut=20,                     skip=2,                     anno=\"GENENAME\",                     sig_level_lead=1e-20,                     anno_alias={\"9:22132729_A_G\":\"some annotations\"},                     anno_style=\"expand\",                     xpad=0.01,                     pinpoint=[\"9:22132729_A_G\",\"5:176513896_C_A\"],                      pinpoint_color=\"green\",                     highlight=[\"7:127253550_C_T\",\"19:46166604_C_T\"],                     highlight_windowkb =1000,                     stratified=True,                     jagged=True,                     marker_size=(5,5),                     figargs={\"figsize\":(15,5),\"dpi\":300},                     save=\"my_first_mqq_plot.png\",                      saveargs={\"dpi\":400,\"facecolor\":\"white\"}) <pre>Tue Apr 25 14:11:25 2023 Start to plot manhattan/qq plot with the following basic settings:\nTue Apr 25 14:11:25 2023  -Genome-wide significance level is set to 5e-08 ...\nTue Apr 25 14:11:25 2023  -Raw input contains 12557761 variants...\nTue Apr 25 14:11:25 2023  -Plot layout mode is : mqq\nTue Apr 25 14:11:25 2023  -Loci to highlight : 7:127253550_C_T,19:46166604_C_T\nTue Apr 25 14:11:25 2023   -Highlight_window is set to:  1000  kb\nTue Apr 25 14:11:25 2023  -Variants to pinpoint : 9:22132729_A_G,5:176513896_C_A\nTue Apr 25 14:11:29 2023 Finished loading specified columns from the sumstats.\nTue Apr 25 14:11:29 2023 Start conversion and sanity check:\nTue Apr 25 14:11:30 2023  -Removed 0 variants with nan in CHR or POS column ...\nTue Apr 25 14:11:30 2023  -Removed 0 variants with nan in EAF column ...\nTue Apr 25 14:11:31 2023  -Removed 0 variants with nan in P column ...\nTue Apr 25 14:11:32 2023  -Sanity check after conversion: 0 variants with P value outside of (0,1] will be removed...\nTue Apr 25 14:11:32 2023  -sumstats P values are being converted to -log10(P)...\nTue Apr 25 14:11:33 2023  -Sanity check: 0 na/inf/-inf variants will be removed...\nTue Apr 25 14:11:34 2023  -Maximum -log10(P) values is 167.58838029403677 .\nTue Apr 25 14:11:34 2023  -Minus log10(P) values above 20 will be shrunk with a shrinkage factor of 10...\nTue Apr 25 14:11:34 2023 Finished data conversion and sanity check.\nTue Apr 25 14:11:34 2023 Start to create manhattan plot with 332882 variants:\nTue Apr 25 14:11:35 2023  -Highlighting target loci...\nTue Apr 25 14:11:35 2023  -Pinpointing target vairants...\nTue Apr 25 14:11:35 2023  -Found 16 significant variants with a sliding window size of 500 kb...\nTue Apr 25 14:11:35 2023 Start to annotate variants with nearest gene name(s)...\nTue Apr 25 14:11:35 2023  -Assigning Gene name using ensembl_hg19_gtf for protein coding genes\nTue Apr 25 14:11:35 2023 Finished annotating variants with nearest gene name(s) successfully!\nTue Apr 25 14:11:35 2023 Finished creating Manhattan plot successfully!\nTue Apr 25 14:11:35 2023  -Annotating using column GENENAME...\nTue Apr 25 14:11:35 2023  -Adjusting text positions with repel_force=0.03...\nTue Apr 25 14:11:35 2023  -Too many variants to annotate; maybe it is better to reduce the number of variants\nTue Apr 25 14:11:35 2023 Start to create QQ plot with 332882 variants:\nTue Apr 25 14:11:36 2023  -Calculating lambda GC: 1.2128258399293808\nTue Apr 25 14:11:36 2023 Finished creating QQ plot successfully!\nTue Apr 25 14:11:36 2023 Saving plot:\nTue Apr 25 14:11:41 2023  -Saved to my_first_mqq_plot.png successfully!\n</pre> Out[10]: <pre>(&lt;Figure size 4500x1500 with 2 Axes&gt;, &lt;gwaslab.Log.Log at 0x7f46449ff6a0&gt;)</pre> <p>For details, see: https://cloufield.github.io/gwaslab/Visualization/</p> <p>gwaslab can also plot regional plots with or with out LD reference files.</p> <p>For details, see: https://cloufield.github.io/gwaslab/RegionalPlot/</p> <p>We first create a regional plot without references by specifying <code>mode</code> and <code>region</code>.</p> In\u00a0[11]: Copied! <pre>mysumstats.plot_mqq(mode=\"r\",skip=2,cut=20, region=(7,126253550,128253550),region_grid=True)\n</pre> mysumstats.plot_mqq(mode=\"r\",skip=2,cut=20, region=(7,126253550,128253550),region_grid=True) <pre>Tue Apr 25 14:11:46 2023 Start to plot manhattan/qq plot with the following basic settings:\nTue Apr 25 14:11:46 2023  -Genome-wide significance level is set to 5e-08 ...\nTue Apr 25 14:11:46 2023  -Raw input contains 12557761 variants...\nTue Apr 25 14:11:46 2023  -Plot layout mode is : r\nTue Apr 25 14:11:46 2023  -Region to plot : chr7:126253550-128253550.\nTue Apr 25 14:11:47 2023  -Extract SNPs in region : chr7:126253550-128253550...\nTue Apr 25 14:11:49 2023  -Extract SNPs in specified regions: 8087\nTue Apr 25 14:11:50 2023 Finished loading specified columns from the sumstats.\nTue Apr 25 14:11:50 2023 Start conversion and sanity check:\nTue Apr 25 14:11:50 2023  -Removed 0 variants with nan in CHR or POS column ...\nTue Apr 25 14:11:50 2023  -Removed 0 variants with nan in P column ...\nTue Apr 25 14:11:50 2023  -Sanity check after conversion: 0 variants with P value outside of (0,1] will be removed...\nTue Apr 25 14:11:50 2023  -sumstats P values are being converted to -log10(P)...\nTue Apr 25 14:11:50 2023  -Sanity check: 0 na/inf/-inf variants will be removed...\nTue Apr 25 14:11:50 2023  -Maximum -log10(P) values is 73.38711023071251 .\nTue Apr 25 14:11:50 2023  -Minus log10(P) values above 20 will be shrunk with a shrinkage factor of 10...\nTue Apr 25 14:11:50 2023 Finished data conversion and sanity check.\nTue Apr 25 14:11:50 2023 Start to create manhattan plot with 1600 variants:\nTue Apr 25 14:11:50 2023 Start to download  recombination_hg19  ...\nTue Apr 25 14:11:50 2023  -Downloading to: /home/yunye/.gwaslab/recombination/hg19/recombination_hg19.tar.gz\nTue Apr 25 14:13:12 2023  -Updating record in config file...\nTue Apr 25 14:13:12 2023 Downloaded  recombination_hg19  successfully!\nTue Apr 25 14:13:13 2023  -Loading gtf files from:default\n</pre> <pre>INFO:root:Extracted GTF attributes: ['gene_id', 'gene_name', 'gene_biotype']\n</pre> <pre>Tue Apr 25 14:13:50 2023  -plotting gene track..\nTue Apr 25 14:13:50 2023  -Finished plotting gene track..\nTue Apr 25 14:13:50 2023  -Found 1 significant variants with a sliding window size of 500 kb...\nTue Apr 25 14:13:50 2023 Finished creating Manhattan plot successfully!\nTue Apr 25 14:13:50 2023  -Skip annotating\n</pre> Out[11]: <pre>(&lt;Figure size 3000x2000 with 3 Axes&gt;, &lt;gwaslab.Log.Log at 0x7f46449ff6a0&gt;)</pre> <p>Full regional plot will require user-provided vcf or preprocessed vcf files: (e.g 1000 Genomes project, see Reference: https://cloufield.github.io/gwaslab/Reference/)</p> <p>gwaslab also provide pre-processed 1KG datasets.</p> <p>Update the available reference list first if needed</p> In\u00a0[12]: Copied! <pre># gl.update_available_ref()\n</pre> # gl.update_available_ref() In\u00a0[13]: Copied! <pre>gl.check_available_ref()\n</pre> gl.check_available_ref() <pre>Tue Apr 25 14:13:51 2023 Start to check available reference files...\nTue Apr 25 14:13:51 2023  - 1kg_eas_hg19  :  https://www.dropbox.com/s/lztaxqhy2o6dpxw/EAS.ALL.split_norm_af.1kgp3v5.hg19.vcf.gz?dl=1\nTue Apr 25 14:13:51 2023  - 1kg_eas_hg19_md5  :  c8c97434843c0da3113fc06879ead472\nTue Apr 25 14:13:51 2023  - 1kg_eas_hg19_tbi  :  https://www.dropbox.com/s/k9klefl8m9fcfo1/EAS.ALL.split_norm_af.1kgp3v5.hg19.vcf.gz.tbi?dl=1\nTue Apr 25 14:13:51 2023  - 1kg_eur_hg19  :  https://www.dropbox.com/s/1nbgqshknevseks/EUR.ALL.split_norm_af.1kgp3v5.hg19.vcf.gz?dl=1\nTue Apr 25 14:13:51 2023  - 1kg_eur_hg19_md5  :  734069d895009d38c2f962bfbb6fab52\nTue Apr 25 14:13:51 2023  - 1kg_eur_hg19_tbi  :  https://www.dropbox.com/s/vscvkrflh6fc5a0/EUR.ALL.split_norm_af.1kgp3v5.hg19.vcf.gz.tbi?dl=1\nTue Apr 25 14:13:51 2023  - 1kg_eas_hg38  :  https://www.dropbox.com/s/3dstbbb1el9r3au/EAS.ALL.split_norm_af.1kg_30x.hg38.vcf.gz?dl=1\nTue Apr 25 14:13:51 2023  - 1kg_eas_hg38_md5  :  f45e80bca9ef7b29e6b1832e6ac15375\nTue Apr 25 14:13:51 2023  - 1kg_eas_hg38_tbi  :  https://www.dropbox.com/s/vwnp5vd8dcqksn4/EAS.ALL.split_norm_af.1kg_30x.hg38.vcf.gz.tbi?dl=1\nTue Apr 25 14:13:51 2023  - 1kg_eur_hg38  :  https://www.dropbox.com/s/z0mkehg17lryapv/EUR.ALL.split_norm_af.1kg_30x.hg38.vcf.gz?dl=1\nTue Apr 25 14:13:51 2023  - 1kg_eur_hg38_md5  :  228d3285fa99132cc6321e2925e0768d\nTue Apr 25 14:13:51 2023  - 1kg_eur_hg38_tbi  :  https://www.dropbox.com/s/ze8g58x75x9qbf0/EUR.ALL.split_norm_af.1kg_30x.hg38.vcf.gz.tbi?dl=1\nTue Apr 25 14:13:51 2023  - dbsnp_v151_hg19  :  https://ftp.ncbi.nih.gov/snp/organisms/human_9606_b151_GRCh37p13/VCF/00-All.vcf.gz\nTue Apr 25 14:13:51 2023  - dbsnp_v151_hg38  :  https://ftp.ncbi.nih.gov/snp/organisms/human_9606_b151_GRCh38p7/VCF/00-All.vcf.gz\nTue Apr 25 14:13:51 2023  - ucsc_genome_hg19  :  http://hgdownload.cse.ucsc.edu/goldenpath/hg19/bigZips/hg19.fa.gz\nTue Apr 25 14:13:51 2023  - ucsc_genome_hg38  :  https://hgdownload.soe.ucsc.edu/goldenPath/hg38/bigZips/hg38.fa.gz\nTue Apr 25 14:13:51 2023  - 1kg_dbsnp151_hg19_auto  :  https://www.dropbox.com/s/37p2u1xwmux4gwo/1kg_dbsnp151_hg19_auto.txt.gz?dl=1\nTue Apr 25 14:13:51 2023  - 1kg_dbsnp151_hg19_auto_md5  :  7d1e7624fb6e4df7a2f6f05558d436b4\nTue Apr 25 14:13:51 2023  - 1kg_dbsnp151_hg38_auto  :  https://www.dropbox.com/s/ouf60n7gdz6cm0g/1kg_dbsnp151_hg38_auto.txt.gz?dl=1\nTue Apr 25 14:13:51 2023  - 1kg_dbsnp151_hg38_auto_md5  :  4c7ef2d2415c18c286219e970fdda972\nTue Apr 25 14:13:51 2023  - recombination_hg19  :  https://www.dropbox.com/s/wbesl8haxknonuc/recombination_hg19.tar.gz?dl=1\nTue Apr 25 14:13:51 2023  - recombination_hg38  :  https://www.dropbox.com/s/vuo8mvqx0fpibzj/recombination_hg38.tar.gz?dl=1\nTue Apr 25 14:13:51 2023  - ensembl_hg19_gtf  :  https://ftp.ensembl.org/pub/grch37/current/gtf/homo_sapiens/Homo_sapiens.GRCh37.87.chr.gtf.gz\nTue Apr 25 14:13:51 2023  - ensembl_hg38_gtf  :  https://ftp.ensembl.org/pub/release-109/gtf/homo_sapiens//Homo_sapiens.GRCh38.109.chr.gtf.gz\nTue Apr 25 14:13:51 2023  - refseq_hg19_gtf  :  https://ftp.ncbi.nlm.nih.gov/refseq/H_sapiens/annotation/GRCh37_latest/refseq_identifiers/GRCh37_latest_genomic.gtf.gz\nTue Apr 25 14:13:51 2023  - refseq_hg38_gtf  :  https://ftp.ncbi.nlm.nih.gov/refseq/H_sapiens/annotation/GRCh38_latest/refseq_identifiers/GRCh38_latest_genomic.gtf.gz\nTue Apr 25 14:13:51 2023  - testlink  :  https://www.dropbox.com/s/8u7capwge0ihshu/EAS.chr22.split_norm_af.1kgp3v5.vcf.gz?dl=1\nTue Apr 25 14:13:51 2023  - testlink_tbi  :  https://www.dropbox.com/s/hdneg53t6u1j6ib/EAS.chr22.split_norm_af.1kgp3v5.vcf.gz.tbi?dl=1\n</pre> Out[13]: <pre>{'1kg_eas_hg19': 'https://www.dropbox.com/s/lztaxqhy2o6dpxw/EAS.ALL.split_norm_af.1kgp3v5.hg19.vcf.gz?dl=1',\n '1kg_eas_hg19_md5': 'c8c97434843c0da3113fc06879ead472',\n '1kg_eas_hg19_tbi': 'https://www.dropbox.com/s/k9klefl8m9fcfo1/EAS.ALL.split_norm_af.1kgp3v5.hg19.vcf.gz.tbi?dl=1',\n '1kg_eur_hg19': 'https://www.dropbox.com/s/1nbgqshknevseks/EUR.ALL.split_norm_af.1kgp3v5.hg19.vcf.gz?dl=1',\n '1kg_eur_hg19_md5': '734069d895009d38c2f962bfbb6fab52',\n '1kg_eur_hg19_tbi': 'https://www.dropbox.com/s/vscvkrflh6fc5a0/EUR.ALL.split_norm_af.1kgp3v5.hg19.vcf.gz.tbi?dl=1',\n '1kg_eas_hg38': 'https://www.dropbox.com/s/3dstbbb1el9r3au/EAS.ALL.split_norm_af.1kg_30x.hg38.vcf.gz?dl=1',\n '1kg_eas_hg38_md5': 'f45e80bca9ef7b29e6b1832e6ac15375',\n '1kg_eas_hg38_tbi': 'https://www.dropbox.com/s/vwnp5vd8dcqksn4/EAS.ALL.split_norm_af.1kg_30x.hg38.vcf.gz.tbi?dl=1',\n '1kg_eur_hg38': 'https://www.dropbox.com/s/z0mkehg17lryapv/EUR.ALL.split_norm_af.1kg_30x.hg38.vcf.gz?dl=1',\n '1kg_eur_hg38_md5': '228d3285fa99132cc6321e2925e0768d',\n '1kg_eur_hg38_tbi': 'https://www.dropbox.com/s/ze8g58x75x9qbf0/EUR.ALL.split_norm_af.1kg_30x.hg38.vcf.gz.tbi?dl=1',\n 'dbsnp_v151_hg19': 'https://ftp.ncbi.nih.gov/snp/organisms/human_9606_b151_GRCh37p13/VCF/00-All.vcf.gz',\n 'dbsnp_v151_hg38': 'https://ftp.ncbi.nih.gov/snp/organisms/human_9606_b151_GRCh38p7/VCF/00-All.vcf.gz',\n 'ucsc_genome_hg19': 'http://hgdownload.cse.ucsc.edu/goldenpath/hg19/bigZips/hg19.fa.gz',\n 'ucsc_genome_hg38': 'https://hgdownload.soe.ucsc.edu/goldenPath/hg38/bigZips/hg38.fa.gz',\n '1kg_dbsnp151_hg19_auto': 'https://www.dropbox.com/s/37p2u1xwmux4gwo/1kg_dbsnp151_hg19_auto.txt.gz?dl=1',\n '1kg_dbsnp151_hg19_auto_md5': '7d1e7624fb6e4df7a2f6f05558d436b4',\n '1kg_dbsnp151_hg38_auto': 'https://www.dropbox.com/s/ouf60n7gdz6cm0g/1kg_dbsnp151_hg38_auto.txt.gz?dl=1',\n '1kg_dbsnp151_hg38_auto_md5': '4c7ef2d2415c18c286219e970fdda972',\n 'recombination_hg19': 'https://www.dropbox.com/s/wbesl8haxknonuc/recombination_hg19.tar.gz?dl=1',\n 'recombination_hg38': 'https://www.dropbox.com/s/vuo8mvqx0fpibzj/recombination_hg38.tar.gz?dl=1',\n 'ensembl_hg19_gtf': 'https://ftp.ensembl.org/pub/grch37/current/gtf/homo_sapiens/Homo_sapiens.GRCh37.87.chr.gtf.gz',\n 'ensembl_hg38_gtf': 'https://ftp.ensembl.org/pub/release-109/gtf/homo_sapiens//Homo_sapiens.GRCh38.109.chr.gtf.gz',\n 'refseq_hg19_gtf': 'https://ftp.ncbi.nlm.nih.gov/refseq/H_sapiens/annotation/GRCh37_latest/refseq_identifiers/GRCh37_latest_genomic.gtf.gz',\n 'refseq_hg38_gtf': 'https://ftp.ncbi.nlm.nih.gov/refseq/H_sapiens/annotation/GRCh38_latest/refseq_identifiers/GRCh38_latest_genomic.gtf.gz',\n 'testlink': 'https://www.dropbox.com/s/8u7capwge0ihshu/EAS.chr22.split_norm_af.1kgp3v5.vcf.gz?dl=1',\n 'testlink_tbi': 'https://www.dropbox.com/s/hdneg53t6u1j6ib/EAS.chr22.split_norm_af.1kgp3v5.vcf.gz.tbi?dl=1'}</pre> <p>You can see the current available reference files (from the original source or pre-processed by gwaslab).</p> <p>Select the keyword and use <code>download_ref</code> to download the files. The downloaded files will be placed in <code>~/.gwasalb</code> by default.</p> <ul> <li><code>1kg_eas_hg19</code> : processed 1000 Genomes Project EAS samples dataset(hg19; ~2.8GB) It may take several minutes to download.</li> </ul> In\u00a0[14]: Copied! <pre># ~2.8GB\ngl.download_ref(\"1kg_eas_hg19\")\n</pre> # ~2.8GB gl.download_ref(\"1kg_eas_hg19\") <pre>Tue Apr 25 14:13:51 2023 Start to download  1kg_eas_hg19  ...\nTue Apr 25 14:13:51 2023  -Downloading to: /home/yunye/.gwaslab/EAS.ALL.split_norm_af.1kgp3v5.hg19.vcf.gz\nTue Apr 25 14:15:41 2023  -File path: /home/yunye/.gwaslab/EAS.ALL.split_norm_af.1kgp3v5.hg19.vcf.gz\nTue Apr 25 14:15:41 2023  -MD5 check: c8c97434843c0da3113fc06879ead472\nTue Apr 25 14:15:41 2023  -MD5 verified.\nTue Apr 25 14:15:41 2023  -Updating record in config file...\nTue Apr 25 14:15:43 2023  -Updating record in config file...\nTue Apr 25 14:15:43 2023  -Downloading to: /home/yunye/.gwaslab/EAS.ALL.split_norm_af.1kgp3v5.hg19.vcf.gz.tbi\nTue Apr 25 14:15:43 2023 Downloaded  1kg_eas_hg19  successfully!\n</pre> In\u00a0[15]: Copied! <pre>gl.check_downloaded_ref()\n</pre> gl.check_downloaded_ref() <pre>Tue Apr 25 14:15:43 2023 Start to check downloaded reference files...\nTue Apr 25 14:15:43 2023  -Checking the config file:/home/yunye/work/gwaslab/src/gwaslab/data/config.json\nTue Apr 25 14:15:43 2023  -Config file exists.\nTue Apr 25 14:15:43 2023  -Updating config.json...\nTue Apr 25 14:15:43 2023   - ensembl_hg19_gtf  :  /home/yunye/.gwaslab/Homo_sapiens.GRCh37.87.chr.gtf.gz\nTue Apr 25 14:15:43 2023   - recombination_hg19  :  /home/yunye/.gwaslab/recombination/hg19/recombination_hg19.tar.gz\nTue Apr 25 14:15:43 2023   - 1kg_eas_hg19  :  /home/yunye/.gwaslab/EAS.ALL.split_norm_af.1kgp3v5.hg19.vcf.gz\nTue Apr 25 14:15:43 2023   - 1kg_eas_hg19_tbi  :  /home/yunye/.gwaslab/EAS.ALL.split_norm_af.1kgp3v5.hg19.vcf.gz.tbi\n</pre> Out[15]: <pre>{'ensembl_hg19_gtf': '/home/yunye/.gwaslab/Homo_sapiens.GRCh37.87.chr.gtf.gz',\n 'recombination_hg19': '/home/yunye/.gwaslab/recombination/hg19/recombination_hg19.tar.gz',\n '1kg_eas_hg19': '/home/yunye/.gwaslab/EAS.ALL.split_norm_af.1kgp3v5.hg19.vcf.gz',\n '1kg_eas_hg19_tbi': '/home/yunye/.gwaslab/EAS.ALL.split_norm_af.1kgp3v5.hg19.vcf.gz.tbi'}</pre> <p>After downloading, use <code>get_path</code> to obtain the file path by specifying the keyword.</p> <p>Note:</p> <ul> <li>If <code>tabix</code> is available in PATH, the speed will be  will greatly improved. Otherwise, vcf files will be loaded from the head.</li> <li>tabix: http://www.htslib.org/download/</li> </ul> In\u00a0[16]: Copied! <pre>mysumstats.plot_mqq(mode=\"r\",\n                    region=(7,126253550,128253550),\n                    region_grid=True,\n                    anno=True,\n                    anno_args={\"rotation\":0,\"fontsize\":12},\n                    vcf_path=gl.get_path(\"1kg_eas_hg19\"))\n</pre> mysumstats.plot_mqq(mode=\"r\",                     region=(7,126253550,128253550),                     region_grid=True,                     anno=True,                     anno_args={\"rotation\":0,\"fontsize\":12},                     vcf_path=gl.get_path(\"1kg_eas_hg19\")) <pre>Tue Apr 25 14:15:43 2023 Start to plot manhattan/qq plot with the following basic settings:\nTue Apr 25 14:15:43 2023  -Genome-wide significance level is set to 5e-08 ...\nTue Apr 25 14:15:43 2023  -Raw input contains 12557761 variants...\nTue Apr 25 14:15:43 2023  -Plot layout mode is : r\nTue Apr 25 14:15:43 2023  -Region to plot : chr7:126253550-128253550.\nTue Apr 25 14:15:44 2023  -Extract SNPs in region : chr7:126253550-128253550...\nTue Apr 25 14:15:47 2023  -Extract SNPs in specified regions: 8087\nTue Apr 25 14:15:47 2023 Finished loading specified columns from the sumstats.\nTue Apr 25 14:15:47 2023 Start conversion and sanity check:\nTue Apr 25 14:15:47 2023  -Removed 0 variants with nan in CHR or POS column ...\nTue Apr 25 14:15:47 2023  -Removed 0 variants with nan in P column ...\nTue Apr 25 14:15:47 2023  -Sanity check after conversion: 0 variants with P value outside of (0,1] will be removed...\nTue Apr 25 14:15:47 2023  -sumstats P values are being converted to -log10(P)...\nTue Apr 25 14:15:47 2023  -Sanity check: 0 na/inf/-inf variants will be removed...\nTue Apr 25 14:15:47 2023  -Maximum -log10(P) values is 73.38711023071251 .\nTue Apr 25 14:15:47 2023 Finished data conversion and sanity check.\nTue Apr 25 14:15:47 2023 Start to load reference genotype...\nTue Apr 25 14:15:47 2023  -reference vcf path : /home/yunye/.gwaslab/EAS.ALL.split_norm_af.1kgp3v5.hg19.vcf.gz\nTue Apr 25 14:15:48 2023  -Retrieving index...\nTue Apr 25 14:15:48 2023  -Ref variants in the region: 54234\nTue Apr 25 14:15:48 2023  -Matching variants using POS, NEA, EA ...\nTue Apr 25 14:15:49 2023  -Calculating Rsq...\nTue Apr 25 14:15:49 2023 Finished loading reference genotype successfully!\nTue Apr 25 14:15:49 2023 Start to create manhattan plot with 8087 variants:\nTue Apr 25 14:15:49 2023  -Loading gtf files from:default\n</pre> <pre>INFO:root:Extracted GTF attributes: ['gene_id', 'gene_name', 'gene_biotype']\n</pre> <pre>Tue Apr 25 14:16:27 2023  -plotting gene track..\nTue Apr 25 14:16:27 2023  -Finished plotting gene track..\nTue Apr 25 14:16:27 2023  -Found 1 significant variants with a sliding window size of 500 kb...\nTue Apr 25 14:16:27 2023 Finished creating Manhattan plot successfully!\nTue Apr 25 14:16:27 2023  -Annotating using column CHR:POS...\nTue Apr 25 14:16:27 2023  -Adjusting text positions with repel_force=0.03...\n</pre> Out[16]: <pre>(&lt;Figure size 3000x2000 with 4 Axes&gt;, &lt;gwaslab.Log.Log at 0x7f46449ff6a0&gt;)</pre> <p>Or you can provide your own vcf files for <code>vcf_path</code>.</p> In\u00a0[\u00a0]: Copied! <pre># mysumstats.plot_mqq(mode=\"r\",\n#                     region=(7,156538803,157538803),\n#                     region_grid=True,\n#                     anno=True,\n#                     vcf_path=\"/home/yunye/mydata/d_disk/eas_1kg_af/EAS.ALL.split_norm_af.1kgp3v5.hg19.vcf.gz\")\n</pre> # mysumstats.plot_mqq(mode=\"r\", #                     region=(7,156538803,157538803), #                     region_grid=True, #                     anno=True, #                     vcf_path=\"/home/yunye/mydata/d_disk/eas_1kg_af/EAS.ALL.split_norm_af.1kgp3v5.hg19.vcf.gz\") <p>Note: gwaslab default genome build version is <code>build=\"19\"</code> (GRCh37/hg19), you can change it to <code>build=\"38\"</code> (GRCh38/hg38) when needed. For gene tracks, default is <code>gtf_path=\"ensembl\"</code> , you can also use <code>gtf_path=\"refseq\"</code> (NCBA RefSeq)</p> <p>There are more than 10 million variants in the original sumstats and it will take some time to process the entrie dataset. Let's just randomly sample 100K variants for this tutorial.</p> In\u00a0[17]: Copied! <pre>mysumstats.random_variants(n=100000,inplace=True,random_state=1234)\n</pre> mysumstats.random_variants(n=100000,inplace=True,random_state=1234) <pre>Tue Apr 25 15:14:07 2023 Start to randomly select variants from the sumstats...\nTue Apr 25 15:14:07 2023  -Number of variants selected from the sumstats: 100000\nTue Apr 25 15:14:07 2023  -Random state (seed): 1234\nTue Apr 25 15:14:07 2023 Finished sampling...\n</pre> <p>In case you don't know the genome build of the sumstats</p> <p>For details, see: https://cloufield.github.io/gwaslab/InferBuild/</p> In\u00a0[18]: Copied! <pre>mysumstats.infer_build()\n</pre> mysumstats.infer_build() <pre>Tue Apr 25 15:14:08 2023 Start to infer genome build version using hapmap3 SNPs...\nTue Apr 25 15:14:08 2023  -Loading Hapmap3 variants data...\nTue Apr 25 15:14:09 2023  -CHR:POS will be used for matching...\nTue Apr 25 15:14:10 2023  -Matching variants for hg19: num_hg19 =  8671\nTue Apr 25 15:14:10 2023  -Matching variants for hg38: num_hg38 =  145\nTue Apr 25 15:14:10 2023  -Warning: please be cautious due to the limited number of variants.\nTue Apr 25 15:14:10 2023  -Since num_hg19 &gt;&gt; num_hg38, assigning genome build hg19...\n</pre> <p>You may notice that the SNPID is in <code>CHR:POS_REF_ALT</code> format. We want SNPID to be in a stadardized format <code>CHR:POS:REF:ALT</code>, we can use fix_id for this:</p> <p>For other options of standardization, see: https://cloufield.github.io/gwaslab/Standardization/</p> In\u00a0[19]: Copied! <pre>#fixsep : fix ID separator\nmysumstats.fix_id(fixsep=True)\n</pre> #fixsep : fix ID separator mysumstats.fix_id(fixsep=True) <pre>Tue Apr 25 15:14:11 2023 Start to check IDs...\nTue Apr 25 15:14:11 2023  -Current Dataframe shape : 100000  x  12\nTue Apr 25 15:14:11 2023  -Checking if SNPID is chr:pos:ref:alt...(separator: - ,: , _)\nTue Apr 25 15:14:11 2023  -Replacing [_-] in SNPID with \":\" ...\nTue Apr 25 15:14:11 2023 Finished checking IDs successfully!\n</pre> In\u00a0[20]: Copied! <pre>mysumstats.data\n</pre> mysumstats.data Out[20]: SNPID CHR POS EA NEA EAF BETA SE P N DIRECTION STATUS 1736173 2:180784768:G:T 2 180784768 G T 0.9978 0.0797 0.1141 0.4850 191764 -+++ 1960099 258841 1:61108984:G:C 1 61108984 G C 0.4847 -0.0095 0.0087 0.2767 191764 +--+ 1960099 89268 1:20294687:G:A 1 20294687 G A 0.7936 0.0161 0.0111 0.1484 191764 0++- 1960099 10697866 16:86560264:T:C 16 86560264 C T 0.3114 -0.0016 0.0095 0.8663 191764 --+- 1960099 6068219 7:152311067:G:A 7 152311067 G A 0.9977 0.1369 0.1433 0.3395 166718 +?++ 1960099 ... ... ... ... ... ... ... ... ... ... ... ... ... 3376277 4:105613391:C:T 4 105613391 C T 0.9966 0.1211 0.0939 0.1974 191764 ++++ 1960099 5598990 7:38184549:A:T 7 38184549 T A 0.6533 -0.0000 0.0095 0.9982 191764 +-+- 1960099 7580034 10:58897803:A:G 10 58897803 G A 0.0096 -0.0339 0.0623 0.5860 191764 ++-- 1960099 10546104 16:58355232:G:A 16 58355232 G A 0.6904 0.0083 0.0108 0.4401 191764 +-++ 1960099 9937711 14:94630415:G:A 14 94630415 G A 0.7970 0.0174 0.0113 0.1221 191764 ++++ 1960099 <p>100000 rows \u00d7 12 columns</p> <p>rsID is assigned using two types of reference file:</p> <ul> <li>ref_rsid_tsv : tsv file for annotation of commonly used variants</li> <li>ref_rsid_vcf : vcf file for annotation of other variants</li> </ul> <p>GWASLab provides preprocessed tsv files for 1KG varaints (~80M), we can download the file using <code>.download_ref</code> with key words. This time we will use <code>1kg_dbsnp151_hg19_auto</code>, which is the SNPID-rsID conversion table for autosomal variants in 1KG project (hg19). This will take around a few minutes to dowadload.</p> In\u00a0[21]: Copied! <pre># 961M\ngl.download_ref(\"1kg_dbsnp151_hg19_auto\")\n</pre> # 961M gl.download_ref(\"1kg_dbsnp151_hg19_auto\") <pre>Tue Apr 25 14:16:32 2023 Start to download  1kg_dbsnp151_hg19_auto  ...\nTue Apr 25 14:16:32 2023  -Downloading to: /home/yunye/.gwaslab/1kg_dbsnp151_hg19_auto.txt.gz\nTue Apr 25 14:17:08 2023  -File path: /home/yunye/.gwaslab/1kg_dbsnp151_hg19_auto.txt.gz\nTue Apr 25 14:17:08 2023  -MD5 check: 7d1e7624fb6e4df7a2f6f05558d436b4\nTue Apr 25 14:17:08 2023  -MD5 verified.\nTue Apr 25 14:17:08 2023  -Updating record in config file...\nTue Apr 25 14:17:08 2023 Downloaded  1kg_dbsnp151_hg19_auto  successfully!\n</pre> In\u00a0[22]: Copied! <pre>mysumstats.assign_rsid(ref_rsid_tsv= gl.get_path(\"1kg_dbsnp151_hg19_auto\"))\n</pre> mysumstats.assign_rsid(ref_rsid_tsv= gl.get_path(\"1kg_dbsnp151_hg19_auto\")) <pre>Tue Apr 25 15:14:11 2023 Start to annotate rsID based on chromosome and position information...\nTue Apr 25 15:14:11 2023  -Current Dataframe shape : 100000  x  12\nTue Apr 25 15:14:11 2023  -SNPID-rsID text file: /home/yunye/.gwaslab/1kg_dbsnp151_hg19_auto.txt.gz\nTue Apr 25 15:14:11 2023  -100000 rsID could be possibly fixed...\nTue Apr 25 15:14:11 2023  -Setting block size:  5000000\nTue Apr 25 15:14:11 2023  -Loading block: 0   1   2   3   4   5   6   7   8   9   10   11   12   13   14   15   \nTue Apr 25 15:18:13 2023  -rsID Annotation for 3266 need to be fixed!\nTue Apr 25 15:18:13 2023  -Annotated 96734 rsID successfully!\n</pre> <ul> <li>We annotated 96734  (96734 /100000 = 96.7%) variants using the conversion table.</li> <li>For the annotation of other variants (3.3%), we may need the dbSNP reference vcf.</li> </ul> <p>For the annotation of not-so-common variants, we can use vcf files downloaded form NCBI dbsnp (https://ftp.ncbi.nih.gov/snp/latest_release/VCF/).</p> <p>Note:</p> <ul> <li>The file size is huge (&gt;20GB) and it might take several hours to download. (we can skip this step in this tutorial. )</li> <li>Specify <code>chr_dict</code> to match the chromosome notations in sumstats and in vcf files.</li> </ul> <p>Parameters :</p> <ul> <li><code>ref_rsid_vcf</code>: the path to the reference rsID vcf file</li> <li><code>n_cores</code> : number of threads to use</li> </ul> In\u00a0[23]: Copied! <pre>mysumstats.assign_rsid(n_cores=1,\n                       ref_rsid_vcf= \"/home/yunye/CommonData/Reference/ncbi_dbsnp/ncbi_dbsnp/db155/GCF_000001405.25.gz\",\n                       chr_dict = gl.get_number_to_NC(build=\"19\") )\n</pre> mysumstats.assign_rsid(n_cores=1,                        ref_rsid_vcf= \"/home/yunye/CommonData/Reference/ncbi_dbsnp/ncbi_dbsnp/db155/GCF_000001405.25.gz\",                        chr_dict = gl.get_number_to_NC(build=\"19\") ) <pre>Tue Apr 25 15:18:13 2023 Start to assign rsID using vcf...\nTue Apr 25 15:18:13 2023  -Current Dataframe shape : 100000  x  13\nTue Apr 25 15:18:13 2023  -CPU Cores to use : 1\nTue Apr 25 15:18:13 2023  -Reference VCF file: /home/yunye/CommonData/Reference/ncbi_dbsnp/ncbi_dbsnp/db155/GCF_000001405.25.gz\nTue Apr 25 15:18:13 2023  -Assigning rsID based on chr:pos and ref:alt/alt:ref...\nTue Apr 25 15:18:19 2023  -rsID Annotation for 122 need to be fixed!\nTue Apr 25 15:18:19 2023  -Annotated 3144 rsID successfully!\n</pre> <p>After this, only 122 variants were not annotated. (122/100000 = 0.122%), mostly indels.</p> In\u00a0[24]: Copied! <pre>mysumstats.data.loc[mysumstats.data[\"rsID\"].isna(),:]\n</pre> mysumstats.data.loc[mysumstats.data[\"rsID\"].isna(),:] Out[24]: SNPID CHR POS EA NEA EAF BETA SE P N DIRECTION STATUS rsID 248 2:175894098:G:AA 2 175894098 G AA 0.6600 -0.0029 0.0095 0.76090 191764 ++-- 1960399 &lt;NA&gt; 269 X:95972533:A:AT 23 95972533 AT A 0.2461 0.0175 0.0096 0.06804 191764 +-++ 1960399 &lt;NA&gt; 1455 X:120283097:A:AT 23 120283097 AT A 0.1279 -0.0144 0.0110 0.18910 191764 ---+ 1960399 &lt;NA&gt; 1803 2:153147115:C:AA 2 153147115 C AA 0.5061 -0.0005 0.0103 0.96120 191764 -++- 1960399 &lt;NA&gt; 1985 X:113620243:CAAA:C 23 113620243 C CAAA 0.2933 0.0053 0.0082 0.52150 191764 -+++ 1960399 &lt;NA&gt; ... ... ... ... ... ... ... ... ... ... ... ... ... ... 93825 3:104431873:C:AA 3 104431873 C AA 0.0417 -0.0328 0.0221 0.13830 191764 ++-- 1960399 &lt;NA&gt; 93840 X:18195379:CTT:C 23 18195379 C CTT 0.1204 0.0260 0.0131 0.04715 191764 ++++ 1960399 &lt;NA&gt; 94793 8:69844929:CAAACAAAACA:C 8 69844929 C CAAACAAAACA 0.0300 0.0332 0.0368 0.36610 191764 ++++ 1960399 &lt;NA&gt; 98581 X:97528779:TTTG:T 23 97528779 TTTG T 0.1536 0.0007 0.0097 0.93880 191764 -++- 1960399 &lt;NA&gt; 98879 X:14442356:G:GAC 23 14442356 GAC G 0.0828 -0.0036 0.0145 0.80530 191764 --+- 1960399 &lt;NA&gt; <p>122 rows \u00d7 13 columns</p> <p>Tips : The two steps can be run in a single one.</p> In\u00a0[24]: Copied! <pre>#mysumstats.assign_rsid(n_cores=3,\n#                       ref_rsid_tsv= gl.get_path(\"1kg_dbsnp151_hg19_auto\"),\n#                       ref_rsid_vcf= \"/home/yunye/CommonData/Reference/ncbi_dbsnp/ncbi_dbsnp/db155/GCF_000001405.25.gz\",\n#                       chr_dict = gl.get_number_to_NC(build=\"19\") )\n</pre> #mysumstats.assign_rsid(n_cores=3, #                       ref_rsid_tsv= gl.get_path(\"1kg_dbsnp151_hg19_auto\"), #                       ref_rsid_vcf= \"/home/yunye/CommonData/Reference/ncbi_dbsnp/ncbi_dbsnp/db155/GCF_000001405.25.gz\", #                       chr_dict = gl.get_number_to_NC(build=\"19\") ) <p>gwaslab can harmonize the sumstats based on reference files.</p> <ul> <li>ref_seq : reference genome fasta file for allele alignment</li> <li>ref_infer : vcf file with allele frequency information for inferring strand and comparing allele frequency</li> <li>ref_alt_freq : field in INFO of vcf file for alternative allele frequency</li> </ul> <p>For details see: https://cloufield.github.io/gwaslab/Harmonization/</p> <p>For reference data, see: https://cloufield.github.io/gwaslab/Reference/</p> <p>We can use the refernce genome from 1000 genomes.</p> <p>http://ftp.1000genomes.ebi.ac.uk/vol1/ftp/technical/reference/human_g1k_v37.fasta.gz http://ftp.1000genomes.ebi.ac.uk/vol1/ftp/technical/reference/human_g1k_v37.fasta.fai</p> <p>When calling <code>.harmonize()</code>, <code>.basic_check()</code> will be called first to make sure the dataset is ready for harmonization. Since we have already performed basic_check, we set <code>basic_check=False</code> here. For <code>ref_infer</code>, we pass the downloaded vcf files for 1KG EAS and specify the field for alternative allele frequency to AF by <code>ref_alt_freq= \"AF\"</code>.</p> In\u00a0[25]: Copied! <pre>mysumstats.harmonize(basic_check=False,\n                     n_cores=3,\n                     ref_seq     = \"/home/yunye/CommonData/Reference/genome/humanG1Kv37/human_g1k_v37.fasta\",\n                     ref_infer   = gl.get_path(\"1kg_eas_hg19\"),\n                     ref_alt_freq= \"AF\")\n</pre> mysumstats.harmonize(basic_check=False,                      n_cores=3,                      ref_seq     = \"/home/yunye/CommonData/Reference/genome/humanG1Kv37/human_g1k_v37.fasta\",                      ref_infer   = gl.get_path(\"1kg_eas_hg19\"),                      ref_alt_freq= \"AF\") <pre>Tue Apr 25 15:18:19 2023 Start to check if NEA is aligned with reference sequence...\nTue Apr 25 15:18:19 2023  -Current Dataframe shape : 100000  x  13\nTue Apr 25 15:18:19 2023  -Reference genome fasta file: /home/yunye/CommonData/Reference/genome/humanG1Kv37/human_g1k_v37.fasta\nTue Apr 25 15:18:19 2023  -Checking records: 1  2  3  4  5  6  7  8  9  10  11  12  13  14  15  16  17  18  19  20  21  22  X  Y  MT  \nTue Apr 25 15:18:35 2023  -Variants allele on given reference sequence :  41528\nTue Apr 25 15:18:35 2023  -Variants flipped :  50055\nTue Apr 25 15:18:35 2023   -Raw Matching rate :  91.58%\nTue Apr 25 15:18:35 2023  -Variants inferred reverse_complement :  0\nTue Apr 25 15:18:35 2023  -Variants inferred reverse_complement_flipped :  0\nTue Apr 25 15:18:35 2023  -Both allele on genome + unable to distinguish :  8417\nTue Apr 25 15:18:35 2023  -Variants not on given reference sequence :  0\nTue Apr 25 15:18:35 2023  -Current Dataframe shape : 100000  x  13\nTue Apr 25 15:18:35 2023 Start to flip allele-specific stats for SNPs with status xxxxx[35]x: alt-&gt;ea , ref-&gt;nea ... \nTue Apr 25 15:18:35 2023  -Flipping 50055 variants...\nTue Apr 25 15:18:35 2023  -Swapping column: NEA &lt;=&gt; EA...\nTue Apr 25 15:18:35 2023  -Flipping column: BETA = - BETA...\nTue Apr 25 15:18:35 2023  -Flipping column: EAF = 1 - EAF...\nTue Apr 25 15:18:35 2023  -Flipping column: DIRECTION +-? &lt;=&gt; -+? ...\nTue Apr 25 15:18:35 2023  -Changed the status for flipped variants : xxxxx[35]x -&gt; xxxxx[12]x\nTue Apr 25 15:18:35 2023 Finished converting successfully!\nTue Apr 25 15:18:35 2023 Start to infer strand for palindromic SNPs...\nTue Apr 25 15:18:35 2023  -Current Dataframe shape : 100000  x  13\nTue Apr 25 15:18:35 2023  -Reference vcf file: /home/yunye/.gwaslab/EAS.ALL.split_norm_af.1kgp3v5.hg19.vcf.gz\nTue Apr 25 15:18:35 2023  -Alternative allele frequency in INFO: AF\nTue Apr 25 15:18:35 2023  -Identified  14174  palindromic SNPs...\nTue Apr 25 15:18:35 2023  -After filtering by MAF&lt;  0.4  , the strand of  12937  palindromic SNPs will be inferred...\nTue Apr 25 15:18:40 2023   -Non-palindromic :  76650\nTue Apr 25 15:18:40 2023   -Palindromic SNPs on + strand:  12566\nTue Apr 25 15:18:40 2023   -Palindromic SNPs on - strand and need to be flipped: 17\nTue Apr 25 15:18:40 2023   -Palindromic SNPs with maf not availble to infer :  1237\nTue Apr 25 15:18:40 2023   -Palindromic SNPs with no macthes or no information :  181\nTue Apr 25 15:18:40 2023  -Identified  8417  indistinguishable Indels...\nTue Apr 25 15:18:40 2023  -Indistinguishable Indels will be inferred from reference vcf ref and alt...\nTue Apr 25 15:18:49 2023   -Indels ea/nea match reference :  3659\nTue Apr 25 15:18:49 2023   -Indels ea/nea need to be flipped :  4484\nTue Apr 25 15:18:49 2023   -Indels with no macthes or no information :  274\nTue Apr 25 15:18:49 2023  -Current Dataframe shape : 100000  x  13\nTue Apr 25 15:18:49 2023 Start to flip allele-specific stats for standardized indels with status xxxx[123][67][6]: alt-&gt;ea , ref-&gt;nea ... \nTue Apr 25 15:18:49 2023  -Flipping 4484 variants...\nTue Apr 25 15:18:49 2023  -Swapping column: NEA &lt;=&gt; EA...\nTue Apr 25 15:18:49 2023  -Flipping column: BETA = - BETA...\nTue Apr 25 15:18:49 2023  -Flipping column: EAF = 1 - EAF...\nTue Apr 25 15:18:49 2023  -Flipping column: DIRECTION +-? &lt;=&gt; -+? ...\nTue Apr 25 15:18:49 2023  -Changed the status for flipped variants xxxx[123][67]6 -&gt; xxxx[123][67]4\nTue Apr 25 15:18:49 2023 Start to flip allele-specific stats for palindromic SNPs with status xxxxx[12]5: (-)strand &lt;=&gt; (+)strand ... \nTue Apr 25 15:18:49 2023  -Flipping 17 variants...\nTue Apr 25 15:18:49 2023  -Flipping column: BETA = - BETA...\nTue Apr 25 15:18:49 2023  -Flipping column: EAF = 1 - EAF...\nTue Apr 25 15:18:49 2023  -Flipping column: DIRECTION +-? &lt;=&gt; -+? ...\nTue Apr 25 15:18:49 2023  -Changed the status for flipped variants:  xxxxx[012]5: -&gt;  xxxxx[012]2\nTue Apr 25 15:18:49 2023 Finished converting successfully!\nTue Apr 25 15:18:49 2023 Start to sort the genome coordinates...\nTue Apr 25 15:18:49 2023  -Current Dataframe shape : 100000  x  13\nTue Apr 25 15:18:49 2023  -Sorting genome coordinates...\nTue Apr 25 15:18:49 2023 Finished sorting genome coordinates successfully!\nTue Apr 25 15:18:49 2023 Start to reorder the columns...\nTue Apr 25 15:18:49 2023  -Current Dataframe shape : 100000  x  13\nTue Apr 25 15:18:49 2023  -Reordering columns to    : SNPID,rsID,CHR,POS,EA,NEA,EAF,BETA,SE,P,N,DIRECTION,STATUS\nTue Apr 25 15:18:49 2023 Finished sorting columns successfully!\n</pre> Out[25]: <pre>&lt;gwaslab.Sumstats.Sumstats at 0x7f26bc3e3b20&gt;</pre> <p>Check the data again. Looks good!</p> In\u00a0[26]: Copied! <pre>mysumstats.data\n</pre> mysumstats.data Out[26]: SNPID rsID CHR POS EA NEA EAF BETA SE P N DIRECTION STATUS 0 1:875643:C:G rs7411115 1 875643 G C 0.7290 0.0147 0.0130 0.258600 166718 +?+- 1960001 1 1:928416:G:A rs111754459 1 928416 A G 0.1363 0.0113 0.0142 0.423300 191764 --+- 1960010 2 1:933045:C:T rs189213898 1 933045 T C 0.0087 0.0008 0.0704 0.991500 166718 -?+- 1960010 3 1:1019158:G:A rs142369888 1 1019158 A G 0.0110 0.1189 0.0613 0.052510 166718 +?++ 1960010 4 1:1023310:T:C rs11260589 1 1023310 C T 0.0854 0.0202 0.0182 0.265600 191764 +++- 1960000 ... ... ... ... ... ... ... ... ... ... ... ... ... ... 99995 X:153882706:C:T rs3829775 23 153882706 T C 0.0125 -0.0017 0.0526 0.973600 166718 +?-- 1960010 99996 X:154087726:C:T rs112922881 23 154087726 T C 0.0743 0.0414 0.0151 0.006171 191764 +-+- 1960010 99997 X:154126990:T:C rs28370221 23 154126990 C T 0.0763 -0.0085 0.0132 0.519500 191764 +--- 1960000 99998 X:154140146:T:G rs28895719 23 154140146 G T 0.1707 0.0043 0.0096 0.652700 191764 +-+- 1960000 99999 X:154278797:T:C rs114209171 23 154278797 C T 0.1738 0.0025 0.0091 0.785500 191764 +-+- 1960000 <p>100000 rows \u00d7 13 columns</p> <p>Check the summary of the currrent sumstats (see: https://cloufield.github.io/gwaslab/StatusCode/):</p> In\u00a0[27]: Copied! <pre>mysumstats.summary()\n</pre> mysumstats.summary() Out[27]: Values Percentage Category Items META Row_num 100000 NaN Column_num 13 NaN Column_names SNPID,rsID,CHR,POS,EA,NEA,EAF,BETA,SE,P,N,DIRE... NaN Last_checked_time Tue Apr 25 15:18:49 2023 NaN MISSING Missing_total 122 0.12 Missing_rsID 122 0.12 MAF Common 50983 50.98 Low_frequency 16809 16.81 Rare 32157 32.16 P Minimum 1.1900000000000001e-77 0.00 Significant 86 0.09 Suggestive 166 0.17 STATUS 1960010 42815 42.82 1960000 33835 33.84 1960001 6329 6.33 1960011 6237 6.24 1960364 4484 4.48 1960363 3659 3.66 1960007 621 0.62 1960017 616 0.62 1960309 563 0.56 1960368 274 0.27 1960319 196 0.20 1960018 181 0.18 1960008 173 0.17 1960012 10 0.01 1960002 7 0.01 <p>Check the details of harmonization results <code>.lookup_status()</code></p> In\u00a0[28]: Copied! <pre>mysumstats.lookup_status()\n</pre> mysumstats.lookup_status() Out[28]: Genome_Build rsID&amp;SNPID CHR&amp;POS Stadardize&amp;Normalize Align Panlidromic_SNP&amp;Indel Count Percentage(%) 1960000 hg19 rsid unknown &amp; SNPID valid CHR valid &amp; POS valid standardized SNP Match: NEA=REF Not_palindromic_SNPs 33835 33.84 1960001 hg19 rsid unknown &amp; SNPID valid CHR valid &amp; POS valid standardized SNP Match: NEA=REF Palindromic+strand 6329 6.33 1960002 hg19 rsid unknown &amp; SNPID valid CHR valid &amp; POS valid standardized SNP Match: NEA=REF Palindromic-strand_fixed 7 0.01 1960007 hg19 rsid unknown &amp; SNPID valid CHR valid &amp; POS valid standardized SNP Match: NEA=REF Indistinguishable 621 0.62 1960008 hg19 rsid unknown &amp; SNPID valid CHR valid &amp; POS valid standardized SNP Match: NEA=REF No_matching_or_no_info 173 0.17 1960010 hg19 rsid unknown &amp; SNPID valid CHR valid &amp; POS valid standardized SNP Flipped_fixed Not_palindromic_SNPs 42815 42.82 1960011 hg19 rsid unknown &amp; SNPID valid CHR valid &amp; POS valid standardized SNP Flipped_fixed Palindromic+strand 6237 6.24 1960012 hg19 rsid unknown &amp; SNPID valid CHR valid &amp; POS valid standardized SNP Flipped_fixed Palindromic-strand_fixed 10 0.01 1960017 hg19 rsid unknown &amp; SNPID valid CHR valid &amp; POS valid standardized SNP Flipped_fixed Indistinguishable 616 0.62 1960018 hg19 rsid unknown &amp; SNPID valid CHR valid &amp; POS valid standardized SNP Flipped_fixed No_matching_or_no_info 181 0.18 1960309 hg19 rsid unknown &amp; SNPID valid CHR valid &amp; POS valid standardized &amp; normalized indel Match: NEA=REF Unchecked 563 0.56 1960319 hg19 rsid unknown &amp; SNPID valid CHR valid &amp; POS valid standardized &amp; normalized indel Flipped_fixed Unchecked 196 0.2 1960363 hg19 rsid unknown &amp; SNPID valid CHR valid &amp; POS valid standardized &amp; normalized indel Both_alleles_on_ref+indistinguishable Indel_match 3659 3.66 1960364 hg19 rsid unknown &amp; SNPID valid CHR valid &amp; POS valid standardized &amp; normalized indel Both_alleles_on_ref+indistinguishable Indel_flipped_fixed 4484 4.48 1960368 hg19 rsid unknown &amp; SNPID valid CHR valid &amp; POS valid standardized &amp; normalized indel Both_alleles_on_ref+indistinguishable No_matching_or_no_info 274 0.27 <p>You can easily format the processed sumstats and save it. For details, see: https://cloufield.github.io/gwaslab/Format/</p> <p>Let's export the sumstats as the default format used in LDSC.</p> In\u00a0[29]: Copied! <pre>mysumstats.to_format(\"clean_sumstats\",fmt=\"ldsc\")\n</pre> mysumstats.to_format(\"clean_sumstats\",fmt=\"ldsc\") <pre>Tue Apr 25 15:18:50 2023 Start to format the output sumstats in:  ldsc  format\nTue Apr 25 15:18:50 2023  -Formatting statistics ...\nTue Apr 25 15:18:50 2023  - Float statistics formats:\nTue Apr 25 15:18:50 2023   - Columns: ['EAF', 'BETA', 'SE', 'P']\nTue Apr 25 15:18:50 2023   - Output formats: ['{:.4g}', '{:.4f}', '{:.4f}', '{:.4e}']\nTue Apr 25 15:18:50 2023  - Start outputting sumstats in ldsc format...\nTue Apr 25 15:18:50 2023  -ldsc format will be loaded...\nTue Apr 25 15:18:50 2023  -ldsc format meta info:\nTue Apr 25 15:18:50 2023   - format_name  :  ldsc\nTue Apr 25 15:18:50 2023   - format_source  :  https://github.com/bulik/ldsc/wiki/Summary-Statistics-File-Format\nTue Apr 25 15:18:50 2023   - format_source2  :  https://github.com/bulik/ldsc/blob/master/munge_sumstats.py\nTue Apr 25 15:18:50 2023   - format_version  :  20150306\nTue Apr 25 15:18:50 2023  -gwaslab to ldsc format dictionary:\nTue Apr 25 15:18:50 2023   - gwaslab keys: rsID,NEA,EA,EAF,N,BETA,P,Z,INFO,OR,CHR,POS\nTue Apr 25 15:18:50 2023   - ldsc values: SNP,A2,A1,Frq,N,Beta,P,Z,INFO,OR,CHR,POS\nTue Apr 25 15:18:50 2023  -Output columns: SNP,CHR,POS,A1,A2,Frq,Beta,P,N\nTue Apr 25 15:18:50 2023  -Output path: clean_sumstats.ldsc.tsv.gz\nTue Apr 25 15:18:51 2023  -Saving log file: clean_sumstats.ldsc.log\nTue Apr 25 15:18:51 2023 Finished outputting successfully!\n</pre> <p>Sometimes we only need to export part of the sumstats. For example,</p> <ul> <li>we can specify <code>hapmap3=True</code> to export only hapmap3 variants;</li> <li>specify <code>exclude_hla=True</code> to exclude variants in HLA region when exporting;</li> <li>specify <code>md5sum=True</code> to calculate the md5sum value for the exported sumstats.</li> </ul> In\u00a0[30]: Copied! <pre>mysumstats.to_format(\"clean_sumstats\",fmt=\"ldsc\",hapmap3=True,exclude_hla=True,md5sum=True)\n</pre> mysumstats.to_format(\"clean_sumstats\",fmt=\"ldsc\",hapmap3=True,exclude_hla=True,md5sum=True) <pre>Tue Apr 25 15:18:51 2023 Start to format the output sumstats in:  ldsc  format\nTue Apr 25 15:18:51 2023  -Excluding variants in HLA region ...\nTue Apr 25 15:18:51 2023  -Exclude 609 variants in HLA region.\nTue Apr 25 15:18:51 2023  -Processing 99391 raw variants...\nTue Apr 25 15:18:51 2023  -Loading Hapmap3 variants data...\nTue Apr 25 15:18:52 2023  -Extract 8644 variants in Hapmap3 datasets for build 19.\nTue Apr 25 15:18:52 2023  -Formatting statistics ...\nTue Apr 25 15:18:52 2023  - Float statistics formats:\nTue Apr 25 15:18:52 2023   - Columns: ['EAF', 'BETA', 'SE', 'P']\nTue Apr 25 15:18:52 2023   - Output formats: ['{:.4g}', '{:.4f}', '{:.4f}', '{:.4e}']\nTue Apr 25 15:18:52 2023  - Start outputting sumstats in ldsc format...\nTue Apr 25 15:18:52 2023  -ldsc format will be loaded...\nTue Apr 25 15:18:52 2023  -ldsc format meta info:\nTue Apr 25 15:18:52 2023   - format_name  :  ldsc\nTue Apr 25 15:18:52 2023   - format_source  :  https://github.com/bulik/ldsc/wiki/Summary-Statistics-File-Format\nTue Apr 25 15:18:52 2023   - format_source2  :  https://github.com/bulik/ldsc/blob/master/munge_sumstats.py\nTue Apr 25 15:18:52 2023   - format_version  :  20150306\nTue Apr 25 15:18:52 2023  -gwaslab to ldsc format dictionary:\nTue Apr 25 15:18:52 2023   - gwaslab keys: rsID,NEA,EA,EAF,N,BETA,P,Z,INFO,OR,CHR,POS\nTue Apr 25 15:18:52 2023   - ldsc values: SNP,A2,A1,Frq,N,Beta,P,Z,INFO,OR,CHR,POS\nTue Apr 25 15:18:52 2023  -Output columns: SNP,CHR,POS,A1,A2,Frq,Beta,P,N\nTue Apr 25 15:18:52 2023  -Output path: clean_sumstats.hapmap3.noMHC.ldsc.tsv.gz\nTue Apr 25 15:18:52 2023  -md5sum hashing for the file: clean_sumstats.hapmap3.noMHC.ldsc.tsv.gz\nTue Apr 25 15:18:52 2023  -md5sum path: clean_sumstats.hapmap3.noMHC.ldsc.tsv.gz.md5sum\nTue Apr 25 15:18:52 2023  -Saving log file: clean_sumstats.hapmap3.noMHC.ldsc.log\nTue Apr 25 15:18:52 2023 Finished outputting successfully!\n</pre> <p>Output in GWAS-SSF format</p> In\u00a0[31]: Copied! <pre>mysumstats.to_format(\"clean_sumstats\",fmt=\"ssf\",md5sum=True)\n</pre> mysumstats.to_format(\"clean_sumstats\",fmt=\"ssf\",md5sum=True) <pre>Thu Apr 27 11:45:41 2023 Start to format the output sumstats in:  ssf  format\nThu Apr 27 11:45:41 2023  -Formatting statistics ...\nThu Apr 27 11:45:52 2023  - Float statistics formats:\nThu Apr 27 11:45:52 2023   - Columns: ['EAF', 'BETA', 'SE', 'P']\nThu Apr 27 11:45:52 2023   - Output formats: ['{:.4g}', '{:.4f}', '{:.4f}', '{:.4e}']\nThu Apr 27 11:45:52 2023  - Replacing separator from \":\" to \"_\"...\nThu Apr 27 11:45:54 2023  - Start outputting sumstats in ssf format...\nThu Apr 27 11:45:55 2023  -ssf format will be loaded...\nThu Apr 27 11:45:55 2023  -ssf format meta info:\nThu Apr 27 11:45:55 2023   - format_name  :  ssf\nThu Apr 27 11:45:55 2023   - format_source  :  https://www.biorxiv.org/content/10.1101/2022.07.15.500230v1.full\nThu Apr 27 11:45:55 2023   - format_version  :  20220726\nThu Apr 27 11:45:55 2023  -gwaslab to ssf format dictionary:\nThu Apr 27 11:45:55 2023   - gwaslab keys: SNPID,rsID,CHR,POS,NEA,EA,N,BETA,SE,P,INFO,OR,OR_95L,OR_95U\nThu Apr 27 11:45:55 2023   - ssf values: variant_id,rsid,chromosome,base_pair_location,other_allele,effect_allele,n,beta,standard_error,p_value,info,odds_ratio,ci_lower,ci_upper\nThu Apr 27 11:45:57 2023  -Output columns: variant_id,chromosome,base_pair_location,effect_allele,other_allele,beta,standard_error,p_value,n\nThu Apr 27 11:45:57 2023  -Output path: clean_sumstats.ssf.tsv.gz\nThu Apr 27 11:47:35 2023  -md5sum hashing for the file: clean_sumstats.ssf.tsv.gz\nThu Apr 27 11:47:35 2023  -md5sum path: clean_sumstats.ssf.tsv.gz.md5sum\nThu Apr 27 11:47:35 2023  -Saving log file: clean_sumstats.ssf.log\nThu Apr 27 11:47:35 2023 Finished outputting successfully!\n</pre> <p>gwaslab can perform liftover for base pair positions.</p> <p>Note: GWASLab only liftover CHR and POS, and when lifted, the last two digits status code will be rolled back to 99. Since for different reference genome, the reference allele or strand might be reverse, so it is needed to harmonize again after liftover.</p> In\u00a0[31]: Copied! <pre>mysumstats.liftover(n_cores=1, from_build=\"19\", to_build=\"38\")\n</pre> mysumstats.liftover(n_cores=1, from_build=\"19\", to_build=\"38\") <pre>Tue Apr 25 15:18:52 2023 Start to perform liftover...\nTue Apr 25 15:18:52 2023  -Current Dataframe shape : 100000  x  13\nTue Apr 25 15:18:52 2023  -CPU Cores to use : 1\nTue Apr 25 15:18:52 2023  -Performing liftover ...\nTue Apr 25 15:18:52 2023  -Creating converter : hg19 to hg38\nTue Apr 25 15:18:53 2023  -Converting variants with status code xxx0xxx :100000...\nTue Apr 25 15:19:12 2023  -Removed unmapped variants: 57\nTue Apr 25 15:19:13 2023 Finished liftover successfully!\n</pre> In\u00a0[32]: Copied! <pre>mysumstats.data\n</pre> mysumstats.data Out[32]: SNPID rsID CHR POS EA NEA EAF BETA SE P N DIRECTION STATUS 0 1:875643:C:G rs7411115 1 940263 G C 0.7290 0.0147 0.0130 0.258600 166718 +?+- 3860099 1 1:928416:G:A rs111754459 1 993036 A G 0.1363 0.0113 0.0142 0.423300 191764 --+- 3860099 2 1:933045:C:T rs189213898 1 997665 T C 0.0087 0.0008 0.0704 0.991500 166718 -?+- 3860099 3 1:1019158:G:A rs142369888 1 1083778 A G 0.0110 0.1189 0.0613 0.052510 166718 +?++ 3860099 4 1:1023310:T:C rs11260589 1 1087930 C T 0.0854 0.0202 0.0182 0.265600 191764 +++- 3860099 ... ... ... ... ... ... ... ... ... ... ... ... ... ... 99995 X:153882706:C:T rs3829775 23 154654432 T C 0.0125 -0.0017 0.0526 0.973600 166718 +?-- 3860099 99996 X:154087726:C:T rs112922881 23 154859451 T C 0.0743 0.0414 0.0151 0.006171 191764 +-+- 3860099 99997 X:154126990:T:C rs28370221 23 154898715 C T 0.0763 -0.0085 0.0132 0.519500 191764 +--- 3860099 99998 X:154140146:T:G rs28895719 23 154911871 G T 0.1707 0.0043 0.0096 0.652700 191764 +-+- 3860099 99999 X:154278797:T:C rs114209171 23 155050522 C T 0.1738 0.0025 0.0091 0.785500 191764 +-+- 3860099 <p>99943 rows \u00d7 13 columns</p> <p>For details, see https://cloufield.github.io/gwaslab/LiftOver/</p>"},{"location":"tutorial_3.4/#tutorial-for-gwaslab","title":"Tutorial for gwaslab\u00b6","text":""},{"location":"tutorial_3.4/#download-sample-data","title":"Download sample data\u00b6","text":""},{"location":"tutorial_3.4/#import-gwaslab-package","title":"Import gwaslab package\u00b6","text":""},{"location":"tutorial_3.4/#loading-data-into-gwaslab-sumstats","title":"Loading data into gwaslab Sumstats\u00b6","text":""},{"location":"tutorial_3.4/#create-manhattan-plots-and-q-q-plots","title":"Create Manhattan plots and Q-Q plots\u00b6","text":""},{"location":"tutorial_3.4/#standardization-qc-basic_check","title":"Standardization &amp; QC : <code>.basic_check()</code>\u00b6","text":""},{"location":"tutorial_3.4/#extract-lead-variants-get_lead","title":"Extract lead variants : get_lead()\u00b6","text":""},{"location":"tutorial_3.4/#use-the-snpid-to-create-some-highly-customized-mqq-plot","title":"Use the SNPID to create some highly customized mqq plot\u00b6","text":""},{"location":"tutorial_3.4/#quick-regional-plot-without-ld-information","title":"Quick regional plot without LD-information\u00b6","text":""},{"location":"tutorial_3.4/#reference-file-downloading","title":"Reference file downloading\u00b6","text":""},{"location":"tutorial_3.4/#check-available-reference-from-gwaslab","title":"check available reference from gwaslab\u00b6","text":""},{"location":"tutorial_3.4/#download-reference-using-gwaslab","title":"download reference using gwaslab\u00b6","text":""},{"location":"tutorial_3.4/#sampling","title":"Sampling\u00b6","text":""},{"location":"tutorial_3.4/#infer-genome-build","title":"Infer genome build\u00b6","text":""},{"location":"tutorial_3.4/#fix-snpid","title":"Fix SNPID\u00b6","text":""},{"location":"tutorial_3.4/#annotate-rsid","title":"Annotate rsID\u00b6","text":""},{"location":"tutorial_3.4/#maximize-the-annotation","title":"Maximize the annotation\u00b6","text":""},{"location":"tutorial_3.4/#harmonization","title":"Harmonization\u00b6","text":""},{"location":"tutorial_3.4/#sumstats-summary","title":"Sumstats Summary\u00b6","text":""},{"location":"tutorial_3.4/#formatting-and-saving-to_format","title":"Formatting and saving : to_format()\u00b6","text":""},{"location":"tutorial_3.4/#liftover","title":"Liftover\u00b6","text":""}]}